
function Routes(){this.getStressStrainCurve=undefined;this.printCurvePoints=undefined;}
function ResultUnits(){RL.Unit.SavedUnitsWorker.call(this,'stressStrainUnits');}
ResultUnits.prototype=Object.create(RL.Unit.SavedUnitsWorker.prototype);ResultUnits.save=function(unitBaseName){var unitWrkr=new ResultUnits();unitWrkr.save(unitBaseName);}
ResultUnits.getUnitBase=function(){var unitWrkr=new ResultUnits();return unitWrkr.getUnitBase();}
ResultUnits.getTypeGroup=function(){var unitWrkr=new ResultUnits();return unitWrkr.getTypeGroupObj();}
ResultUnits.getTypeDic=function(){var typeGroup=ResultUnits.getTypeGroup();return typeGroup.unitDic;}
resourceLoader.subscribeOnPageLoaded(function(){var rdoUnitCustom=document.getElementById('unitRadioCustom');var rdoUnitEnglish=document.getElementById('unitRadioEnglish');var rdoUnitSI=document.getElementById('unitRadioSI');var dispUnits=ResultUnits.getUnitBase();if(dispUnits==='Custom'){rdoUnitCustom.checked=true;}else if(dispUnits==='English'){rdoUnitEnglish.checked=true;}else if(dispUnits==='SI'){rdoUnitSI.checked=true;}
var updateDispUnits=function(){if(rdoUnitCustom.checked){ResultUnits.save('Custom');}else if(rdoUnitEnglish.checked){ResultUnits.save('English');}else if(rdoUnitSI.checked){ResultUnits.save('SI');}
curveWrkr.updateDisplay();}
rdoUnitCustom.addEventListener('change',updateDispUnits);rdoUnitEnglish.addEventListener('change',updateDispUnits);rdoUnitSI.addEventListener('change',updateDispUnits);});function CurveWorker(){var thisObj=this;this.matProps_PSI=undefined;this.resObj_PSI=undefined;this.formControls=new RL.Form.Form();this.init=function(){this.txtYieldStr=document.getElementById('txtYieldStr');this.txtUltStr=document.getElementById('txtUltStr');this.txtElasticMod=document.getElementById('txtElasticMod');this.txtPctElong=document.getElementById('txtPctElong');this.txtWarn=document.getElementById('txtWarn');this.divWarn=document.getElementById('divWarn');this.btnStressStrainPrint=document.getElementById('btnPrintToExcel');this.lblStressStrainPrintMsg=document.getElementById('spnPrintMsg');this.txtYieldStr.value='70000 psi';this.txtUltStr.value='90000 psi';this.txtElasticMod.value='28000000 psi';this.txtPctElong.value='10%';var lblLogin=document.getElementById('lblLogin_pctElong');if(!userLoggedIn()){this.txtPctElong.disabled=true;lblLogin.style.display='inherit';}
this.formControls.fieldDict={'yieldStr':new RL.Form.Field(this.txtYieldStr,[new RL.Form.Validator.UnitPositive('stress',{allowZero:false,name:''})]),'ultStr':new RL.Form.Field(this.txtUltStr,[new RL.Form.Validator.UnitPositive('stress',{allowZero:false,name:''})]),'elasticMod':new RL.Form.Field(this.txtElasticMod,[new RL.Form.Validator.UnitPositive('stress',{allowZero:false,name:''})]),'pctElong':new RL.Form.Field(this.txtPctElong,[new RL.Form.Validator.PercentPositive({allowZero:false})])};this.grid=new BF.GridTable('gridStressStrainPts',{config:{height:"245px",showFooter:false},columns:[{field:'dummy',caption:'',width:'10px'}],records:[]});this.txtYieldStr.addEventListener("change",this.onYieldStrChanged);this.txtUltStr.addEventListener("change",this.onUltStrChanged);this.txtElasticMod.addEventListener("change",this.onElasticModChanged);this.txtPctElong.addEventListener("change",this.onPctElongChanged);this.btnStressStrainPrint.addEventListener("click",this.onPrintBtnClick);__pullStressStrainCurveData(this.updateDisplay);}
this.onYieldStrChanged=function(){if(thisObj.validateFormControls()){__pullStressStrainCurveData(thisObj.updateDisplay);}else{thisObj.clearDataOnDisplay();}}
this.onUltStrChanged=function(){if(thisObj.validateFormControls()){__pullStressStrainCurveData(thisObj.updateDisplay);}else{thisObj.clearDataOnDisplay();}}
this.onElasticModChanged=function(){if(thisObj.validateFormControls()){__pullStressStrainCurveData(thisObj.updateDisplay);}else{thisObj.clearDataOnDisplay();}}
this.onPctElongChanged=function(){if(thisObj.validateFormControls()){__pullStressStrainCurveData(thisObj.updateDisplay);}else{thisObj.clearDataOnDisplay();}}
this.getFormValues_PSI=function(){var formValues=this.formControls.getValues();var matProps={'yieldStr':new RL.Unit(formValues.yieldStr).toNumber('psi'),'ultStr':new RL.Unit(formValues.ultStr).toNumber('psi'),'elasticMod':new RL.Unit(formValues.elasticMod).toNumber('psi'),'pctElong':new RL.Percent(formValues.pctElong).value||0}
return matProps;}
this.getConvertedMatProps=function(){var unitGroup=ResultUnits.getTypeGroup();var stressUnit=unitGroup.unitDic['stress'];var matProps=RL.Object.copyProperties(thisObj.matProps_PSI);if(stressUnit!=='psi'){matProps.yieldStr=new RL.Unit(matProps.yieldStr,'psi').toNumber(stressUnit);matProps.ultStr=new RL.Unit(matProps.ultStr,'psi').toNumber(stressUnit);matProps.elasticMod=new RL.Unit(matProps.elasticMod,'psi').toNumber(stressUnit);}
return matProps;}
this.getConvertedResultValues=function(){var unitGroup=ResultUnits.getTypeGroup();var unitDic=unitGroup.unitDic;var stressUnit=unitGroup.unitDic['stress'];var matProps=thisObj.getConvertedMatProps();var resObj=RL.Object.copyProperties(thisObj.resObj_PSI);if(stressUnit!=='psi'){resObj.engYieldStr=new RL.Unit(resObj.engYieldStr,'psi').toNumber(stressUnit);resObj.engUltStr=new RL.Unit(resObj.engUltStr,'psi').toNumber(stressUnit);if(resObj.trueUltStr){resObj.trueUltStr=new RL.Unit(resObj.trueUltStr,'psi').toNumber(stressUnit);}
resObj.curvePoints.engStress=RL.Unit.convertArray_betweenUnits(resObj.curvePoints.engStress,'psi',stressUnit);resObj.curvePoints.trueStress=RL.Unit.convertArray_betweenUnits(resObj.curvePoints.trueStress,'psi',stressUnit);}
return{matProps:matProps,resObj:resObj,unitDic:unitGroup.unitDic};}
this.validateFormControls=function(){this.clearWarnings();if(!this.formControls.validate()){return false;}
var matProps=this.getFormValues_PSI();if(matProps.yieldStr>=matProps.ultStr){this.setGeneralWarning('Ultimate strength must be greater than yield strength!');return false;}
if(matProps.yieldStr<0.1*matProps.ultStr){this.setGeneralWarning('Yield strength is too small compared to ultimate strength!');return false;}
if(matProps.elasticMod<matProps.yieldStr){this.setGeneralWarning('Elastic modulus is too small compared to the strength!');return false;}
if(!(matProps.pctElong>0.002)){this.setGeneralWarning('% Elongation must be greater than 0.2%!');return false;}
if(matProps.pctElong>1){this.setGeneralWarning('% Elongation cannot be greater than 100%!');return false;}
return true;}
this.setGeneralWarning=function(warningStr){this.divWarn.setVisible(true);this.txtWarn.innerHTML=warningStr;var flashFunc=function(){var borderColor=thisObj.txtWarn.style.borderColor==='crimson'?'white':'crimson';thisObj.txtWarn.style.borderColor=borderColor;}
var maxCount=6;RL.TimedCode.runAtInterval(flashFunc,500,maxCount);}
this.clearWarnings=function(){this.divWarn.setVisible(false);this.txtWarn.innerHTML='';}
function __pullStressStrainCurveData(callbackFunc){var matProps=thisObj.getFormValues_PSI();BF.AJAX.post({url:routes.getStressStrainCurve,args:{matStr:JSON.stringify(matProps)},onDone:function(resultsStr){var resObj=JSON.parse(resultsStr);thisObj.matProps_PSI=matProps;thisObj.resObj_PSI=resObj;callbackFunc();},onFail:function(){BF.modalAlert('There was an error retrieving stress-strain curve from the server.<br>Please contact us if you need assistance.',"Error Retrieving Stress-Strain Curve");}});}
this.updateDisplay=function(){thisObj.lblStressStrainPrintMsg.innerHTML='';var resDic=thisObj.getConvertedResultValues();__plotStressStrainCurve(resDic);__printDataToGrid(resDic);__printDataToTable(resDic);}
this.clearDataOnDisplay=function(){var resDicEmpty={matProps:undefined,resObj:undefined,unitDic:undefined};__plotStressStrainCurve(resDicEmpty);__printDataToTable(resDicEmpty);thisObj.grid.clearRecords();}
function __plotStressStrainCurve(resDic){var matProps=resDic.matProps;var resObj=resDic.resObj;var unitDic=resDic.unitDic;var stressUnit=unitDic?unitDic['stress']:'';var canvasObj=new RL.Canvas("canvasStressStrain");canvasObj.options.padding={top:5,bottom:5,left:10,right:10};if(matProps&&resObj){var engStrain=resObj.curvePoints.engStrain;var engStress=resObj.curvePoints.engStress;canvasObj.plot({points:{x:engStrain,y:engStress},lineOptions:{width:2,color:'Blue',style:'-'},legendLabel:''});var greyLineOpts={width:2,color:'Silver',style:'--'}
canvasObj.plot({points:[new RL.Vector2(matProps.pctElong,0),new RL.Vector2(resObj.engStrainUltimate,matProps.ultStr)],lineOptions:greyLineOpts,legendLabel:''});canvasObj.plot({points:[new RL.Vector2(resObj.engStrainUltimate,0),new RL.Vector2(resObj.engStrainUltimate,matProps.ultStr)],lineOptions:greyLineOpts,legendLabel:''});canvasObj.plot({points:new RL.Vector2(resObj.engStrainAtYield,matProps.yieldStr),markerOptions:{sizePX:8,color:'Blue',style:'.'}});canvasObj.plot({points:new RL.Vector2(resObj.engStrainUltimate,matProps.ultStr),markerOptions:{sizePX:8,color:'Blue',style:'x'}});}else{canvasObj.plot({points:[new RL.Vector2(0,0),new RL.Vector2(0.1,1)],markerOptions:{sizePX:0}});}
var maxStrain=0.1;var maxStress=1;if(matProps&&resObj){maxStrain=engStrain[engStrain.length-1];maxStress=matProps.ultStr;}
canvasObj.addMouseCoordinates(undefined,{xDigits:3,yDigits:0,marginPX:10});canvasObj.addTitle('Stress-Strain Curve');var stepSize;if(maxStrain>1){stepSize=0.1;}else if(maxStrain>0.1){stepSize=0.02}else{stepSize=0.01;}
canvasObj.set_x_axis({label:'Strain',gridLines:true,stepSize:stepSize,tickFormatFunct:function(value){return RL.Number.format_Round(value,{digits:3});}});canvasObj.set_y_axis({label:'Stress ['+stressUnit+']',gridLines:true,maxBound:1.01*maxStress});canvasObj.draw();}
function __printDataToGrid(resDic){var resObj=resDic.resObj;var unitDic=resDic.unitDic;var stressUnit=unitDic?unitDic['stress']:'';var columns=[{field:'num',caption:'#',width:'30px'},{field:'engStrain',caption:'Strain',width:'45%'},{field:'engStress',caption:'Stress ['+stressUnit+']',width:'55%'}]
thisObj.grid.setColumns(columns);var engCurvePts=[];if(resObj){for(var ii=0;ii<resObj.curvePoints.engStrain.length;ii+=1){engCurvePts[ii]={num:ii+1,engStrain:RL.Number.format_Round(resObj.curvePoints.engStrain[ii],{digits:7}),engStress:RL.Number.format_General(resObj.curvePoints.engStress[ii],{sigDigits:5})}}}
thisObj.grid.setRecords(engCurvePts);}
function __printDataToTable(resDic){var matProps=resDic.matProps;var resObj=resDic.resObj;var unitDic=resDic.unitDic;var stressUnit=unitDic?unitDic['stress']:'';var elasticModUnit=unitDic?unitDic['elasticMod']:'';var dispWrkr=new RL.DisplayWorker();var engYieldStr=resObj?new RL.Unit(resObj['engYieldStr'],stressUnit):'---';var engUltStr=resObj?new RL.Unit(resObj['engUltStr'],stressUnit):'---';var elasticMod=matProps?new RL.Unit(matProps.elasticMod,stressUnit):'---';var pctElong_Dec=matProps?matProps.pctElong:'---';var pctElong_Pct=matProps?new RL.Percent(matProps.pctElong).display:'---';var n=resObj?resObj.n:'---';var styleN=undefined;dispWrkr.display([{className:'engYieldStr',value:engYieldStr,unitName:stressUnit},{className:'engUltStr',value:engUltStr,unitName:stressUnit},{className:'elasticMod',value:elasticMod,unitName:elasticModUnit},{className:'pctElong',value:pctElong_Dec},{className:'pctElong_Pct',value:pctElong_Pct},{className:'engStrainAtYield',value:resObj?resObj['engStrainAtYield']:'---',sigDigits:4},{className:'engStrainUltimate',value:resObj?resObj['engStrainUltimate']:'---',sigDigits:4},{className:'mat_n',value:n,sigDigits:4,style:styleN},]);}
this.onPrintBtnClick=function(){if(userLoggedIn()){var unitGroup=ResultUnits.getTypeGroup();var stressUnit=unitGroup.unitDic['stress'];var matProps=thisObj.getConvertedMatProps();matProps['fullName']='Material Stress-Strain Curve';matProps['stressUnit']=stressUnit;var matStr=JSON.stringify(matProps);thisObj.lblStressStrainPrintMsg.innerHTML='Creating file, please wait...';var url=routes.printCurvePoints;BF.HTTP.post(url,{matStr:matStr});}else{thisObj.lblStressStrainPrintMsg.innerHTML='You must be logged in to download to Excel.';}}
thisObj.init();}