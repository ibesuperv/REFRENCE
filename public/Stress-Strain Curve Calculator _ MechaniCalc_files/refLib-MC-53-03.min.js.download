"use strict";function RL(){}
RL.Error=function(name,message){this.name=name;this.message=message;this.consoleWarn=function(prefix){prefix=prefix||'';console.warn(prefix+this.name+', '+this.message);}}
RL.Type=function(){}
RL.Type.isNumber=function(value){return typeof(value)==='number'&&!isNaN(value);}
RL.Type.isBoolean=function(value){return typeof(value)==='boolean';}
RL.Type.isArray=function(value){return value&&typeof(value)==='object'&&Object.prototype.toString.apply(value)=='[object Array]';}
RL.Type.isObject=function(value){return typeof(value)==='object'&&value!==null;}
RL.Type.isNaN=function(value){return typeof(value)==="number"&&isNaN(value);}
RL.Type.isHTMLElement=function(value){try{return value instanceof HTMLElement;}catch(e){return value!==null&&typeof(value)==='object'&&value.nodeType===1&&typeof(value.nodeName)==='string';}}
RL.Type.isHTMLSelectElement=function(value){return RL.Type.isHTMLElement(value)&&value.nodeName.toLowerCase()==='select';}
RL.Type.copy=function(value){var newValue;if(RL.Type.isArray(value)){newValue=RL.Array.copy(value);}else if(RL.Type.isObject(value)){if(typeof value["copy"]=='function'){newValue=value.copy();}else if(typeof value["clone"]=='function'){newValue=value.clone();}else{newValue=RL.Object.copyProperties(value);}}else{newValue=value;}
return newValue;}
RL.String=function(){}
RL.String.trimToLength=function(str,length){if(str.length>length){return str.slice(0,length);}else{return str;}}
RL.String.right=function(str,length){if(str.length>length){return str.slice(str.length-length,str.length);}else{return str;}}
RL.String.left=function(str,length){return RL.String.trimToLength(str,length);}
RL.String.startsWith=function(str,searchStr){var strLeft=RL.String.left(str,searchStr.length);return strLeft===searchStr;}
RL.String.trim=function(str){if(String.prototype.trim){return str.trim();}else{return str.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,'');}}
RL.String.countInstances=function(str,searchStr){var parts=str.split(searchStr);var count=parts.length-1;return count;}
RL.String.replaceAll=function(str,replaceArr,newStr){var retStr=str;for(var ii=0;ii<replaceArr.length;ii++){var replaceStr=replaceArr[ii];if(retStr.indexOf(replaceStr)!==-1){retStr=retStr.split(replaceStr).join(newStr);}}
return retStr;}
RL.Number=function(){}
RL.Number.isNumber=function(value){return typeof(value)==='number'&&!isNaN(value);}
RL.Number.isNumeric=function(value,_blanksAreNumeric){if(_blanksAreNumeric===false&&value===''){value='xxx';}
return!isNaN(value);}
RL.Number.tryGetNumber=function(value,_options){var options=_options||{};var allowBlanks=(options.allowBlanks===false)?false:true;if(value===undefined||value===null){return undefined;}else if(value===''){return(allowBlanks===false)?undefined:0;}else if(typeof(value)==='number'){return value;}else if(!isNaN(value)){return Number(value);}else{return undefined;}}
RL.Number.isInteger=function(value,_options){var threshDigits=_options!==undefined?_options.threshDigits:undefined;if(threshDigits===undefined){return(value%1===0);}else{return RL.Number.round(value%1,threshDigits)===0;}}
RL.Number.sign=function(value){if(value==0){return 0;}else{return value/Math.abs(value);}}
RL.Number.int=function(value){return Math[value<0?'ceil':'floor'](value);}
RL.Number.radians=function(angleDeg){return angleDeg*(Math.PI/180);}
RL.Number.degrees=function(angleRad){return angleRad*(180/Math.PI);}
RL.Number.basicallyEqual=function(num1,num2,thresh){if(thresh===undefined){thresh=1e-14;}
return(Math.abs(num1-num2)<=thresh);}
RL.Number.isBetween=function(numChk,num1,num2,_isInclusive){var isInclusive=_isInclusive!==undefined?_isInclusive:false;if(isInclusive){if(numChk>=Math.min(num1,num2)&&numChk<=Math.max(num1,num2)){return true;}}else{if(numChk>Math.min(num1,num2)&&numChk<Math.max(num1,num2)){return true;}}
return false;}
RL.Number.round=function(num,digits){if(!digits){return Math.round(num);}else{var mult=Math.pow(10,digits);return Math.round(num*mult)/mult;}}
RL.Number.roundToBase=function(num,base,roundType,_options){var threshDigits=_options!==undefined?_options.threshDigits:undefined;if(base===undefined){base=1;}
var dividesEvenly=RL.Number.isInteger(num/base,{threshDigits:threshDigits});if(!dividesEvenly){if(roundType===1){num+=0.5*base;}else if(roundType===-1){num-=0.5*base;}}
var rounded=base*Math.round(num/base);return RL.Number.round(rounded,14);}
RL.Number.orderOfMagnitude=function(num){var oMag;num=Math.abs(num);if(num>0){oMag=Math.floor(Math.log(num)/Math.LN10);if(num%Math.pow(10,oMag+1)===0){oMag+=1;}}else{oMag=0;}
return oMag;}
RL.Number.FormatEnum={NONE:0,GENERAL:1,COMMA:2,ENGINEERING:3,PERCENT:4,ROUND:5}
RL.Number.formatNumber=function(num,_digits,_formatEnum){if(_digits<0){_digits=undefined;}
var options={digits:_digits};if(_formatEnum===RL.Number.FormatEnum.GENERAL){return RL.Number.format_General(num,options);}else if(_formatEnum===RL.Number.FormatEnum.COMMA){return RL.Number.format_Comma(num,options);}else if(_formatEnum===RL.Number.FormatEnum.ENGINEERING){return RL.Number.format_Engineering(num,options);}else if(_formatEnum===RL.Number.FormatEnum.PERCENT){return RL.Number.format_Percent(num,options);}else{return RL.Number.format_Round(num,options);}}
RL.Number.format_General=function(num,_options){var num=RL.Number.__format_ensureNumber(num);if(num===false){return'NaN';}
_options=_options||{};var oMag=RL.Number.orderOfMagnitude(num);if(_options.zeroThresh!==undefined&&oMag<=_options.zeroThresh){num=0;oMag=0;}
if(oMag>=6||oMag<=-5){return RL.Number.format_Engineering(num,_options);}else{if(_options.sigDigits===undefined){_options.sigDigits=4;}
var formatFunc=_options.midSizeFormatFunc||RL.Number.format_Comma;return formatFunc(num,_options);}}
RL.Number.format_Comma=function(num,_options){var num=RL.Number.__format_ensureNumber(num,_options);if(num===false){return'NaN';}
var digits=RL.Number.__format_getDigits(num,_options);var signStr=RL.Number.sign(num)===-1?'-':'';num=Math.abs(num);var numStr=RL.Number.__format_getRoundedString(num,digits,_options);var parts=numStr.split('.');var wholePart=parts[0];var fracPart=(parts[1]===undefined)?'':'.'+parts[1];var array=wholePart.split('');var index=-3;while(array.length+index>0){array.splice(index,0,',');index-=4;}
wholePart=array.join('');numStr=signStr+wholePart+fracPart;return numStr;}
RL.Number.format_Scientific=function(num,_options){_options=_options||{};var num=RL.Number.__format_ensureNumber(num);if(num===false){return'NaN';}
var signStr=RL.Number.sign(num)==-1?'-':'';num=Math.abs(num);var expBase=(_options.expBase===undefined)?1:_options.expBase;var oMag=RL.Number.orderOfMagnitude(num);var base=oMag-(oMag%expBase);if(oMag<0&&oMag%expBase!==0){base-=expBase;}
var engNum=num/Math.pow(10,base);var suffix=(base!==0)?('E'+base):'';if(_options.sigDigits===undefined){_options.sigDigits=4;}
var numStr;if(engNum){var digits=RL.Number.__format_getDigits(engNum,_options);numStr=RL.Number.__format_getRoundedString(engNum,digits,_options)+suffix;}else{var digits=RL.Number.__format_getDigits(num,_options);numStr=RL.Number.__format_getRoundedString(num,digits,_options);}
numStr=signStr+numStr;return numStr;}
RL.Number.format_Engineering=function(num,_options){_options=_options||{};_options.expBase=3;var numStr=RL.Number.format_Scientific(num,_options);return numStr;}
RL.Number.format_Percent=function(num,_options){var num=RL.Number.__format_ensureNumber(num);if(num===false){return'NaN';}
num=100*num;var digits=RL.Number.__format_getDigits(num,_options);if(digits===undefined){digits=2;}
var numStr=RL.Number.__format_getRoundedString(num,digits,_options)+'%';return numStr;}
RL.Number.format_Round=function(num,_options){var num=RL.Number.__format_ensureNumber(num);if(num===false){return'NaN';}
var digits=RL.Number.__format_getDigits(num,_options);var numStr=RL.Number.__format_getRoundedString(num,digits,_options);return numStr;}
RL.Number.__format_ensureNumber=function(num,_options){if(RL.Number.isNumeric(num,true)){return Number(num);}else{console.warn('WARNING in RL.Number.formatNumber: Not a Number!  Specified value: '+num);return false;}}
RL.Number.__format_getRoundedString=function(num,digits,_options){_options=_options||{};var pad=_options.pad===false?false:true;var numStr;if(digits===undefined){numStr=num.toString();}else{numStr=pad?num.toFixed(digits):String(RL.Number.round(num,digits));}
return numStr;}
RL.Number.__format_getDigits=function(num,options){var options=options||{};var digits=options.digits;var sigDigits=options.sigDigits;if(digits!==undefined){return digits;}else if(sigDigits!==undefined){var oMag=RL.Number.orderOfMagnitude(num);var maxOM=sigDigits-1;digits=RL.Math.getWithinRange(maxOM-oMag,0,20);return digits;}else{return undefined;}}
RL.Percent=function(percentStr){var __value=undefined;Object.defineProperty(this,"value",{get:function(){return __value;}});Object.defineProperty(this,"display",{get:function(){return __value!==undefined?(100*__value)+'%':'NaN';}});var init=function(){percentStr=percentStr||'0';var pctVal=String(percentStr);var hasPct=false;if(pctVal.indexOf('%')!==-1){hasPct=true;pctVal=pctVal.replace('%','');}
if(RL.Number.isNumeric(pctVal,true)){pctVal=Number(pctVal);if(hasPct){__value=pctVal/100;}else{__value=pctVal;}}else{__value=undefined;}}();}
RL.Percent.isPercent=function(percentStr){var pct=new RL.Percent(percentStr);return pct.value!==undefined;}
RL.Array=function(){}
RL.Array.copy=function(arr){var newArr=[];for(var ii=0;ii<arr.length;ii++){var value=arr[ii];newArr[ii]=RL.Type.copy(value);}
return newArr;}
RL.Array.contains=function(arr,item){return(arr.indexOf(item)!=-1);}
RL.Array.removeAt=function(arr,index){arr.splice(index,1);}
RL.Array.equals=function(arr1,arr2){if(!arr1||!arr2){return false;}
if(arr1.length!==arr2.length){return false;}
for(var ii=0;ii<arr1.length;ii++){var value1=arr1[ii];var value2=arr2[ii];if(value1 instanceof Array&&value2 instanceof Array){if(!RL.Array.equals(value1,value2)){return false;}}else if(value1!==value2){return false;}}
return true;}
RL.Array.formatForDisplay=function(numArr,_digits,_formatEnum){var dispArr=[];var digits=(_digits===undefined)?-1:_digits;var formatEnum=_formatEnum||RL.Number.FormatEnum.NONE;for(var ii=0;ii<numArr.length;ii+=1){dispArr[ii]=RL.Number.formatNumber(numArr[ii],digits,formatEnum);}
return dispArr;}
RL.Array.toString=function(arr){var str='[';for(var ii=0;ii<arr.length;ii+=1){if(ii!==0){str+=', ';}
str+=arr[ii];}
str+=']';return str;}
RL.Array.get_sumItems=function(arr){return RL.Math.get_sumItems(arr);}
RL.Array.getItem_Cycle=function(arr,index){while(index>arr.length-1){index-=arr.length;}
return arr[index];}
RL.ObjectArray=function(){}
RL.ObjectArray.get_propValueArray=function(objArr,propName){var propValArr=[];for(var ii=0;ii<objArr.length;ii+=1){var obj=objArr[ii];var propVal=obj[propName];if(propVal&&propValArr.indexOf(propVal)==-1){propValArr.push(propVal);}}
return propValArr;}
RL.ObjectArray.get_AbbreviatedArray=function(objArr,propsToKeep){var abbrevArr=[];for(var ii=0;ii<objArr.length;ii++){var obj=objArr[ii];var abbrevObj=RL.Object.copyProperties(obj,propsToKeep);abbrevArr[ii]=abbrevObj;}
return abbrevArr;}
RL.ObjectArray.formatForDisplay=function(objArr,_specificFormatDic,_defaultFormat,_formatEnumDigits){var retArr=[];var specificFormatDic=_specificFormatDic||{};var defaultFormat=_defaultFormat||{};if(defaultFormat.digits===undefined){defaultFormat.digits=-1;}
if(defaultFormat.formatEnum===undefined){defaultFormat.formatEnum=RL.Number.FormatEnum.GENERAL;}
for(var ii=0;ii<objArr.length;ii+=1){var obj=objArr[ii];var props=Object.keys(obj);var newObj={};for(var jj=0;jj<props.length;jj+=1){var propName=props[jj];var value=obj[propName];if(typeof(value)==="number"){if(specificFormatDic&&propName in specificFormatDic){var numFormat=specificFormatDic[propName];var digits='digits'in numFormat?numFormat.digits:-1;var formatEnum='formatEnum'in numFormat?numFormat.formatEnum:RL.Number.FormatEnum.GENERAL;newObj[propName]=RL.Number.formatNumber(value,digits,formatEnum,_formatEnumDigits);}else{newObj[propName]=RL.Number.formatNumber(value,defaultFormat.digits,defaultFormat.formatEnum,_formatEnumDigits);}}else if(value===undefined||value===null){newObj[propName]='---';}else{newObj[propName]=value;}}
retArr[ii]=newObj;}
return retArr;}
RL.ObjectArray.to_JSON_Array=function(objArr){var jsonArr=[]
for(var ii=0;ii<objArr.length;ii+=1){jsonArr[ii]=JSON.stringify(objArr[ii]);}
return jsonArr;}
RL.ObjectArray.exists=function(objArr,whereDic){var filteredArr=RL.ObjectArray.filter_whereEquals(objArr,whereDic);return filteredArr.length>0;}
RL.ObjectArray.filter_whereEquals=function(objArr,whereDic){var props=Object.keys(whereDic);var check=function(obj){for(var ii=0;ii<props.length;ii+=1){var propName=props[ii];if(obj[propName]!=whereDic[propName]){return false;}}
return true;}
return objArr.filter(check);}
RL.ObjectArray.filter_wherePropSet=function(objArr,propNameArr){var check=function(obj){for(var ii=0;ii<propNameArr.length;ii+=1){var propName=propNameArr[ii];if(!obj[propName]){return false;}}
return true;}
return objArr.filter(check);}
RL.ObjectArray.filter_wherePropExists=function(objArr,propNameArr){var check=function(obj){for(var ii=0;ii<propNameArr.length;ii+=1){var propName=propNameArr[ii];if(!(propName in obj)){return false;}}
return true;}
return objArr.filter(check);}
RL.Object=function(){}
RL.Object.copyProperties=function(obj,_propsToCopy){var newObj={};var props=_propsToCopy||Object.keys(obj);for(var ii=0;ii<props.length;ii+=1){var propName=props[ii];var value=obj[propName];if(typeof value!=='function'){newObj[propName]=RL.Type.copy(value);}}
return newObj;}
RL.Object.forEach=function(obj,func){var props=Object.keys(obj);for(var ii=0;ii<props.length;ii++){var name=props[ii];var value=obj[name];if(typeof(value)!=='function'){func(name,value);}}}
RL.Object.getPropKeys=function(obj){var props=[];var propsMeths=Object.keys(obj);for(var ii=0;ii<propsMeths.length;ii+=1){var name=propsMeths[ii];var prop=obj[name];if(typeof(prop)!=='function'){props.push(name);}}
return props;}
RL.Object.containsAllProperties=function(obj,propsArr){if(obj===undefined||propsArr===undefined){return undefined;}
for(var ii=0;ii<propsArr.length;ii++){var propName=propsArr[ii];if(!(propName in obj)){return false;}}
return true;}
RL.Date=function(dateRep){var thisObj=this;this.dateObj=undefined;var init=function(){if(dateRep===undefined){thisObj.dateObj=new Date();}else if(dateRep instanceof RL.Date){thisObj.dateObj=new Date();thisObj.dateObj.setTime(dateRep.value);}else if(dateRep instanceof Date){thisObj.dateObj=dateRep;}else if(typeof(dateRep)==="number"){thisObj.dateObj=new Date();thisObj.dateObj.setTime(dateRep);}else if(typeof(dateRep==="string")){if(isNaN(dateRep)){var dateTest=new Date(dateRep);if(!isNaN(dateTest.getTime())){thisObj.dateObj=dateTest;}}else{dateRep=Number(dateRep);thisObj.dateObj=new Date();thisObj.dateObj.setTime(dateRep);}}
if(!thisObj.dateObj){console.error('Error initializing RL.Date -- must pass a Date-representable object.');}}();Object.defineProperty(this,"value",{get:function(){return this.dateObj.getTime();}});Object.defineProperty(this,"year",{get:function(){return this.dateObj.getFullYear();}});Object.defineProperty(this,"month",{get:function(){return this.dateObj.getMonth()+1;}});Object.defineProperty(this,"dayOfMonth",{get:function(){return this.dateObj.getDate();}});Object.defineProperty(this,"dayOfWeek",{get:function(){return this.dateObj.getDay();}});Object.defineProperty(this,"date",{get:function(){var datePart=new Date(this.dateObj.getFullYear(),this.dateObj.getMonth(),this.dateObj.getDate());return new RL.Date(datePart);}});this.copy=function(){var copyDate=new Date();copyDate.setTime(this.value);return new RL.Date(copyDate);}
this.toString=function(){return this.dateObj.toString();}
this.toLocaleString=function(){return this.dateObj.toLocaleString();}
this.toJSON=function(){return this.dateObj.toJSON();}
this.addDays=function(numDays){var newMS=this.value+(numDays*60*60*24*1000);return new RL.Date(newMS);}
this.isAfter=function(other){if(other instanceof RL.Date){return this.dateObj>other.dateObj;}else if(other instanceof Date){return this.dateObj>other;}else if(typeof(other)==="number"){return this.value>other;}else{console.error('Date comparison error');return undefined;}}
this.isBefore=function(other){if(other instanceof RL.Date){return this.dateObj<other.dateObj;}else if(other instanceof Date){return this.dateObj<other;}else if(typeof(other)==="number"){return this.value<other;}else{console.error('Date comparison error');return undefined;}}
this.isEqualTo=function(other){if(other instanceof RL.Date){return this.value===other.value;}else if(other instanceof Date){return this.value===other.getTime();}else if(typeof(other)==="number"){return this.value===other;}else{console.error('Date comparison error');return undefined;}}}
RL.Date.now=function(){return new RL.Date(Date.now());}
RL.Date.today=function(){var now=new Date();var today=new Date(now.getFullYear(),now.getMonth(),now.getDate());return new RL.Date(today);}
RL.Unicode=function(){}
RL.Unicode.alphaLower='\u03b1';RL.Unicode.betaLower='\u03b2';RL.Unicode.gammaLower='\u03b3';RL.Unicode.deltaLower='\u03b4';RL.Unicode.epsilonLower='\u03b5';RL.Unicode.epsilonLunateLower='\u03f5';RL.Unicode.zetaLower='\u03b6';RL.Unicode.etaLower='\u03b7';RL.Unicode.thetaLower='\u03b8';RL.Unicode.lambdaLower='\u03bb';RL.Unicode.nuLower='\u03bd';RL.Unicode.piLower='\u03c0';RL.Unicode.rhoLower='\u03c1';RL.Unicode.sigmaLower='\u03c3';RL.Unicode.tauLower='\u03c4';RL.Unicode.phiLower='\u03c6';RL.Unicode.omegaLower='\u03c9';RL.Unicode.deltaUpper='\u0394';RL.Unicode.sigmaUpper='\u03a3';RL.Unicode.omegaUpper='\u03a9';RL.Unicode.superscript_1='\u00b9';RL.Unicode.superscript_2='\u00b2';RL.Unicode.superscript_3='\u00b3';RL.Unicode.degree='\u00b0';RL.Unicode.sqrt='\u221a';RL.Unicode.superscript=function(value){if(!RL.Number.isNumeric(value)){return undefined;}
var charMap={"0":'\u2070',"1":'\u00b9',"2":'\u00b2',"3":'\u00b3',"4":'\u2074',"5":'\u2075',"6":'\u2076',"7":'\u2077',"8":'\u2078',"9":'\u2079'};var retStr='';var num=Math.round(Number(value));if(RL.Number.sign(num)===-1){retStr+='\u207b';num=Math.abs(num);}
var numStr=String(num);for(var ii=0;ii<numStr.length;ii++){var char=numStr[ii];retStr+=charMap[char];}
return retStr;}
RL.Subscription=function(){this.subscriptionList=[];Object.defineProperty(this,"numSubscribers",{get:function(){return this.subscriptionList.length;}});this.subscribe=function(funcToCall){this.subscriptionList.push(funcToCall);}
this.callSubscribers=function(_arg){for(var ii=0;ii<this.subscriptionList.length;ii+=1){var funcToCall=this.subscriptionList[ii];funcToCall(_arg);}}}
RL.Performance=function(){}
RL.Performance.timeIt=function(func,_options){var options=_options||{};var numRuns=options.numRuns||100;var argArray=options.argArray||undefined;var funcCall;if(argArray){funcCall=function(){func.apply(undefined,argArray)};}else{funcCall=func;}
var tLst=[];for(var ii=0;ii<numRuns;ii+=1){var t0=performance.now();funcCall();var t1=performance.now();tLst.push(t1-t0);}
var avgTime=RL.Math.get_sumItems(tLst)/tLst.length;console.log("Call took "+avgTime+" milliseconds, averaged over "+numRuns+" runs.");return avgTime;}
RL.TimedCode=function(){}
RL.TimedCode.runAfterDelay=function(func,delayMS){var timeoutID=window.setTimeout(func,delayMS);}
RL.TimedCode.runAtInterval=function(func,intervalMS,_maxCount){var callCount=0;var intervalID=window.setInterval(function(){func();callCount+=1;if(_maxCount&&callCount>=_maxCount){window.clearInterval(intervalID);}},intervalMS);}
RL.IDataStore=function(){this.onChanged=new RL.Subscription();this.getDataArray=function(){console.warn("IDataStore: getDataArray not implemented!");}
this.call_onChangedEvent=function(_dataArray){if(this.onChanged.numSubscribers>0){var dataArray=_dataArray||this.getDataArray();this.onChanged.callSubscribers(dataArray);}}}
RL.LocalStorage=function(){}
RL.LocalStorage.__showStorageDisabledAlert=function(){var title='Local Storage Disabled';var message='<p>You appear to have Local Storage disabled.  This will disrupt your ability to use the calculators on this website.</p>';message+='<p>We use Local Storage for the following:</p>';message+='<ul><li>Storing results from calculators (for display)</li><li>Storing materials database</li><li>Storing cross sections database</li></ul>';message+='<p>Please enable Local Storage if you would like to use our calculators.';message+='<p>Feel free to contact us if you have any questions or concerns.</p>';BF.modalAlert(message,title);}
RL.LocalStorage.getItem=function(keyName){try{var value=localStorage.getItem(keyName);return value;}catch(ex){RL.LocalStorage.__showStorageDisabledAlert();throw ex;}}
RL.LocalStorage.setItem=function(keyName,value){try{localStorage.setItem(keyName,value);}catch(ex){RL.LocalStorage.__showStorageDisabledAlert();throw ex;}}
RL.LocalStorage.StorageObject=function(storageName,nameArray){var thisObj=this;this.storageName=storageName;this.nameArray=nameArray;var __isLocalStorageDisabled=false;Object.defineProperty(this,"isLocalStorageDisabled",{get:function(){return __isLocalStorageDisabled;}});this.__storageArrays=[];var callOnChanged_forAllStorageArrays=function(){for(var ii=0;ii<thisObj.__storageArrays.length;ii++){var stArr=thisObj.__storageArrays[ii];stArr.call_onChangedEvent();}}
this.get_StorageObject=function(){var storageObj=this.__ensureArraysExist();return storageObj;}
this.get_StorageString=function(){this.__ensureArraysExist();try{return RL.LocalStorage.getItem(this.storageName);}catch(ex){__isLocalStorageDisabled=true;return undefined;}}
this.set_StorageObject=function(storageObj){var storageStr=JSON.stringify(storageObj);try{RL.LocalStorage.setItem(this.storageName,storageStr);}catch(ex){throw ex;}}
this.validateObjectMatch=function(objectToCheck){return RL.Object.containsAllProperties(objectToCheck,this.nameArray);}
this.update_fromString=function(string,callbackDict){var updateObj;try{updateObj=JSON.parse(string);}catch(ex){var error=new RL.Error('Error Parsing String','There was an error parsing the string into an object.')
error.consoleWarn('Error in "Update Storage from String": ');callbackDict.fail(error);return;}
var match=this.validateObjectMatch(updateObj);if(match){this.set_StorageObject(updateObj);callOnChanged_forAllStorageArrays();callbackDict.done();}else{var error=new RL.Error('String Missing Properties','The string provided did not contain all of correct properties.')
error.consoleWarn('Error in "Update Storage from String": ');callbackDict.fail(error);return;}}
this.get_ItemArray=function(name){var storageObj=this.get_StorageObject();if(storageObj){return storageObj[name];}else{return[];}}
this.generateKey=function(_prefix){var prefix=_prefix?_prefix+'_':'';var key=prefix+'a'+String(Date.now());return key;}
this.getItem=function(arrName,indexOrKey,_keyProp,_funcGetObj){var retObj=undefined;var retIndex=undefined;var searchArr;if(typeof arrName==="string"){var storageObj=this.get_StorageObject();searchArr=storageObj[arrName];}else if(RL.Type.isArray(arrName)){searchArr=arrName;}
if(searchArr){var getRetObj=function(index){if(_funcGetObj){return _funcGetObj(searchArr,index);}else{return searchArr[index];}}
if(RL.Number.isNumeric(indexOrKey)){var ii=Number(indexOrKey);if(ii<=searchArr.length-1){retObj=getRetObj(ii);retIndex=ii;}}else{for(var ii=0;ii<searchArr.length;ii+=1){var itemTmp=searchArr[ii];if(itemTmp[_keyProp]==indexOrKey){retObj=getRetObj(ii);retIndex=ii;break;}}}}
return{item:retObj,index:retIndex};}
this.deleteItem=function(arrName,index){var storageObj=this.get_StorageObject();var itemArr=storageObj[arrName];if(RL.Number.isNumeric(index)&&index<=itemArr.length-1){var item=itemArr[index];itemArr.splice(index,1);this.set_StorageObject(storageObj);return item;}}
this.clearArray=function(arrName){var storageObj=this.get_StorageObject();var itemArr=storageObj[arrName];storageObj[arrName]=[];this.set_StorageObject(storageObj);return itemArr;}
this.clearAll=function(){try{RL.LocalStorage.setItem(this.storageName,'');}catch(ex){return false;}
callOnChanged_forAllStorageArrays();return true;}
this.__createFromScratch=function(){var storageObj={};for(var ii=0;ii<this.nameArray.length;ii+=1){var name=this.nameArray[ii];storageObj[name]=[];}
this.set_StorageObject(storageObj);return storageObj;}
this.__ensureArraysExist=function(){var storageObj;var inputStr;try{inputStr=RL.LocalStorage.getItem(this.storageName);}catch(ex){__isLocalStorageDisabled=true;return undefined;}
if(inputStr){storageObj=JSON.parse(inputStr);if(storageObj){var needsUpdating=false;for(var ii=0;ii<this.nameArray.length;ii+=1){var name=this.nameArray[ii];var objArray=storageObj[name];if(!objArray){storageObj[name]=[];needsUpdating=true;}}
if(needsUpdating){this.set_StorageObject(storageObj);}}else{storageObj=this.__createFromScratch();}}else{storageObj=this.__createFromScratch();}
return storageObj;}}
RL.LocalStorage.StorageArray=function(storageObject,arrayName){RL.IDataStore.call(this);this.name=arrayName;this.__storageWorker=storageObject;this.__storageWorker.__storageArrays.push(this);this.onItemAdded=new RL.Subscription();this.onItemUpdated=new RL.Subscription();this.onItemDeleted=new RL.Subscription();Object.defineProperty(this,"isLocalStorageDisabled",{get:function(){return this.__storageWorker.isLocalStorageDisabled;}});this.getItemArray=function(){return this.__storageWorker.get_ItemArray(this.name);}
this.getDataArray=function(){return this.getItemArray();}
this.setItemArray=function(objArr){var inputObj=this.__storageWorker.get_StorageObject();inputObj[this.name]=objArr;this.__storageWorker.set_StorageObject(inputObj);this.call_onChangedEvent();}
this.clearItemArray=function(){this.__storageWorker.clearArray(this.name);this.call_onChangedEvent();}
this.get_StorageString=function(){var itemArr=this.getItemArray();return JSON.stringify(itemArr);}
this.update_FromString=function(string,callbackDict){var updateArr;try{updateArr=JSON.parse(string);}catch(ex){var error=new RL.Error('Error Parsing String','There was an error parsing the string into an object.')
error.consoleWarn('Error in "Update Storage Array from String": ');callbackDict.fail(error);return;}
this.setItemArray(updateArr);callbackDict.done();}
this.getItem=function(indexOrKey,_keyProp,_funcGetObj){var itemResults=this.__storageWorker.getItem(this.name,indexOrKey,_keyProp);var itemDic=itemResults.item;var itemIndex=itemResults.index;if(_funcGetObj){var retObj=undefined;if(itemDic){retObj=_funcGetObj(itemDic,itemIndex);}
return retObj;}else{return itemDic;}}
this.getItemIndex=function(key,keyProp){var itemResults=this.__storageWorker.getItem(this.name,key,keyProp);return itemResults.index;}
this.addItem=function(propDic){var inputObj=this.__storageWorker.get_StorageObject();var itemArr=inputObj[this.name];if(RL.Type.isArray(propDic)){for(var ii=0;ii<propDic.length;ii++){var item=propDic[ii];itemArr.push(item);}}else{itemArr.push(propDic);}
this.__storageWorker.set_StorageObject(inputObj);this.onItemAdded.callSubscribers(propDic);this.call_onChangedEvent();}
this.updateItem=function(index,propDic){var inputObj=this.__storageWorker.get_StorageObject();var itemArr=inputObj[this.name];if(RL.Number.isNumeric(index,false)&&index<=itemArr.length-1){var item=itemArr[index];var itemOld=RL.Object.copyProperties(item);var props=Object.keys(propDic);for(var ii=0;ii<props.length;ii+=1){var propName=props[ii];var value=propDic[propName];item[propName]=value;}
this.__storageWorker.set_StorageObject(inputObj);this.onItemUpdated.callSubscribers({itemNew:item,itemOld:itemOld});this.call_onChangedEvent();}}
this.deleteItem=function(index,_suppressCallEvent){var delItem=this.__storageWorker.deleteItem(this.name,index);if(delItem&&_suppressCallEvent!=true){var delArr=[delItem];this.__callSubscribers_Delete(delArr);}
return delItem;}
this.deleteWhere=function(propName,value,_suppressCallEvent){var delArr=[];var itemArr=this.getItemArray();for(var ii=itemArr.length-1;ii>=0;ii-=1){var item=itemArr[ii];if(item[propName]==value){var delItem=this.deleteItem(ii,true);if(delItem){delArr.push(delItem)};}}
if(delArr.length>0&&_suppressCallEvent!=true){this.__callSubscribers_Delete(delArr);}
return delArr;}
this.deleteAll=function(_suppressCallEvent){var delArr=this.__storageWorker.clearArray(this.name);if(delArr.length>0&&_suppressCallEvent!=true){this.__callSubscribers_Delete(delArr);}
return delArr;}
this.__callSubscribers_Delete=function(delArr){this.onItemDeleted.callSubscribers(delArr);this.call_onChangedEvent();}
this.generateKey=function(_prefix){return this.__storageWorker.generateKey(_prefix);}}
RL.LocalStorage.StorageDict=function(){}
RL.LocalStorage.StorageDict.save=function(storageName,inputObj){var replacer=function(key,value){if(value===undefined){value='';}
return value;}
var inputStr=JSON.stringify(inputObj,replacer);try{RL.LocalStorage.setItem(storageName,inputStr);}catch(ex){throw ex;}}
RL.LocalStorage.StorageDict.clear=function(storageName){try{RL.LocalStorage.setItem(storageName,'');return true;}catch(ex){return false;}}
RL.LocalStorage.StorageDict.getObject=function(storageName){var inputStr;try{inputStr=RL.LocalStorage.getItem(storageName);}catch(ex){return undefined;}
if(inputStr!=null&&inputStr!=''){return JSON.parse(inputStr);}else{return undefined;}}
RL.LocalStorage.StorageDict.dataExists=function(storageName){var inputStr;try{inputStr=RL.LocalStorage.getItem(storageName);}catch(ex){return false;}
return(inputStr!=null&&inputStr!='');}
RL.RefreshManager=function(lastRefreshName,daysToStale,funcCheckServerDate){var thisObj=this;this.lastRefreshName=lastRefreshName;this.daysToStale=daysToStale;this.funcCheckServerDate=funcCheckServerDate;var getLastRefresh=function(){var lastRefreshMS;try{lastRefreshMS=RL.LocalStorage.getItem(thisObj.lastRefreshName)||0;}catch(ex){return new RL.Date.now();}
return new RL.Date(lastRefreshMS);}
this.update=function(_dateRep){var dateValue;if(_dateRep){if(typeof(_dateRep)==="number"){dateValue=_dateRep;}else{var dateObj=new RL.Date(_dateRep);dateValue=dateObj.value;}}else{dateValue=Date.now();}
RL.LocalStorage.setItem(this.lastRefreshName,dateValue);}
this.needRefresh=function(){var now=Date.now();var lastRefreshDate=getLastRefresh();var serverLastUpdate=new RL.Date(this.funcCheckServerDate());if(lastRefreshDate.isBefore(serverLastUpdate)){return Math.max(now,serverLastUpdate.value);}
var dNeedRefresh=lastRefreshDate.addDays(this.daysToStale);if(dNeedRefresh.isBefore(now)){return now;}
return false;}}
RL.Cookies=function(){}
RL.Cookies.delete=function(name){document.cookie=name+"=; Path=/; Expires=Thu, 01 Jan 1970 00:00:00 UTC;";}
RL.Math=function(){}
RL.Math.interpolate=function(inputsDic){var pt1={x:inputsDic.x1,y:inputsDic.y1};var pt2={x:inputsDic.x2,y:inputsDic.y2};var x=inputsDic.x;var y=inputsDic.y;if(x!==undefined){return pt1.y+(pt2.y-pt1.y)*((x-pt1.x)/(pt2.x-pt1.x));}else if(y!==undefined){return pt1.x+(pt2.x-pt1.x)*((y-pt1.y)/(pt2.y-pt1.y));}else{return undefined;}}
RL.Math.getWithinRange=function(value,minRange,maxRange){return Math.max(Math.min(value,maxRange),minRange);}
RL.Math.linspace=function(start,end,num){var space=[];var delta=end-start;var step=delta/(num-1);for(var ii=0;ii<num;ii+=1){space[ii]=start+ii*step;}
return space;}
RL.Math.logspace=function(minExp,maxExp,num){var space=[];var expArr=RL.Math.linspace(minExp,maxExp,num)
for(var ii=0;ii<num;ii++){space[ii]=Math.pow(10,expArr[ii]);}
return space;}
RL.Math.log10=function(value,_options){var options=_options||{};var throwError=options.throwError===true?true:false;if(value<=0&&throwError){throw new Error('Log10 Error: Value must be positive!');}
return Math.log(value)/Math.log(10);}
RL.Math.ln=function(value){return Math.log(value);}
RL.Math.integrate=function(arr_x,arr_y){if(arr_x.length!==arr_y.length){throw new Error('Arrays must be same length!');}
var N=arr_x.length;var sum=0;for(var ii=1;ii<N;ii++){var x1=arr_x[ii-1];var x2=arr_x[ii];var y1=arr_y[ii-1];var y2=arr_y[ii];var A_trap=Math.abs(x2-x1)*(0.5*(y2+y1));sum+=A_trap;}
return sum;}
RL.Math.get_sumItems=function(array){var sum=0;for(var ii=0;ii<array.length;ii+=1){if(RL.Number.isNumeric(array[ii],true)){sum+=array[ii];}}
return sum;}
RL.Math.get_normalizedArray=function(array){var normArr=[];var sum=RL.Math.get_sumItems(array);for(var ii=0;ii<array.length;ii+=1){if(RL.Number.isNumeric(array[ii],true)){normArr[ii]=array[ii]/sum;}}
return normArr;}
RL.Math.get_geometricMean=function(array){var prod=1;for(var ii=0;ii<array.length;ii+=1){prod*=array[ii];}
return Math.pow(prod,1/array.length);}
RL.Math.getStatistics=function(array,_getter){var sum=0;var max=-1*Number.MAX_VALUE;var min=Number.MAX_VALUE;var sumSqr=0;for(var ii=0;ii<array.length;ii+=1){var value=array[ii];if(_getter!==undefined){value=_getter(value);}
sum+=value;max=Math.max(value,max);min=Math.min(value,min);sumSqr+=value*value;}
var avg=sum/array.length;var denom=array.length>=2?array.length-1:1;var variance=(sumSqr-array.length*(avg*avg))/denom;var stdDev=Math.sqrt(variance);return{sum:sum,avg:avg,max:max,min:min,variance:variance,stdDev:stdDev}}
RL.Matrix=function(numRows,numCols,initial){this.numRows=numRows;this.numCols=numCols;this.mat=[];this.__initialize=function(initial){this.mat=[];if(RL.Number.isNumeric(initial,true)){initial=Number(initial);}else{initial=0;}
var row;for(var ii=0;ii<this.numRows;ii+=1){row=[];for(var jj=0;jj<this.numCols;jj+=1){row[jj]=initial;}
this.mat[ii]=row;}}
this.__initialize(initial);this.times=function(other){return RL.Matrix.multiply(this,other);}
this.get_row=function(index){return RL.Array.copy(this.mat[index]);}
this.get_sumRowArr=function(){var sumArr=[];for(var ii=0;ii<this.numRows;ii+=1){var sumRow=0;for(var jj=0;jj<this.numCols;jj+=1){sumRow+=this.mat[ii][jj];}
sumArr[ii]=sumRow;}
return sumArr;}
this.toString=function(){var str='';for(var ii=0;ii<this.numRows;ii+=1){var rowStr='';for(var jj=0;jj<this.numCols;jj+=1){rowStr+=RL.Number.formatNumber(this.mat[ii][jj],3)+', ';}
rowStr=rowStr.slice(0,rowStr.length-2);str+=rowStr+'\n';}
return str;}
this.toHTMLString=function(){var htmlStr='<table cellspacing="10">';for(var ii=0;ii<this.numRows;ii+=1){htmlStr+='  <tr>';var rowStr='';for(var jj=0;jj<this.numCols;jj+=1){rowStr+='    <td style="padding:0 30px 0 0;">'+RL.Number.formatNumber(this.mat[ii][jj],3)+'</td>';}
htmlStr+=rowStr+'  </tr>';}
htmlStr+='</table>'
return htmlStr;}}
RL.Matrix.identity=function(size){var mat=new RL.Matrix(size,size,0);for(var ii=0;ii<size;ii+=1){mat.mat[ii][ii]=1;}
return mat;}
RL.Matrix.multiply=function(thing1,thing2){if(thing1 instanceof RL.Matrix&&thing2 instanceof RL.Matrix){return RL.Matrix.__multiplyMatMat(thing1,thing2);}else if(typeof thing1==="number"&&thing2 instanceof RL.Matrix){return RL.Matrix.__multiplyScalarMat(thing1,thing2);}else if(typeof thing2==="number"&&thing1 instanceof RL.Matrix){return RL.Matrix.__multiplyScalarMat(thing2,thing1);}else{console.warn('ERROR: Could not find a suitable multiplication method for matrix.')}}
RL.Matrix.__multiplyMatMat=function(mat1,mat2){if(mat1.numCols!==mat2.numRows){console.warn('ERROR: To multiply 2 matrices, the number of columns in the 1st matrix must equal the number of rows in the 2nd matrix.');return;}
var retMat=new RL.Matrix(mat1.numRows,mat2.numCols);for(var ii=0;ii<mat1.numRows;ii+=1){for(var jj=0;jj<mat2.numCols;jj+=1){var multSum=0;for(var cc=0;cc<mat1.numCols;cc+=1){multSum+=mat1.mat[ii][cc]*mat2.mat[cc][jj];}
retMat.mat[ii][jj]=multSum;}}
return retMat;}
RL.Matrix.__multiplyScalarMat=function(scalar,mat){var retMat=new RL.Matrix(mat.numRows,mat.numCols);for(var ii=0;ii<mat.numRows;ii+=1){for(var jj=0;jj<mat.numCols;jj+=1){retMat.mat[ii][jj]=scalar*mat.mat[ii][jj];}}
return retMat;}
RL.Vector2=function(x,y){this.x=x;this.y=y;}
Object.defineProperty(RL.Vector2.prototype,"length",{get:function(){return Math.sqrt(this.x*this.x+this.y*this.y);}});RL.Vector2.prototype.toString=function(){return'x: '+this.x+', y: '+this.y;}
RL.Vector2.prototype.plus=function(vect){return new RL.Vector2(this.x+vect.x,this.y+vect.y);}
RL.Vector2.prototype.minus=function(vect){return new RL.Vector2(this.x-vect.x,this.y-vect.y);}
RL.Vector2.prototype.times=function(scalar){return new RL.Vector2(this.x*scalar,this.y*scalar);}
RL.Vector2.prototype.divBy=function(scalar){return new RL.Vector2(this.x/scalar,this.y/scalar);}
RL.Vector2.prototype.pwMult=function(vect){return new RL.Vector2(this.x*vect.x,this.y*vect.y);}
RL.Vector2.prototype.dot=function(vect){return(this.x*vect.x)+(this.y*vect.y);}
RL.Vector2.prototype.scalarProjectionOnto=function(vect){var unitVect=vect.unitVector();return this.dot(unitVect);}
RL.Vector2.prototype.projectionOnto=function(vect){var unitVect=vect.unitVector();var a1=this.dot(unitVect);return unitVect.times(a1);}
RL.Vector2.prototype.normalProjectionOnto=function(vect){var projVect=this.projectionOnto(vect);return this.minus(projVect);}
RL.Vector2.prototype.angle=function(){return RL.Number.degrees(Math.atan2(this.y,this.x));}
RL.Vector2.prototype.angleTo=function(vect){return vect.angle()-this.angle();}
RL.Vector2.prototype.rotate=function(angle,_isRadians){var angleRad=_isRadians?angle:RL.Number.radians(angle);var x_new=this.x*Math.cos(angleRad)-this.y*Math.sin(angleRad);var y_new=this.x*Math.sin(angleRad)+this.y*Math.cos(angleRad);return new RL.Vector2(x_new,y_new);}
RL.Vector2.prototype.rotateAbout=function(point,angle,_isRadians){var v1=this.minus(point);var v2=v1.rotate(angle,_isRadians);var v3=v2.plus(point);return v3;}
RL.Vector2.prototype.interpolate=function(point,prop){var vDiff=this.minus(point).times(prop);return this.minus(vDiff);}
RL.Vector2.prototype.unitVector=function(vLength){vLength=Math.abs(vLength||1);if(this.length>0){var unitVect=this.divBy(this.length);return unitVect.times(vLength);}else{console.warn('WARNING: Zero-length vector.')
return this.copy();}}
RL.Vector2.prototype.isBasicallyVertical=function(_ratio){if(_ratio===undefined){_ratio=0.1;}
return Math.abs(this.x)<=_ratio*Math.abs(this.y);}
RL.Vector2.prototype.isBasicallyHorizontal=function(_ratio){if(_ratio===undefined){_ratio=0.1;}
return Math.abs(this.y)<=_ratio*Math.abs(this.x);}
RL.Vector2.prototype.copy=function(){return new RL.Vector2(this.x,this.y);}
RL.Vector2.prototype.isEqualTo=function(vect){return(this.x==vect.x&&this.y==vect.y);}
RL.Vector2.prototype.round=function(digits){return new RL.Vector2(RL.Number.round(this.x,digits),RL.Number.round(this.y,digits));}
RL.Vector2.add=function(){var x=0;var y=0;for(var ii=0;ii<arguments.length;ii+=1){var vect=arguments[ii];x+=vect.x;y+=vect.y;}
return new RL.Vector2(x,y);}
RL.Vector2_Array=function(){}
RL.Vector2_Array.getMaxMin=function(vectArr){var x_min=Number.MAX_VALUE;var x_max=-1*Number.MAX_VALUE;var y_min=Number.MAX_VALUE;var y_max=-1*Number.MAX_VALUE;for(var ii=0;ii<vectArr.length;ii+=1){var vect=vectArr[ii];x_min=Math.min(vect.x,x_min);x_max=Math.max(vect.x,x_max);y_min=Math.min(vect.y,y_min);y_max=Math.max(vect.y,y_max);}
return{min:new RL.Vector2(x_min,y_min),max:new RL.Vector2(x_max,y_max)};}
RL.Vector3=function(x,y,z){this.x=x;this.y=y;this.z=z;}
Object.defineProperty(RL.Vector3.prototype,"magnitude",{get:function(){return Math.sqrt((this.x*this.x)+(this.y*this.y)+(this.z*this.z));}});RL.Vector3.prototype.toString=function(){return'x: '+this.x+', y: '+this.y+', z: '+this.z;}
RL.Vector3.prototype.plus=function(vect){return new RL.Vector3(this.x+vect.x,this.y+vect.y,this.z+vect.z);}
RL.Vector3.prototype.minus=function(vect){return new RL.Vector3(this.x-vect.x,this.y-vect.y,this.z-vect.z);}
RL.Vector3.prototype.times=function(scalar){return new RL.Vector3(this.x*scalar,this.y*scalar,this.z*scalar);}
RL.Vector3.prototype.divBy=function(scalar){return new RL.Vector3(this.x/scalar,this.y/scalar,this.z/scalar);}
RL.Vector3.prototype.pwMult=function(vect){return new RL.Vector3(this.x*vect.x,this.y*vect.y,this.z*vect.z);}
RL.Vector3.prototype.dot=function(vect){return(this.x*vect.x)+(this.y*vect.y)+(this.z*vect.z);}
RL.Vector3.prototype.cross=function(vect){var x=this.y*vect.z-this.z*vect.y;var y=this.z*vect.x-this.x*vect.z;var z=this.x*vect.y-this.y*vect.x;return new RL.Vector3(x,y,z);}
RL.Vector3.prototype.scalarProjectionOnto=function(vect){var unitVect=vect.unitVector();return this.dot(unitVect);}
RL.Vector3.prototype.projectionOnto=function(vect){var unitVect=vect.unitVector();var a1=this.dot(unitVect);return unitVect.times(a1);}
RL.Vector3.prototype.normalProjectionOnto=function(vect){var projVect=this.projectionOnto(vect);return this.minus(projVect);}
RL.Vector3.prototype.unitVector=function(vMag){vMag=Math.abs(vMag||1);if(this.magnitude>0){var unitVect=this.divBy(this.magnitude);return unitVect.times(vMag);}else{console.warn('WARNING: Zero-length vector.')
return this.copy();}}
RL.Vector3.prototype.copy=function(){return new RL.Vector3(this.x,this.y,this.z);}
RL.Vector3.prototype.isEqualTo=function(vect){return(this.x==vect.x&&this.y==vect.y&&this.z==vect.z);}
RL.Vector3.prototype.round=function(digits){return new RL.Vector3(RL.Number.round(this.x,digits),RL.Number.round(this.y,digits),RL.Number.round(this.z,digits));}
RL.Vector3.add=function(){var x=0;var y=0;var z=0;for(var ii=0;ii<arguments.length;ii+=1){var vect=arguments[ii];x+=vect.x;y+=vect.y;z+=vect.z;}
return new RL.Vector3(x,y,z);}
RL.BaseUnitType=function(typeName,conversionDict,aliasDict,canonicalDict){this.typeName=typeName;this.conversionDict=conversionDict;this.aliasDict=RL.BaseUnitType.__processAliasDict(aliasDict,conversionDict);this.canonicalDict=canonicalDict;this.convert=function(value,unitFrom,unitTo){var valueCnv=RL.BaseUnitType.convert(value,unitFrom,unitTo,this.conversionDict,this.aliasDict);return valueCnv;}
this.isMatch=function(unitName){var arrNames;if(typeof unitName==='string'){arrNames=[unitName];}else{arrNames=unitName;}
var isMatch=true;for(var ii=0;ii<arrNames.length;ii++){var unitName=arrNames[ii];var inCnvDict=(this.conversionDict[unitName]!==undefined);var inAliasDict=(this.aliasDict[unitName.toLowerCase()]!==undefined);if(!inCnvDict&&!inAliasDict){isMatch=false;break;}}
return isMatch;}
this.getCanonicalName=function(unitName){var cName=undefined;unitName=unitName.toLowerCase();cName=this.canonicalDict[unitName];if(!cName){cName=this.aliasDict[unitName];}
return cName;}}
RL.BaseUnitType.convert=function(value,unitFrom,unitTo,conversionDict,aliasDict){function getConversionFactor(unitName,conversionDict,aliasDict){var cnvFct;if(conversionDict[unitName]!==undefined){cnvFct=conversionDict[unitName];}else if(aliasDict[unitName.toLowerCase()]!==undefined){var alias=aliasDict[unitName.toLowerCase()];cnvFct=conversionDict[alias];}else{throw new Error('Improper units specified!: From "'+unitFrom+'", To: "'+unitTo+'"');}
return cnvFct;}
var cnvFrom=getConversionFactor(unitFrom,conversionDict,aliasDict);var cnvTo=getConversionFactor(unitTo,conversionDict,aliasDict);var valBase=value/cnvFrom;var valueCnv=valBase*cnvTo;return valueCnv;}
RL.BaseUnitType.__processAliasDict=function(aliasDict,_conversionDict){if(_conversionDict!==undefined){var names=Object.keys(_conversionDict);for(var ii=0;ii<names.length;ii++){var namePrpr=names[ii];var nameLwr=namePrpr.toLowerCase();nameLwr=nameLwr.replace('*',' ');aliasDict[nameLwr]=namePrpr;}}
var names=Object.keys(aliasDict);for(var ii=0;ii<names.length;ii++){var nameOrig=names[ii];if(nameOrig.indexOf('[s]')!==-1){var nameSing=nameOrig.replace('[s]','');var namePlur=nameOrig.replace('[s]','s');var value=aliasDict[nameOrig];delete aliasDict[nameOrig];aliasDict[nameSing]=value;aliasDict[namePlur]=value;}}
var names=Object.keys(aliasDict);for(var ii=0;ii<names.length;ii++){var nameOrig=names[ii];if(nameOrig.indexOf(' ')!==-1){var value=aliasDict[nameOrig];var nameDash=nameOrig.replace(' ','-');var nameStar=nameOrig.replace(' ','*');aliasDict[nameDash]=value;aliasDict[nameStar]=value;}}
return aliasDict;}
RL.CustomUnitType=function(typeName,arrNames,aliasDict,canonicalDict,funcConvert){this.typeName=typeName;for(var ii=0;ii<arrNames.length;ii++){var namePrpr=arrNames[ii];var nameLwr=namePrpr.toLowerCase();aliasDict[nameLwr]=namePrpr;}
this.aliasDict=RL.BaseUnitType.__processAliasDict(aliasDict,undefined);this.canonicalDict=canonicalDict;this.convert=funcConvert;this.convert=function(value,unitFrom,unitTo){if(this.aliasDict[unitFrom.toLowerCase()]){unitFrom=this.aliasDict[unitFrom.toLowerCase()];}
if(this.aliasDict[unitTo.toLowerCase()]){unitTo=this.aliasDict[unitTo.toLowerCase()];}
var valueCnv=funcConvert(value,unitFrom,unitTo,this);return valueCnv;}
this.isMatch=function(unitName){var arrNames;if(typeof unitName==='string'){arrNames=[unitName];}else{arrNames=unitName;}
var isMatch=true;for(var ii=0;ii<arrNames.length;ii++){var unitName=arrNames[ii];var inAliasDict=(this.aliasDict[unitName.toLowerCase()]!==undefined);if(!inAliasDict){isMatch=false;break;}}
return isMatch;}
this.getCanonicalName=function(unitName){var cName=undefined;unitName=unitName.toLowerCase();cName=this.canonicalDict[unitName];if(!cName){cName=this.aliasDict[unitName];}
return cName;}}
RL.DerivedUnitType=function(typeName,unitBase1,relation,unitBase2,specialtyBase,specialtyConversionDict,aliasDict,canonicalDict){this.typeName=typeName;this.specialtyBase=specialtyBase;this.specialtyconversionDict=specialtyConversionDict;this.aliasDict=RL.BaseUnitType.__processAliasDict(aliasDict,specialtyConversionDict);this.canonicalDict=canonicalDict;var exp;var expStr;if(relation==='^'){exp=Number(unitBase2);expStr=String(unitBase2);var ub1=RL.unitTypeDict[unitBase1];var names=Object.keys(ub1.aliasDict);for(var ii=0;ii<names.length;ii++){var name=names[ii];var isSimple=(name.indexOf(' ')===-1)&&(name.indexOf('*')===-1)&&(name.indexOf('-')===-1);if(isSimple){var nameExp=name+exp;var value=name+'^'+exp;this.aliasDict[nameExp]=value;}}}
var splitParts=function(unitName){var parts=unitName.split(relation);if(parts.length==1&&relation==="*"){if(unitName.indexOf("-")!==-1){parts=unitName.split("-");}else if(unitName.indexOf(" ")!==-1){parts=unitName.split(" ");}}
if(parts.length>1){parts[0]=parts[0].trim();parts[1]=parts[1].trim();}
return parts;}
this.convert=function(value,unitFrom,unitTo){if(this.aliasDict[unitFrom.toLowerCase()]){unitFrom=this.aliasDict[unitFrom.toLowerCase()];}
if(this.aliasDict[unitTo.toLowerCase()]){unitTo=this.aliasDict[unitTo.toLowerCase()];}
var from=splitParts(unitFrom);var from1=from[0];var from2=from.length>1?from[1]:undefined;var to=splitParts(unitTo);var to1=to[0];var to2=to.length>1?to[1]:undefined;var cnvIntr=1;var isIntFrom=(from2===undefined)||(this.specialtyconversionDict[unitFrom]!==undefined);var isIntTo=(to2===undefined)||(this.specialtyconversionDict[unitTo]!==undefined);if(isIntFrom){from=splitParts(this.specialtyBase);from1=from[0];from2=from[1];cnvIntr=RL.BaseUnitType.convert(1,unitFrom,this.specialtyBase,this.specialtyconversionDict,this.aliasDict);}
if(isIntTo){to=splitParts(this.specialtyBase);to1=to[0];to2=to[1];var cnvIntrTo=RL.BaseUnitType.convert(1,this.specialtyBase,unitTo,this.specialtyconversionDict,this.aliasDict);cnvIntr*=cnvIntrTo;}
var cnvFct;if(relation==="*"){var ub1=RL.unitTypeDict[unitBase1];var ub2=RL.unitTypeDict[unitBase2];var fixOrdering=function(part1,part2){var part1_fix;var part2_fix;if(ub1.isMatch(part1)){part1_fix=part1;part2_fix=part2;}else if(ub2.isMatch(part1)){part1_fix=part2;part2_fix=part1;}
return[part1_fix,part2_fix];}
var fromParts=fixOrdering(from1,from2);from1=fromParts[0];from2=fromParts[1];var toParts=fixOrdering(to1,to2);to1=toParts[0];to2=toParts[1];var cnv1=ub1.convert(1,from1,to1);var cnv2=ub2.convert(1,from2,to2);cnvFct=cnv1*cnv2;}else{var ub1=RL.unitTypeDict[unitBase1];var cnv1=ub1.convert(1,from1,to1);if(relation==="^"){cnvFct=Math.pow(cnv1,exp);}else if(relation==="/"){var ub2=RL.unitTypeDict[unitBase2];var cnv2=ub2.convert(1,from2,to2);cnvFct=cnv1/cnv2;}}
cnvFct*=cnvIntr;var valueCnv=value*cnvFct;return valueCnv;}
this.isMatch=function(unitName){var arrNames;if(typeof unitName==='string'){arrNames=[unitName];}else{arrNames=unitName;}
var isMatch=true;for(var ii=0;ii<arrNames.length;ii++){var unitName=arrNames[ii];var inCnvDict=(this.specialtyconversionDict[unitName]!==undefined);var inAliasDict=(this.aliasDict[unitName.toLowerCase()]!==undefined)
if(!inCnvDict&&!inAliasDict){var parts=splitParts(unitName);if(parts.length>1){if(relation==="*"){var part1=parts[0];var ub1=RL.unitTypeDict[unitBase1];var part2=parts[1];var ub2=RL.unitTypeDict[unitBase2];var matchTmp=(ub1.isMatch(part1)&&ub2.isMatch(part2))||(ub1.isMatch(part2)&&ub2.isMatch(part1));if(!matchTmp){isMatch=false;}}else{var match1;var part1=parts[0];var ub1=RL.unitTypeDict[unitBase1];var match1=ub1.isMatch(part1);var part2=parts[1];var match2;if(relation==="^"){match2=(part2===expStr);}else if(relation==="/"){var ub2=RL.unitTypeDict[unitBase2];match2=ub2.isMatch(part2);}
if(!match1||!match2){isMatch=false;}}}else{isMatch=false;}
if(!isMatch){break;}}}
return isMatch;}
this.getCanonicalName=function(unitName){var cName=undefined;unitName=unitName.toLowerCase();cName=this.canonicalDict[unitName];if(!cName){if(this.aliasDict[unitName]){unitName=this.aliasDict[unitName];}
var namePrts=splitParts(unitName);if(namePrts.length>1){var part1=namePrts[0];var part2=namePrts.length>1?namePrts[1]:undefined;if(relation==="*"||relation==="/"){var ub1=RL.unitTypeDict[unitBase1];var ub2=RL.unitTypeDict[unitBase2];if(ub1.isMatch(part1)){part1=ub1.getCanonicalName(part1);part2=ub2.getCanonicalName(part2);}else if(ub2.isMatch(part1)){part1=ub2.getCanonicalName(part1);part2=ub1.getCanonicalName(part2);}
cName=part1+relation+part2;}else if(relation==="^"){var ub1=RL.unitTypeDict[unitBase1];cName=ub1.getCanonicalName(part1)+'^'+exp;}}else{cName=unitName;}}
return cName;}}
RL.unitTypeDict={};RL.unitTypeDict.time=new RL.BaseUnitType('time',{s:1,min:1/60,hr:1/3600,ms:1000,day:1/(3600*24),week:1/(3600*24*7),fortnight:1/(3600*24*14),month:12/(3600*24*365),year:1/(3600*24*365.25)},{'sec[s]':'s','second[s]':'s','millisecond[s]':'ms',mins:'min','minute[s]':'min',hrs:'hr','hour[s]':'hr',days:'day',weeks:'week',months:'month',years:'year'},{sec:'sec'});RL.unitTypeDict.force=new RL.BaseUnitType('force',{lbf:1,kip:1/1000,ton:1/2000,LT:1/2240,N:4.4482216152605,kN:0.0044482216152605,dyn:1e5*4.4482216152605,kgf:0.45359237,gf:453.59237},{'lb[s]':'lbf','pound[s]':'lbf',kips:'kip',tons:'ton','short ton[s]':'ton',lts:'LT','long ton[s]':'LT','newton[s]':'N','kilonewton[s]':'kN','kilogram force':'kgf','gram force':'gf',dyns:'dyn','dyne[s]':'dyn'},{});RL.unitTypeDict.mass=new RL.BaseUnitType('mass',{lbm:1,slug:1/32.1740485564304,oz:16,ton:1/2000,LT:1/2240,kg:0.45359237,gm:453.59237,mg:453592.37,tonne:4.5359237e-4},{'lb[s]':'lbm','pound[s]':'lbm','ounce[s]':'oz',tons:'ton','short ton[s]':'ton',lts:'LT','long ton[s]':'LT',kgs:'kg','kilogram[s]':'kg',g:'gm',gms:'gm','gram[s]':'gm','grame[s]':'gm','milligram[s]':'mg',tonnes:'tonne'},{});RL.unitTypeDict.length=new RL.BaseUnitType('length',{ft:1,in:12,mil:12*1000,yd:1/3,mi:1/5280,NM:1/6076.1154855643,fur:1/660,m:0.3048,cm:30.48,mm:304.8,km:3.048e-4},{feet:'ft',foot:'ft',inch:'in',inches:'in',yds:'yd','yard[s]':'yd',mis:'mi','mile[s]':'mi','nautical mile[s]':'NM','nmi':'NM',furs:'fur','furlong[s]':'fur','meter[s]':'m','centimeter[s]':'cm','millimeter[s]':'mm','kilometer[s]':'km','klick[s]':'km'},{nmi:'nmi'});RL.unitTypeDict.angle=new RL.BaseUnitType('angle',{rad:1,deg:180/Math.PI,rev:1/(2*Math.PI)},{'radian[s]':'rad','degree[s]':'deg','revolution[s]':'rev','cycle[s]':'rev'},{});RL.unitTypeDict.absoluteViscosity=new RL.BaseUnitType('absoluteViscosity',{cP:1,P:0.01,'Pa*s':0.001,'kg/(m*s)':0.001,'lbf*s/ft^2':1/47880.2589803358,'lbm/(ft*s)':1/1488.16394356955,reyn:1/6894757.29},{centipoise:'cP',poise:'P','slug/(ft*s)':'lbf*s/ft^2','lbf*s/ft2':'lbf*s/ft^2','n s/m2':'Pa*s','n s/m^2':'Pa*s'},{});RL.unitTypeDict.moment=new RL.DerivedUnitType('moment','force','*','length','',{},{nm:'N*m',nmm:'N*mm'},{});RL.unitTypeDict.velocity=new RL.DerivedUnitType('velocity','length','/','time','ft/s',{'ft/s':1,kts:1/1.6878098571012,mach:0.3048/343,c:0.3048/299792458},{'knot[s]':'kts',kt:'kts',kn:'kts',fps:'ft/s',mps:'m/s',mph:'mile/hr',kph:'km/hr'},{kt:'kt',kn:'kn',fps:'fps',mps:'mps',mph:'mph',kph:'kph'});RL.unitTypeDict.acceleration=new RL.DerivedUnitType('acceleration','length','/','timeSquared','ft/s^2',{'ft/s^2':1,g:1/32.1740485564304},{gravity:'g',grav:'g'},{});RL.unitTypeDict.angularVelocity=new RL.DerivedUnitType('angularVelocity','angle','/','time','rad/s',{'rad/s':1,rpm:60/(2*Math.PI),Hz:1/(2*Math.PI),kHz:1/(1000*2*Math.PI),MHz:1/(1e6*2*Math.PI),GHz:1/(1e9*2*Math.PI)},{hertz:'Hz','cycle[s]/s':'Hz','cycle[s]/min':'rpm'},{});RL.unitTypeDict.area=new RL.DerivedUnitType('area','length','^',2,'ft^2',{'ft^2':1,acre:1/43560,hectare:Math.pow(0.3048,2)/10000},{},{});RL.unitTypeDict.inertiaArea=new RL.DerivedUnitType('inertiaArea','length','^',4,'',{},{},{});RL.unitTypeDict.volume=new RL.DerivedUnitType('volume','length','^',3,'ft^3',{'ft^3':1,gal:7.48051911690897,pt:8*7.48051911690897,qt:4*7.48051911690897,L:28.316846592,mL:28316.846592,'fl oz':957.506446964348},{'cubic foot':'ft^3','cubic feet':'ft^3','cu ft':'ft^3',cc:'cm^3','cubic centimeter[s]':'cm^3','gallon[s]':'gal',pts:'pt','pint[s]':'pt','pnt[s]':'pt',qts:'qt','quart[s]':'qt','qrt[s]':'qt','liter[s]':'L','fluid oz':'fl oz','fluid ounce[s]':'fl oz'},{cc:'cc'});RL.unitTypeDict.sectionMod=new RL.DerivedUnitType('sectionMod','length','^',3,'',{},{},{});RL.unitTypeDict.flowRate=new RL.DerivedUnitType('flowRate','volume','/','time','',{},{gpm:'gal/min',gps:'gal/sec',lpm:'L/min',lps:'L/sec'},{gpm:'gpm',gps:'gps',lpm:'lpm',lps:'lps'});RL.unitTypeDict.density=new RL.DerivedUnitType('density','mass','/','volume','',{},{},{});RL.unitTypeDict.massInertia=new RL.DerivedUnitType('massInertia','mass','*','area','',{},{},{});RL.unitTypeDict.distForce=new RL.DerivedUnitType('distForce','force','/','length','',{},{},{});RL.unitTypeDict.pressure=new RL.DerivedUnitType('pressure','force','/','area','lbf/in^2',{'lbf/in^2':1,ksi:0.001,Pa:6894.75729316836,kPa:6.89475729316836,MPa:6.89475729316836e-3,GPa:6.89475729316836e-6,atm:1/14.6959487755135,bar:1/14.5037737730209,mmHg:6894.75729316836/133.3224,cmHg:6894.75729316836/(10*133.3224),inHg:6894.75729316836/(25.4*133.3224),mmH2O:6894.75729316836/9.80665,cmH2O:6894.75729316836/(10*9.80665),inH2O:6894.75729316836/(25.4*9.80665)},{psi:'lbf/in^2',psf:'lbf/ft^2','pascal[s]':'Pa','kilopascal[s]':'kPa','megapascal[s]':'MPa','atmosphere[s]':'atm',bars:'bar','in hg':'inHg','mm hg':'mmHg','cm hg':'cmHg','in h2o':'inH2O','mm h2o':'mmH2O','cm h2o':'cmH2O'},{psi:'psi',psf:'psf'});RL.unitTypeDict.stress=new RL.DerivedUnitType('stress','force','/','area','lbf/in^2',{'lbf/in^2':1,ksi:0.001,Pa:6894.75729316836,kPa:6.89475729316836,MPa:6.89475729316836e-3,GPa:6.89475729316836e-6},{psi:'lbf/in^2',psf:'lbf/ft^2','pascal[s]':'Pa','kilopascal[s]':'kPa','megapascal[s]':'MPa'},{psi:'psi',psf:'psf'});RL.unitTypeDict.stressIntensity=new RL.DerivedUnitType('stressIntensity','stress','*','lengthSqrt','',{},{'ksi sqrt(in)':'ksi*in^0.5','psi sqrt(in)':'psi*in^0.5','mpa sqrt(m)':'MPa*m^0.5','mpa sqrt(mm)':'MPa*mm^0.5'},{});RL.unitTypeDict.energy=new RL.DerivedUnitType('energy','force','*','length','ft*lbf',{'ft*lbf':1,btu:1.28506746345658e-3,J:1.3558179483314,kJ:1.3558179483314e-3,'W*hr':1/2655.22373739816,'kW*hr':1/2655223.73739816,'cal':0.323831553532865,'kcal':3.23831553532865e-4,eV:8.462350392270282e18},{'joule[s]':'J','kilojoule[s]':'kJ','w hrs':'W*hr','watt hour[s]':'W*hr','kilowatt hour[s]':'kW*hr','electron volt[s]':'eV'},{});RL.unitTypeDict.power=new RL.DerivedUnitType('power','energy','/','time','ft*lbf/s',{'ft*lbf/s':1,hp:1/550,W:1/0.737562149277265,kW:1/737.562149277265},{'horsepower[s]':'hp','watt[s]':'W','kilowatt[s]':'kW'},{});RL.unitTypeDict.decibels=new RL.CustomUnitType('decibels',['mag','dB'],{'magnitude':'mag','decibel[s]':'dB'},{},function(value,unitFrom,unitTo,thisObj){var valueCnv;if(unitFrom==='mag'&&unitTo==='dB'){var mag=value;valueCnv=20*Math.log10(mag);}else if(unitFrom==='dB'&&unitTo==='mag'){var db=value;valueCnv=Math.pow(10,(db/20));}else if(unitFrom==unitTo){valueCnv=1;}
return valueCnv;});RL.unitTypeDict.temperature=new RL.CustomUnitType('temperature',['deg F','deg C','K','deg R'],{'degf':'deg F','deg f':'deg F','degree[s] f':'deg F','degree[s] fahrenheit':'deg F','fahrenheit':'deg F','f':'deg F','degc':'deg C','deg c':'deg C','degree[s] c':'deg C','degree[s] celsius':'deg C','celsius':'deg C','c':'deg C','degk':'K','deg k':'K','degree[s] k':'K','degree[s] kelvin':'K','kelvin':'K','k':'K','degr':'deg R','deg r':'deg R','degree[s] r':'deg R','degree[s] rankine':'deg R','rankine':'deg R','r':'deg R'},{},function(value,unitFrom,unitTo,thisObj){function degC2F(C){return(9/5)*C+32;}
function degK2F(K){return(9/5)*K-459.67;}
function degR2F(R){return R-459.67;}
function degF2C(F){return(5/9)*(F-32);}
function degF2K(F){return(5/9)*(F+459.67);}
function degF2R(F){return F+459.67;}
var degF;if(unitFrom==='deg F'){degF=value;}else if(unitFrom==='deg C'){degF=degC2F(value);}else if(unitFrom==='K'){degF=degK2F(value);}else if(unitFrom==='deg R'){degF=degR2F(value);}
var valueCnv;if(unitTo==='deg F'){valueCnv=degF;}else if(unitTo==='deg C'){valueCnv=degF2C(degF);}else if(unitTo==='K'){valueCnv=degF2K(degF);}else if(unitTo==='deg R'){valueCnv=degF2R(degF);}
return valueCnv;});RL.unitTypeDict.kinematicViscosity=new RL.CustomUnitType('kinematicViscosity',['cSt','ft^2/s','in^2/s','m^2/s','mm^2/s','SSU'],{'centistoke[s]':'cSt','ft2/s':'ft^2/s','in2/s':'in^2/s','m2/s':'m^2/s','mm2/s':'mm^2/s'},{},function(value,unitFrom,unitTo,thisObj){var conversionDict={cSt:1,'ft^2/s':1.0764e-5,'in^2/s':144*(1.0764e-5),'m^2/s':1e-6,'mm^2/s':1};var valueCnv;if(unitFrom==='SSU'&&unitTo==='SSU'){valueCnv=value;}else if(unitFrom==='SSU'){var cS;var ssu=value;if(ssu<32){cS=undefined;}else if(ssu>=32&&ssu<100){cS=0.2253*ssu-194.4/ssu;}else if(ssu>=100&&ssu<240){cS=0.2193*ssu-134.6/ssu;}else if(ssu>=240){cS=ssu/4.635;}
if(cS!==undefined){value=cS;unitFrom='cSt';valueCnv=RL.BaseUnitType.convert(value,unitFrom,unitTo,conversionDict,thisObj.aliasDict);}}else if(unitTo==='SSU'){var cS=RL.BaseUnitType.convert(value,unitFrom,'cSt',conversionDict,thisObj.aliasDict);var ssu;if(cS<1.135){ssu=undefined;}else if(cS>=1.135&&cS<20.584){ssu=(cS+Math.sqrt(Math.pow(cS,2)+4*0.2253*194.4))/(2*0.2253);}else if(cS>=20.584&&cS<51.78){ssu=(cS+Math.sqrt(Math.pow(cS,2)+4*0.2193*134.6))/(2*0.2193);}else if(cS>=51.78){ssu=cS*4.635;}
valueCnv=ssu;}else{valueCnv=RL.BaseUnitType.convert(value,unitFrom,unitTo,conversionDict,thisObj.aliasDict);}
return valueCnv;});RL.unitTypeDict.timeSquared=new RL.DerivedUnitType('timeSquared','time','^',2,'',{},{},{});RL.unitTypeDict.lengthSqrt=new RL.DerivedUnitType('lengthSqrt','length','^',0.5,'',{},{},{});RL.unitTypeDict.get=function(unitName){var unitType=undefined;var unitKeys=Object.keys(RL.unitTypeDict);for(var ii=0;ii<unitKeys.length;ii++){var key=unitKeys[ii];var unitTypeTmp=RL.unitTypeDict[key];if(typeof unitTypeTmp!=='object'){break;}
var isMatch=unitTypeTmp.isMatch(unitName);if(isMatch){unitType=unitTypeTmp;break;}}
return unitType;}
RL.Unit=function(value,_unitName,_options){if(typeof _unitName==='object'&&_options===undefined){_options=_unitName;_unitName=undefined;}
var options=_options||{};var typeName=options.typeName||undefined;var handleStringValue=function(value){var isComma=(value.indexOf(',')!==-1);var isDot=(value.indexOf('.')!==-1);if(isDot&&isComma){value=RL.String.replaceAll(value,',','');}else if(isComma){var numCommas=RL.String.countInstances(value,',');if(numCommas>1){value=RL.String.replaceAll(value,',','');}else{var parts=value.split(',');var part2=parts[1];if(part2.length===3){value=value.replace(',','');}else{value=value.replace(',','.');}}}
value=Number(value);return value;}
var unitType;var unitName;var unitStr;if(typeof value==='number'&&typeof _unitName==='string'){unitName=_unitName;unitStr=String(value)+' '+_unitName;}else if(typeof value==='string'&&_unitName===undefined){unitStr=value;var delimIndex=unitStr.indexOf(' ');if(delimIndex!==-1){unitName=unitStr.slice(delimIndex+1,unitStr.length).trim();}else{for(var ii=0;ii<unitStr.length;ii++){var char=unitStr[ii];var isNum=(!isNaN(char))||(char==='-')||(char==='+')||(char==='.')||(char===',');if(!isNum){delimIndex=ii;break;}}
unitName=unitStr.slice(delimIndex,unitStr.length).trim();}
value=unitStr.slice(0,delimIndex);value=handleStringValue(value);}
var errMsg='';var errMsg_basic='Unable to initialize Unit object: "'+unitStr+'"';if(isNaN(value)){errMsg=errMsg_basic;}
if(typeName){unitType=RL.unitTypeDict[typeName];if(unitType===undefined){errMsg='Unable to initialize Unit object -- specified type name is invalid: '+typeName;}else if(!unitType.isMatch(unitName)){errMsg='Unable to initialize Unit object -- type name does not match unit name: '+unitStr+', type: '+typeName;}}else if(unitName){unitType=RL.unitTypeDict.get(unitName);if(unitType!==undefined){typeName=unitType.typeName;}}
if(unitType===undefined&&errMsg===''){errMsg=errMsg_basic;}
if(errMsg){throw new Error(errMsg);}
unitName=unitType.getCanonicalName(unitName);Object.defineProperty(this,"value",{get:function(){return value;}});Object.defineProperty(this,"unitName",{get:function(){return unitName;}});Object.defineProperty(this,"typeName",{get:function(){return typeName;}});Object.defineProperty(this,"unitType",{get:function(){return unitType;}});}
RL.Unit.prototype.copy=function(){return new RL.Unit(this.value,this.unitName,{typeName:this.typeName});}
RL.Unit.prototype.toUnit=function(unitName){var value=this.toNumber(unitName);return new RL.Unit(value,unitName);}
RL.Unit.prototype.toString=function(_options){var options=_options||{};var sigDigits=options.sigDigits;var digits=options.digits;var formatFunc=(options.formatFunc===undefined)?RL.Number.format_Round:options.formatFunc;var value=this.value;if(sigDigits!==undefined||digits!==undefined){var options={digits:digits,sigDigits:sigDigits,pad:false};value=formatFunc(value,options);}
return value+' '+this.unitName;}
RL.Unit.prototype.toRoundStr=function(){return this.toString({digits:8,formatFunc:RL.Number.format_Round});}
RL.Unit.prototype.toFormattedNumber=function(_options){var options=_options||{};var unitName=options.unitName||this.unitName;var formatFunc=(options.formatFunc===undefined)?RL.Number.format_General:options.formatFunc;var value=this.toNumber(unitName);return formatFunc(value,options)}
RL.Unit.prototype.toNumber=function(unitName){var unitType=this.unitType;var value=unitType.convert(this.value,this.unitName,unitName)
return value;}
RL.Unit.prototype.convert=function(unitName){return this.toNumber(unitName);}
RL.Unit.prototype.toHTML=function(_input){var unitName;var options;if(typeof _input==="string"){unitName=_input;options={'unitName':unitName};}else{_input=_input||{};unitName=_input.unitName||this.unitName;options=_input;}
var value=this.toFormattedNumber(options);unitName=RL.Unit.getUnitNameHTML(unitName);return value+'&nbsp;'+unitName;}
RL.Unit.prototype.toJSON=function(){return{value:this.value,unit:this.unitName};}
RL.Unit.convert=function(value,unitFrom,unitTo,_typeName){var unitType;if(_typeName){unitType=RL.unitTypeDict[_typeName];}else{unitType=RL.unitTypeDict.get([unitFrom,unitTo]);}
if(unitType){var valueCnv=unitType.convert(value,unitFrom,unitTo);return valueCnv;}else{throw new Error('Improper units specified!: From "'+unitFrom+'", To: "'+unitTo+'"');}}
RL.Unit.tryGet=function(value,_options){if(value instanceof RL.Unit){return value;}else{try{var unit=new RL.Unit(value,undefined,_options);return unit;}catch(ex){return undefined;}}}
RL.Unit.getUnitNameHTML=function(unitName){var finished=false;while(finished!==true){if(unitName.indexOf('^')===-1){finished=true;}else{var index=unitName.indexOf('^');var firstPart=unitName.slice(0,index);var secondPart=unitName.slice(index+1,unitName.length);var thirdPart='';var temp=RL.String.replaceAll(secondPart,[' ','^','*','/','+','-','(',')'],'&');if(temp.indexOf('&')!==-1){var tmpIndex=temp.indexOf('&');thirdPart=secondPart.slice(tmpIndex,secondPart.length);secondPart=secondPart.slice(0,tmpIndex);}
unitName=firstPart+'<sup>'+secondPart+'</sup>'+thirdPart;}}
return unitName;}
RL.Unit.convertArray_toUnit=function(arr,unitName,_options){var retArr=[];for(var ii=0;ii<arr.length;ii++){retArr[ii]=new RL.Unit(arr[ii],unitName,_options);}
return retArr;}
RL.Unit.convertArray_betweenUnits=function(arr,unitNameFrom,unitNameTo){var retArr=[];for(var ii=0;ii<arr.length;ii++){var value=arr[ii];if(value!==undefined&&value!==null){retArr[ii]=new RL.Unit(value,unitNameFrom).toNumber(unitNameTo);}else{retArr[ii]=value;}}
return retArr;}
RL.Unit.convertStruct_toNumber=function(struct,typeGroupObj){if(!(typeGroupObj instanceof RL.Unit.TypeGroup)){console.error('Unit Error: Must enter a TypeGroup object!');return;}
if(struct instanceof RL.Unit){var warnMsg='';if(struct.typeName){var unitsTo=typeGroupObj.unitDic[struct.typeName];if(unitsTo){struct=struct.toNumber(unitsTo);}else{warnMsg='Warning -- Unit Convert Struct: Type "'+struct.typeName+'" not found in TypeGroup';}}else{warnMsg='Warning -- Unit Convert Struct: No type name specified';}
if(warnMsg){console.warn(warnMsg);}}else if(struct instanceof Array){for(var ii=0;ii<struct.length;ii++){var value=struct[ii];struct[ii]=RL.Unit.convertStruct_toNumber(value,typeGroupObj);}}else if(struct instanceof RL.Vector2){struct.x=RL.Unit.convertStruct_toNumber(struct.x,typeGroupObj);struct.y=RL.Unit.convertStruct_toNumber(struct.y,typeGroupObj);}else if(RL.Type.isObject(struct)){var props=Object.keys(struct);for(var ii=0;ii<props.length;ii++){var name=props[ii];var value=struct[name];if(typeof(value)!=='function'){struct[name]=RL.Unit.convertStruct_toNumber(value,typeGroupObj);}}}
return struct;}
RL.Unit.TypeGroup=function(){var thisObj=this;this.__defaultUnits=undefined;this.update=function(updateDic){RL.Object.forEach(updateDic,function(name,value){if(name in thisObj.__defaultUnits){thisObj.__defaultUnits[name]=value;}});}
Object.defineProperty(this,"unitDic",{get:function(){return this.__defaultUnits;},configurable:true});}
RL.Unit.TypeGroup.Custom=function(){RL.Unit.TypeGroup.call(this);this.type='Custom';this.__storageName='userCustomUnits';Object.defineProperty(this,"unitDic",{get:function(){var defaultUnits=this.__defaultUnits;var storedUnits;try{storedUnits=RL.LocalStorage.getItem(this.__storageName);}catch(ex){return defaultUnits;}
if(storedUnits){storedUnits=JSON.parse(storedUnits);var returnUnits={};RL.Object.forEach(defaultUnits,function(propName,defaultValue){returnUnits[propName]=storedUnits[propName]||defaultValue;});return returnUnits;}else{return defaultUnits;}}});this.update=function(updateDic){var uDic=this.unitDic;RL.Object.forEach(updateDic,function(propName,value){if(propName in uDic){uDic[propName]=value;}});var unitJSON=JSON.stringify(uDic);try{RL.LocalStorage.setItem(this.__storageName,unitJSON);}catch(ex){throw ex;}}
this.__defaultUnits={'length':'in','area':'in^2','volume':'in^3','angle':'deg','sectionMod':'in^3','inertiaArea':'in^4','force':'lbf','moment':'in*lbf','distForce':'lbf/in','stress':'psi','elasticMod':'psi','density':'lbm/in^3','stressIntensity':'psi*in^0.5'}}
RL.Unit.TypeGroup.Custom.prototype=Object.create(RL.Unit.TypeGroup.prototype);RL.Unit.TypeGroup.Server=function(){RL.Unit.TypeGroup.call(this);this.type='Server';this.update=function(){console.error('Server units cannot be updated!!!');}
this.__defaultUnits={'length':'in','area':'in^2','volume':'in^3','angle':'deg','sectionMod':'in^3','inertiaArea':'in^4','force':'lbf','moment':'in*lbf','distForce':'lbf/in','stress':'psi','elasticMod':'psi','density':'lbm/in^3','stressIntensity':'psi*in^0.5'}}
RL.Unit.TypeGroup.Server.prototype=Object.create(RL.Unit.TypeGroup.prototype);RL.Unit.TypeGroup.English=function(){RL.Unit.TypeGroup.call(this);this.type='English';this.__defaultUnits={'length':'in','area':'in^2','volume':'in^3','angle':'deg','sectionMod':'in^3','inertiaArea':'in^4','force':'lbf','moment':'in*lbf','distForce':'lbf/in','stress':'psi','elasticMod':'psi','density':'lbm/in^3','stressIntensity':'ksi*in^0.5'}}
RL.Unit.TypeGroup.English.prototype=Object.create(RL.Unit.TypeGroup.prototype);RL.Unit.TypeGroup.SI=function(){RL.Unit.TypeGroup.call(this);this.type='SI';this.__defaultUnits={'length':'m','area':'cm^2','volume':'cm^3','angle':'deg','sectionMod':'cm^3','inertiaArea':'cm^4','force':'N','moment':'N*m','distForce':'N/m','stress':'MPa','elasticMod':'GPa','density':'g/cm^3','stressIntensity':'MPa*m^0.5'}}
RL.Unit.TypeGroup.SI.prototype=Object.create(RL.Unit.TypeGroup.prototype);RL.Unit.SavedUnitsWorker=function(storageName){this.__storageName=storageName;this.defaultBase='Custom';var _unitsCustom=undefined;Object.defineProperty(this,"__unitsCustomRef",{get:function(){if(_unitsCustom===undefined){_unitsCustom=new RL.Unit.TypeGroup.Custom();}
return _unitsCustom;}});var _unitsEnglish=undefined;Object.defineProperty(this,"__unitsEnglishRef",{get:function(){if(_unitsEnglish===undefined){_unitsEnglish=new RL.Unit.TypeGroup.English();}
return _unitsEnglish;}});var _unitsSI=undefined;Object.defineProperty(this,"__unitsSIRef",{get:function(){if(_unitsSI===undefined){_unitsSI=new RL.Unit.TypeGroup.SI();}
return _unitsSI;}});this.save=function(unitBaseName){if(unitBaseName==='Custom'||unitBaseName==='English'||unitBaseName==='SI'){try{RL.LocalStorage.setItem(this.__storageName,unitBaseName);}catch(ex){throw ex;}}else{console.error('Cannot save preferred units -- improper call');}}
this.getUnitBase=function(){try{return RL.LocalStorage.getItem(this.__storageName)||this.defaultBase;}catch(ex){return this.defaultBase;}}}
RL.Unit.SavedUnitsWorker.prototype.getTypeGroupObj=function(){var unitBase=this.getUnitBase();if(unitBase==='Custom'){return this.__unitsCustomRef;}else if(unitBase==='English'){return this.__unitsEnglishRef;}else if(unitBase==='SI'){return this.__unitsSIRef;}}
RL.Unit.SavedUnitsWorker.prototype.getTypeDic=function(){var typeGroup=this.getTypeGroupObj();return typeGroup.unitDic;}
RL.Document=function(){}
RL.Document.isLoaded_DOM=function(){return document.readyState==="interactive"||document.readyState==="complete";}
RL.Document.isLoaded_Complete=function(){return document.readyState==="complete";}
RL.Document.getHeight=function(){var doc=document;return Math.max(doc.body.scrollHeight,doc.documentElement.scrollHeight,doc.body.offsetHeight,doc.documentElement.offsetHeight,doc.body.clientHeight,doc.documentElement.clientHeight);}
RL.Document.navigateToURL=function(url){document.location.href=url;}
RL.Document.isExternalURL=function(url){return url&&url.lastIndexOf('http',0)==0&&url.lastIndexOf(window.location.host)==-1;}
RL.Document.getLocalStyleSheets=function(){var sheetsArr=[];var sheets=document.styleSheets;for(var ii=0;ii<sheets.length;ii+=1){var href=sheets[ii].href;if(href&&!RL.Document.isExternalURL(href)){sheetsArr.push(sheets[ii]);}}
return sheetsArr;}
RL.Document.getOuterHTML=function(el){var outer=document.createElement('div');outer.appendChild(el.cloneNode(true));return outer.innerHTML;}
RL.Document.download=function(data,fileName,_addPlainTextPrefix){var textType='text/plain;charset=utf-8';if(navigator.msSaveBlob){var blob=new Blob([data],{type:textType});return navigator.msSaveBlob(blob,fileName);}else{if(_addPlainTextPrefix){data='data:'+textType+','+data;}
var a=document.createElement('a');a.download=fileName;a.href=data;document.body.appendChild(a);a.addEventListener("click",function(e){a.parentNode.removeChild(a);});a.click();}}
RL.Document.readText_fromFile=function(fileObj,callbackDict){if(!window.FileReader){var error=new RL.Error('Unsupported Browser','Browser not supported.');error.consoleWarn('Error in "Read Text from File": ');callbackDict.fail(error);return false;}
var reader=new window.FileReader();reader.addEventListener("load",function(event){var fileContents=event.target.result;callbackDict.done(fileContents);});reader.readAsText(fileObj);}
RL.Document.readText_fromBrowsedFile=function(callbackDict,_fileExt){var fileCtrl=document.createElement('input');fileCtrl.setAttribute("type","file");fileCtrl.setAttribute("style","display:none;");if(_fileExt){_fileExt=String(_fileExt);if(RL.String.left(_fileExt,1)!='.'){_fileExt='.'+_fileExt;}
fileCtrl.setAttribute("accept",_fileExt);}
document.body.appendChild(fileCtrl);fileCtrl.addEventListener("change",function(event){var fileLst=event.target.files;var file=fileLst[0];if(_fileExt){var extActual=RL.String.right(file.name,_fileExt.length);if(extActual!=_fileExt){var error=new RL.Error('File Type Error','Incorrect file extension.');error.consoleWarn('Error in "Read Text from File": ');callbackDict.fail(error);return false;}}
fileCtrl.parentNode.removeChild(fileCtrl);RL.Document.readText_fromFile(file,{done:callbackDict.done,fail:callbackDict.fail});});fileCtrl.click();}
RL.SVG=function(){}
RL.SVG.get_SVG_ImageStr=function(svgElem){RL.SVG.__setAttributes(svgElem);RL.SVG.__set_SVG_Styles(svgElem);var svgHTML=RL.Document.getOuterHTML(svgElem);var base64Str=window.btoa(svgHTML);var imageStr='data:image/svg+xml;base64,'+base64Str;return imageStr;}
RL.SVG.get_PNG_ImageStr=function(svgElem){var svgImgStr=RL.SVG.get_SVG_ImageStr(svgElem);var image=document.createElement('img');image.setAttribute("width",svgElem.offsetWidth||svgElem.parentNode.offsetWidth);image.setAttribute("height",svgElem.offsetHeight||svgElem.parentNode.offsetHeight);image.setAttribute("src",svgImgStr);var divCnt=document.createElement('div');divCnt.appendChild(image);svgElem.parentNode.appendChild(divCnt);var canvas=document.createElement('canvas');canvas.width=svgElem.offsetWidth||svgElem.parentNode.offsetWidth;canvas.height=svgElem.offsetHeight||svgElem.parentNode.offsetHeight;var context=canvas.getContext('2d');context.drawImage(image,0,0);var pngImgStr=canvas.toDataURL('image/png');svgElem.parentNode.removeChild(divCnt);return pngImgStr;}
RL.SVG.get_PNG_ImageStr_Async=function(svgElem,callbackFnct){var svgImgStr=RL.SVG.get_SVG_ImageStr(svgElem);var image=new Image();image.src=svgImgStr;image.onload=function(){var canvas=document.createElement('canvas');canvas.width=svgElem.offsetWidth||svgElem.parentNode.offsetWidth;canvas.height=svgElem.offsetHeight||svgElem.parentNode.offsetHeight;var context=canvas.getContext('2d');context.drawImage(image,0,0);var pngImgStr=canvas.toDataURL('image/png');callbackFnct(pngImgStr);}}
RL.SVG.__setAttributes=function(svgElem){svgElem.setAttribute("version","1.1");svgElem.setAttribute("xmlns","http://www.w3.org/2000/svg");svgElem.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");}
RL.SVG.__set_SVG_Styles=function(svgElem){var css="";var sheets=RL.Document.getLocalStyleSheets();for(var ii=0;ii<sheets.length;ii+=1){var rules=sheets[ii].cssRules;if(rules){for(var jj=0;jj<rules.length;jj+=1){var rule=rules[jj];if(typeof(rule.style)!="undefined"){var match;try{match=svgElem.querySelector(rule.selectorText);}catch(err){console.warn('Invalid CSS selector "'+rule.selectorText+'"',err);}
if(match){css+=rule.selectorText+" { "+rule.style.cssText+" }\n";}else if(rule.cssText.match(/^@font-face/)){css+=rule.cssText+'\n';}}}}}
var s=document.createElement('style');s.setAttribute('type','text/css');s.innerHTML="<![CDATA[\n"+css+"\n]]>";var defs=document.createElement('defs');defs.appendChild(s);svgElem.insertBefore(defs,svgElem.firstChild);}
RL.Color=function(){}
RL.Color.RGB=function(r,g,b,_a){this.r=r;this.g=g;this.b=b;this.a=_a;}
RL.Color.RGB.prototype.toString=function(){if(this.a===undefined){return'rgb('+this.r+', '+this.g+', '+this.b+')';}else{return'rgba('+this.r+', '+this.g+', '+this.b+', '+this.a+')';}}
RL.Color.RGB.prototype.get_HSL=function(){return RL.Color.RGB_to_HSL(this.r,this.g,this.b);}
RL.Color.RGB.colorNameDict={'Red':new RL.Color.RGB(255,0,0),'LightCoral':new RL.Color.RGB(240,128,128),'Salmon':new RL.Color.RGB(250,128,114),'Tomato':new RL.Color.RGB(255,99,71),'IndianRed':new RL.Color.RGB(205,92,92),'FireBrick':new RL.Color.RGB(178,34,34),'Blue':new RL.Color.RGB(0,0,255),'SkyBlue':new RL.Color.RGB(135,206,235),'PaleTurquoise':new RL.Color.RGB(175,238,238),'MediumTurquoise':new RL.Color.RGB(72,209,204),'DarkCyan':new RL.Color.RGB(0,139,139),'RoyalBlue':new RL.Color.RGB(65,105,225),'Green':new RL.Color.RGB(0,128,0),'PaleGreen':new RL.Color.RGB(152,251,152),'LimeGreen':new RL.Color.RGB(50,205,50),'MediumSeaGreen':new RL.Color.RGB(60,179,113),'SeaGreen':new RL.Color.RGB(46,139,87),'Purple':new RL.Color.RGB(128,0,128),'Plum':new RL.Color.RGB(221,160,221),'Orchid':new RL.Color.RGB(218,112,214),'DarkOrchid':new RL.Color.RGB(153,50,204),'MediumPurple':new RL.Color.RGB(147,112,219),'Brown':new RL.Color.RGB(165,42,42),'Goldenrod':new RL.Color.RGB(218,165,32),'SandyBrown':new RL.Color.RGB(244,164,96),'Peru':new RL.Color.RGB(205,133,63),'Sienna':new RL.Color.RGB(160,82,45),'Yellow':new RL.Color.RGB(255,255,0),'Gold':new RL.Color.RGB(255,215,0),'Orange':new RL.Color.RGB(255,165,0),'DarkOrange':new RL.Color.RGB(255,140,0),'LightGrey':new RL.Color.RGB(211,211,211),'Sliver':new RL.Color.RGB(192,192,192),'DarkGrey':new RL.Color.RGB(169,169,169),'Grey':new RL.Color.RGB(128,128,128),'DimGrey':new RL.Color.RGB(105,105,105),'Black':new RL.Color.RGB(0,0,0),}
RL.Color.RGB.fromColorName=function(colorName,_alpha){var colorRGB=RL.Color.RGB.colorNameDict[colorName];if(!colorRGB){colorRGB=new RL.Color.RGB(0,0,0);}
if(_alpha){colorRGB.a=_alpha;}
return colorRGB;}
RL.Color.HSL=function(h,s,l,_a){this.h=h;this.s=s;this.l=l;this.a=_a;}
RL.Color.HSL.prototype.toString=function(){if(this.a===undefined){return'hsl('+this.h+', '+this.s+', '+this.l+')';}else{return'hsla('+this.h+', '+this.s+', '+this.l+', '+this.a+')';}}
RL.Color.HSL.prototype.get_RGB=function(){return RL.Color.HSL_to_RGB(this.h,this.s,this.l);}
RL.Color.HSL.maxValue=360;RL.Color.Palette_Bold=function(index){var palette=['RoyalBlue','FireBrick','LimeGreen','DarkOrchid','DarkTurquoise','Orange','SkyBlue','LightCoral','PaleGreen','Plum','Goldenrod'];return RL.Array.getItem_Cycle(palette,index);}
RL.Color.Palette_Soft=function(index){var palette=['MediumTurquoise','Tomato','MediumSeaGreen','Orange','Orchid','Peru','PaleTurquoise','Salmon','PaleGreen','Gold','Plum','SandyBrown','DarkCyan','IndianRed','SeaGreen','DarkOrange','MediumPurple','Sienna'];return RL.Array.getItem_Cycle(palette,index);}
RL.Color.getColorScale=function(colorRGB1,colorRGB2,numColors,_allowWrap,_shiftProp){var hsl1=colorRGB1.get_HSL();var hsl2=colorRGB2.get_HSL();if(hsl1.h>hsl2.h&&_allowWrap===true){hsl2.h+=RL.Color.HSL.maxValue;}
var propsArr;if(!_shiftProp){propsArr=RL.Math.linspace(0,1,numColors);}else{var numBin1;var numBin2;if(numColors%2===0){numBin1=numColors/2;numBin2=numColors/2;}else{if(_shiftProp<=0.5){numBin1=Math.ceil(numColors/2);numBin2=numColors-numBin1;}else{numBin2=Math.ceil(numColors/2);numBin1=numColors-numBin2;}}
var space=1/numColors;var propsArr1=RL.Math.linspace(0,_shiftProp-0.5*space,numBin1);var propsArr2=RL.Math.linspace(_shiftProp+0.5*space,1,numBin2);propsArr=propsArr1.concat(propsArr2);}
var colorScale=[];colorScale[0]=new RL.Color.RGB(colorRGB1.r,colorRGB1.g,colorRGB1.b);for(var ii=1;ii<=propsArr.length-2;ii+=1){var prop=propsArr[ii];var h=hsl1.h+prop*(hsl2.h-hsl1.h);var s=hsl1.s+prop*(hsl2.s-hsl1.s);var l=hsl1.l+prop*(hsl2.l-hsl1.l);if(h>RL.Color.HSL.maxValue){h-=RL.Color.HSL.maxValue;}
colorScale[ii]=RL.Color.HSL_to_RGB(h,s,l);}
colorScale[propsArr.length-1]=new RL.Color.RGB(colorRGB2.r,colorRGB2.g,colorRGB2.b);return colorScale;}
RL.Color.HSL_to_RGB=function(h,s,l,_a){h/=RL.Color.HSL.maxValue;s/=RL.Color.HSL.maxValue;l/=RL.Color.HSL.maxValue;var r,g,b;if(s==0){r=g=b=l;}else{var hue2rgb=function hue2rgb(p,q,t){if(t<0)t+=1;if(t>1)t-=1;if(t<1/6)return p+(q-p)*6*t;if(t<1/2)return q;if(t<2/3)return p+(q-p)*(2/3-t)*6;return p;}
var q=l<0.5?l*(1+s):l+s-l*s;var p=2*l-q;r=hue2rgb(p,q,h+1/3);g=hue2rgb(p,q,h);b=hue2rgb(p,q,h-1/3);}
r=Math.round(r*255);g=Math.round(g*255);b=Math.round(b*255);return new RL.Color.RGB(r,g,b,_a);}
RL.Color.RGB_to_HSL=function(r,g,b,_a){r/=255,g/=255,b/=255;var max=Math.max(r,g,b),min=Math.min(r,g,b);var h,s,l=(max+min)/2;if(max==min){h=s=0;}else{var d=max-min;s=l>0.5?d/(2-max-min):d/(max+min);switch(max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4;break;}
h/=6;}
h=Math.round(h*RL.Color.HSL.maxValue);s=Math.round(s*RL.Color.HSL.maxValue);l=Math.round(l*RL.Color.HSL.maxValue);return new RL.Color.HSL(h,s,l,_a);}
Element.prototype.getSizeString=function(){var width=this.offsetWidth||this.parentNode.offsetWidth;var height=this.offsetHeight||this.parentNode.offsetHeight;return'height = "'+height+'px" width = "'+width+'px"';}
HTMLInputElement.prototype.getValue=function(){if(this.type=="radio"||this.type=="checkbox"){return Boolean(this.checked);}else{return this.value;}}
HTMLInputElement.prototype.setValue=function(value){if(this.type=="radio"||this.type=="checkbox"){this.checked=Boolean(value);}else{this.value=value;}}
HTMLInputElement.prototype.clearValue=function(){if(this.type=="radio"||this.type=="checkbox"){this.checked=false;}else{this.value='';}}
HTMLTextAreaElement.prototype.getValue=function(){return this.value;}
HTMLTextAreaElement.prototype.setValue=function(value){this.value=value;}
HTMLTextAreaElement.prototype.clearValue=function(){this.value='';}
HTMLSelectElement.prototype.getSelectedValue=function(){if(this.selectedIndex==-1){return undefined;}else{return this.options[this.selectedIndex].value;}}
HTMLSelectElement.prototype.getSelectedText=function(){if(this.selectedIndex==-1){return undefined;}else{return this.options[this.selectedIndex].text;}}
HTMLSelectElement.prototype.getIndex_onValue=function(searchStr){searchStr=String(searchStr);for(var ii=0;ii<this.length;ii+=1){var option=this.options[ii];var valStr=String(option.value);if(valStr===searchStr){return ii;}}
return-1;}
HTMLSelectElement.prototype.getIndex_onText=function(searchStr,_optionsDic){var opts=_optionsDic||{};var contains=(opts.contains===true)?true:false;searchStr=String(searchStr).toLowerCase();for(var ii=0;ii<this.length;ii+=1){var option=this.options[ii];var valStr=String(option.text).toLowerCase();if(contains){if(valStr.indexOf(searchStr)!==-1){return ii;}}else{if(valStr===searchStr){return ii;}}}
return-1;}
HTMLSelectElement.prototype.selectItem_onValue=function(searchStr){this.selectedIndex=this.getIndex_onValue(searchStr);}
HTMLSelectElement.prototype.selectItem_onText=function(searchStr,_optionsDic){this.selectedIndex=this.getIndex_onText(searchStr,_optionsDic);}
HTMLSelectElement.prototype.populate=function(objArr,valProp,textProp){this.options.length=0;for(var ii=0;ii<objArr.length;ii+=1){var obj=objArr[ii];if(typeof obj=='string'){obj=JSON.parse(obj);}
if(valProp in obj&&textProp in obj){var opt=new Option(obj[textProp],obj[valProp]);this.appendChild(opt);}}}
HTMLSelectElement.prototype.getValue=function(_index){if(_index===undefined){return this.getSelectedValue();}else{return this.options[_index].value;}}
HTMLSelectElement.prototype.setValue=function(value){if(value!==undefined&&value!==""){this.selectedIndex=this.getIndex_onValue(value);}else{this.selectedIndex=-1;}}
HTMLSelectElement.prototype.clearValue=function(){this.selectedIndex=-1;}
HTMLUListElement.prototype.populate=function(stringArr){this.innerHTML='';for(var ii=0;ii<stringArr.length;ii+=1){var str=stringArr[ii];var item=document.createElement('li');item.appendChild(document.createTextNode(str));this.appendChild(item);}}
HTMLDivElement.prototype.setVisible=function(isVisible){if(isVisible==false){this.style.display='none';}else{this.style.display='inherit';}}
HTMLDivElement.prototype.isVisible=function(){return!(this.style.display=='none');}
HTMLTableElement.prototype.addRow=function(_cellArr){var newRow=this.insertRow(this.rows.length);if(_cellArr){for(var ii=0;ii<_cellArr.length;ii++){var cellDic=_cellArr[ii];var value=cellDic.value;newRow.addCell(value,cellDic);}}
return newRow;}
HTMLTableElement.prototype.deleteRows=function(_startIndex,_endIndex){var startIndex=_startIndex||0;var endIndex=_endIndex||this.rows.length-1;if(startIndex>this.rows.length-1){return;}
if(endIndex<startIndex){return;}
startIndex=Math.max(startIndex,0);endIndex=Math.min(endIndex,this.rows.length-1);for(var ii=endIndex;ii>=startIndex;ii--){this.deleteRow(ii);}}
HTMLTableRowElement.prototype.addCell=function(value,_optionsDic){var index=this.cells.length;var cell=this.insertCell(index);cell.setValue(value,_optionsDic);return cell;}
HTMLTableCellElement.prototype.setValue=function(value,_optionsDic){var options=_optionsDic||{};if(options.unitName){if(value instanceof RL.Unit){this.innerHTML=value.toHTML(options.unitName);}else{throw new Error('HTML Table Error: value not an RL.Unit object!');}}else if(options.digits){this.innerHTML=RL.Number.format_Round(value,{digits:options.digits});}else{this.innerHTML=value;}
if(options['className']){this.className=options['className'];}
if(options['style']){this.setAttribute("style",options['style']);}
if(options['backgroundColor']){this.style.backgroundColor=options['backgroundColor'];}}
RL.Canvas=function(container){var thisObj=this;var containerID='';this.__containerElm=undefined;if(typeof(container)==="string"){containerID=container;this.__containerElm=document.getElementById(containerID);}else if(RL.Type.isHTMLElement(container)){this.__containerElm=container;}else{console.error('Canvas Error: Could not set container!');return;}
if(!(typeof(this.__containerElm.nodeName)==='string'&&this.__containerElm.nodeName.toLowerCase()==='div')){console.error('Canvas Error: Container must be a <div>!');return;}
this.__canvasElm=this.__containerElm.getElementsByTagName("canvas")[0];this.__context;if(this.__canvasElm){this.__context=this.__canvasElm.getContext("2d");}else{console.error('Canvas Error: No <canvas> element inside container div: '+this.__containerElm.id);return;}
function CanvasOptions(){this.padding={top:5,bottom:5,left:5,right:5};this.widthBoundsPX={max:undefined,min:undefined};this.heightBoundsPX={max:undefined,min:undefined};this.fixedSizePX={width:undefined,height:undefined};this.showBoundingBox=false;this.showTextBoundingPoints=false;var __equalScaleFactors=undefined;Object.defineProperty(this,"equalScaleFactors",{get:function(){return __equalScaleFactors!==undefined?__equalScaleFactors:true;},set:function(value){__equalScaleFactors=value;}});Object.defineProperty(this,"isSet_EqualScaleFactors",{get:function(){return __equalScaleFactors!==undefined;}});}
this.options=new CanvasOptions();this.size=new RL.Canvas.Size(this);this.hitMap=new RL.Canvas.HitMap(this);this.__paddedItems=[];this.posConverter=new RL.Canvas.PositionConverter(this);this.x_axis=new RL.Canvas.Axis(this,RL.Canvas.AxisDir.X);this.y_axis=new RL.Canvas.Axis(this,RL.Canvas.AxisDir.Y);this.legend=new RL.Canvas.Legend(this,RL.Canvas.AnchorPositionEnum.LowerCenter);this.colorScale=undefined;this.mouse=new RL.Canvas.Mouse(this);this.mouseCoordinates=undefined;this.__charts=[];this.__basicShapes=[];this.__textShapes=[];this.__addChart=function(shape){this.__charts.push(shape);if(this.options.isSet_EqualScaleFactors===false){this.options.equalScaleFactors=false;}}
this.__addBasicShape=function(shape){this.__basicShapes.push(shape);}
this.__addTextShape=function(shape){this.__textShapes.push(shape);}
Object.defineProperty(this,"canvasIsShown",{get:function(){return this.__containerElm.offsetWidth>0&&this.__containerElm.offsetHeight>0;},});this.draw=function(){if(!this.canvasIsShown){console.warn('Canvas Warning: Cannot draw canvas. Not shown: '+this.__containerElm.id);return;}
this.size.setBoundsAndMargin();this.x_axis.draw({drawTickText:false});this.y_axis.draw({drawTickText:false});for(var ii=0;ii<this.__charts.length;ii+=1){this.__charts[ii].draw();}
for(var ii=0;ii<this.__basicShapes.length;ii+=1){this.__basicShapes[ii].draw();}
for(var ii=0;ii<this.__textShapes.length;ii+=1){this.__textShapes[ii].draw();}
this.x_axis.draw({drawAxisLine:false,drawLabel:false});this.y_axis.draw({drawAxisLine:false,drawLabel:false});if(this.options.showBoundingBox===true){this.size.__bounds.draw();}
if(this.colorScale){this.colorScale.draw();}
if(this.legend.show){this.legend.draw();}}
this.do=function(funcToDo,_arg){funcToDo(this,_arg);}
this.clear=function(){this.__charts=[];this.__basicShapes=[];this.__textShapes=[];this.size.resetBounds();}
this.get_PNG_ImageStr=function(){if(this.mouseCoordinates){this.mouseCoordinates.invalidate();}
return this.__canvasElm.toDataURL('image/png');}
this.addMouseCoordinates=function(digits,_optionsDic){var options=_optionsDic||{};var xDigits=(options.xDigits!==undefined)?options.xDigits:digits;var yDigits=(options.yDigits!==undefined)?options.yDigits:digits;var xFormatFunc=options.xFormatFunc;var yFormatFunc=options.yFormatFunc;var marginPX=options.marginPX;var unitStr=options.unitStr;this.mouseCoordinates=new RL.Canvas.MouseCoordinates(this,{xDigits:xDigits,yDigits:yDigits,xFormatFunc:xFormatFunc,yFormatFunc:yFormatFunc,marginPX:marginPX,unitStr:unitStr});this.__paddedItems.push(this.mouseCoordinates);return this.mouseCoordinates;}
this.addCoordinateSystem=function(){var cSys=new RL.Canvas.CoordinateSystem(this);this.__addBasicShape(cSys);this.__paddedItems.push(cSys);return cSys;}
this.set_x_axis=function(options){set_axis(this.x_axis,options);}
this.set_y_axis=function(options){set_axis(this.y_axis,options);}
var set_axis=function(axis,options){if(options){if(options.label){axis.label=options.label;}
if(options.minLimit!==undefined){axis.minLimit=options.minLimit;}
if(options.maxLimit!==undefined){axis.maxLimit=options.maxLimit;}
if(options.minBound!==undefined){axis.updateMinStaticBound(options.minBound);}
if(options.maxBound!==undefined){axis.updateMaxStaticBound(options.maxBound);}
if(options.minBuffer!==undefined){axis.minBuffer=options.minBuffer;}
if(options.maxBuffer!==undefined){axis.maxBuffer=options.maxBuffer;}
if(options.scale){axis.scale=options.scale;}
if(options.ensureOriginShown){axis.ensureOriginShown();}
if(options.crossingVal!==undefined){axis.crossingVal=options.crossingVal;}
if(options.stepSize){axis.stepSize=options.stepSize;}
if(options.maxNumTicks){axis.maxNumTicks=options.maxNumTicks;}
if(options.ticks){axis.ticks=options.ticks;}
if(options.tickLabels){axis.tickLabels=options.tickLabels;}
if(options.tickTextSize){axis.tickTextSize=options.tickTextSize;}
if(options.labelTextSize){axis.labelTextSize=options.labelTextSize;}
if(options.tickFormatFunct&&typeof(options.tickFormatFunct)==="function"){axis.tickFormatFunct=options.tickFormatFunct;}
if(options.logTickFormat){axis.logTickFormat=options.logTickFormat;}
if(options.gridLines!==undefined){axis.gridLines=options.gridLines;}}
axis.show=true;}
this.setLegend=function(options){options=options||{};this.legend.show=true;if(options.numCols!==undefined){this.legend.numCols=options.numCols;}
if(options.anchorPosEnum!==undefined){this.legend.anchorPosEnum=options.anchorPosEnum;}
if(options.anchorRelativeToCanvas!==undefined){this.legend.anchorRelativeToCanvas=options.anchorRelativeToCanvas;}
if(options.vectorFromAnchorPX!==undefined){this.legend.vectorFromAnchorPX=options.vectorFromAnchorPX;}
this.legend.avoidChart=(options.avoidChart===false)?false:true;}
this.setColorScale=function(minVal,maxVal,options){this.colorScale=new RL.Canvas.ColorScale(this,minVal,maxVal,options);this.__paddedItems.push(this.colorScale);return this.colorScale;}
this.plot=function(chartDic){var points=chartDic.points;var options=chartDic;delete options.points;var linePlot=new RL.Canvas.LinePlot(this,points,options);this.__addChart(linePlot);return linePlot;}
this.plotBarChart=function(chartDic){this.x_axis.stepSize=1;this.x_axis.updateMinStaticBound(1);this.x_axis.isBinned=true;this.y_axis.crossingVal=0.5;this.y_axis.ensureOriginShown();var dataSeries=chartDic.data;var chartOptions=chartDic.chartOptions;var seriesArr=[];for(var ii=0;ii<dataSeries.length;ii+=1){var seriesDic=dataSeries[ii];var values=seriesDic.values;delete seriesDic.values;var seriesObj=new RL.Canvas.BarSeries(this,values,seriesDic);seriesArr[ii]=seriesObj;}
var barChart=new RL.Canvas.BarChart(this,seriesArr,chartOptions);this.__addChart(barChart);return barChart;}
this.plotPieChart=function(chartDic){var data=chartDic.data;var chartOptions=chartDic.chartOptions;var pieItemArr=[];for(var ii=0;ii<data.length;ii+=1){var dataDic=data[ii];var pieItem=new RL.Canvas.PieItem(this,dataDic.value,dataDic.color,dataDic.label);pieItemArr[ii]=pieItem;}
var pieChart=new RL.Canvas.PieChart(this,pieItemArr,chartOptions);this.__addChart(pieChart);return pieChart;}
function Title(canvasObj,titleText,options){RL.Canvas.Text.call(this,canvasObj,titleText,-1,options);RL.Canvas.IPaddedItem.call(this);var titleDrop=5;this.anchorPos=new RL.Canvas.AnchorPosition(canvasObj,RL.Canvas.AnchorPositionEnum.UpperCenter,new RL.Vector2(0,-1*titleDrop));this.getPadArray=function(){return[{side:'top',padValue:titleDrop+options.sizePX+5,isRigid:true}];}}
this.addTitle=function(titleText,options){var options=options||{};options.sizePX=options.sizePX||12;options.bold=(options.bold===undefined)?true:false;options.color=options.color||'#1a1a1a';options.ha='center';options.va='top';var title=new Title(this,titleText,options);this.__addBasicShape(title);this.__paddedItems.push(title);return title;}
this.addText=function(text,point,options){var txt=new RL.Canvas.Text(this,text,point,options);this.__addTextShape(txt);return txt;}
this.addAnnotation=function(text,targetPoint,options){var txt=new RL.Canvas.Annotation(this,text,targetPoint,options);this.__addTextShape(txt);return txt;}
this.addPoint=function(point,options){if(point instanceof RL.Vector2){var pt=new RL.Canvas.Point(this,point,options);this.__addBasicShape(pt);return pt;}else if("length"in point){var pointArr=[];for(var ii=0;ii<point.length;ii+=1){pointArr[ii]=new RL.Canvas.Point(this,point[ii],options);this.__addBasicShape(pointArr[ii]);}
return pointArr;}}
this.addMarker=function(point,options){var shape=new RL.Canvas.Marker(this,point,options);this.__addBasicShape(shape);return shape;}
this.addLine=function(point1,point2,options){var shape=new RL.Canvas.Line(this,point1,point2,options);this.__addBasicShape(shape);return shape;}
this.addCross=function(point,width,height,rotateDeg,options){var shape=new RL.Canvas.Cross(this,point,width,height,rotateDeg,options);this.__addBasicShape(shape);return shape;}
this.addCircle=function(point,dia,options){var shape=new RL.Canvas.Circle(this,point,dia,options);this.__addBasicShape(shape);return shape;}
this.addArc=function(cntrPt,radius,startDeg,endDeg,options){var shape=new RL.Canvas.Arc(this,cntrPt,radius,startDeg,endDeg,options);this.__addBasicShape(shape);return shape;}
this.addPieWedge=function(cntrPt,radius,startDeg,endDeg,options){var shape=new RL.Canvas.PieWedge(this,cntrPt,radius,startDeg,endDeg,options);this.__addBasicShape(shape);return shape;}
this.addPieArray=function(cntrPt,dia,values,colors,options){var shape=new RL.Canvas.PieArray(this,cntrPt,dia,values,colors,options);this.__addBasicShape(shape);return shape;}
this.addRectangle=function(cntrPt,width,height,options){var shape=new RL.Canvas.Rectangle(this,cntrPt,width,height,options);this.__addBasicShape(shape);return shape;}
this.addTriangle=function(point1,point2,point3,options){var shape=new RL.Canvas.Triangle(this,point1,point2,point3,options);this.__addBasicShape(shape);return shape;}
this.addPolygon=function(points,options){var shape=new RL.Canvas.Polygon(this,points,options);this.__addBasicShape(shape);return shape;}
this.addArrow=function(tailPt,tipPt,options){var shape=new RL.Canvas.Arrow(this,tailPt,tipPt,options);this.__addBasicShape(shape);return shape;}
this.addCurvedArrow=function(args){var shape=new RL.Canvas.CurvedArrow(this,args);this.__addBasicShape(shape);return shape;}}
RL.Canvas.get_ColorStr=function(color){var colorStr='Black';if(color){var colorStr='';if(typeof(color)==='string'){colorStr=color;}else if(color instanceof RL.Color.RGB||color instanceof RL.Color.HSL){colorStr=color.toString();}}
return colorStr;}
RL.Canvas.get_TextArr_forScale=function(valueArr){var formatEnum;var digits;var firstNum=valueArr[0];var lastNum=valueArr[valueArr.length-1];var oMagFirst=RL.Number.orderOfMagnitude(firstNum);var oMagLast=RL.Number.orderOfMagnitude(lastNum);var smallOMag=-5;var isBigOrSmall=function(oMag){return(oMag>=6||oMag<=smallOMag);}
if(isBigOrSmall(oMagFirst)&&isBigOrSmall(oMagLast)){formatEnum=RL.Number.FormatEnum.ENGINEERING;digits=undefined;}else{formatEnum=RL.Number.FormatEnum.COMMA;var roundAndReCalcOMag=function(value,oMag){if(oMag<=smallOMag){value=RL.Number.round(value,Math.abs(smallOMag));return RL.Number.orderOfMagnitude(value);}
return oMag;}
oMagFirst=roundAndReCalcOMag(firstNum,oMagFirst);oMagLast=roundAndReCalcOMag(lastNum,oMagLast);var maxOM=3;var digitsMax=RL.Math.getWithinRange(maxOM-oMagFirst,0,20);var digitsMin=RL.Math.getWithinRange(maxOM-oMagLast,0,20);if(oMagFirst<=0&&oMagLast<=0){digits=Math.max(digitsMax,digitsMin);}else{digits=Math.min(digitsMax,digitsMin);}}
return RL.Array.formatForDisplay(valueArr,digits,formatEnum);}
RL.Canvas.get_PNG_ImageStr=function(sizePX,setupFunc,_arg){sizePX=sizePX||{};sizePX.width=sizePX.width||400;sizePX.height=sizePX.height||200;var htmlTemplate={tag:"div",children:{canvas:{tag:"canvas"}}};var canvasGroupTemp=new BF.Element(htmlTemplate);canvasGroupTemp.id="canvasGrpTemp_123xyz";document.body.appendChild(canvasGroupTemp.elm);var canvasObj=new RL.Canvas(canvasGroupTemp.id);canvasObj.options.fixedSizePX=sizePX;canvasObj.do(setupFunc,_arg);canvasObj.draw();var imageStr=canvasObj.get_PNG_ImageStr();document.body.removeChild(canvasGroupTemp.elm);return imageStr;}
RL.Canvas.append_PNG_toDocBody=function(sizePX,setupFunc,_arg){var imgStr=RL.Canvas.get_PNG_ImageStr(sizePX,setupFunc,_arg);var htmlTemplate={tag:"div",children:{img:{tag:"img",style:"border: solid 1px"}}};var elementGroup=new BF.Element(htmlTemplate);elementGroup.img.src=imgStr;document.body.appendChild(elementGroup.elm);return elementGroup.img.elm;}
RL.Canvas.__getPoint=function(point){if(point instanceof RL.Vector2){return point;}else if(point.x!==undefined&&point.y!==undefined){return new RL.Vector2(point.x,point.y);}else if(RL.Type.isArray(point)&&point.length===2){return new RL.Vector2(point[0],point[1]);}else{console.error('Canvas Error: Could not get a point for drawing shape.');return undefined;}}
RL.Canvas.__getPointArray=function(points,_funcInLimits){var pointsArr=[];var funcInLimits=_funcInLimits||function(x,y){return true;};var shouldAdd=function(x,y){return(RL.Number.isNumber(x)&&RL.Number.isNumber(y)&&funcInLimits(x,y));}
var maybeAddXY=function(x,y){if(shouldAdd(x,y)){pointsArr.push(new RL.Vector2(x,y));}}
var maybeAddPoint=function(ptVect){if(shouldAdd(ptVect.x,ptVect.y)){pointsArr.push(ptVect);}}
if(points instanceof RL.Vector2){maybeAddPoint(points);}else if(RL.Type.isArray(points)){if(points[0]instanceof RL.Vector2){for(var ii=0;ii<points.length;ii++){maybeAddPoint(points[ii]);}}else{for(var ii=0;ii<points.length;ii++){maybeAddPoint(RL.Canvas.__getPoint(points[ii]));}}}else if(points.x!==undefined&&points.y!==undefined){if(RL.Type.isArray(points.x)&&RL.Type.isArray(points.y)){if(points.x.length!==points.y.length){throw new Error('Canvas Point Array Error: Arrays for x and y must be the same length!');}
for(var ii=0;ii<points.x.length;ii+=1){maybeAddXY(points.x[ii],points.y[ii])}}else if(RL.Type.isNumber(points.x)&&RL.Type.isNumber(points.y)){maybeAddXY(points.x,points.y);}}
return pointsArr;}
RL.Canvas.Size=function(canvasObj){var canvasElm=canvasObj.__canvasElm;var containerElm=canvasObj.__containerElm;var __internalMarginRigid=undefined;var __internalMarginSoft=undefined;this.setBoundsAndMargin=function(){this.updateCanvasSize();this.__bounds.resetBounds();canvasObj.x_axis.__resetDynamicBounds();canvasObj.y_axis.__resetDynamicBounds();__internalMarginRigid={top:0,bottom:0,left:0,right:0};__internalMarginSoft={top:0,bottom:0,left:0,right:0};for(var ii=0;ii<canvasObj.__paddedItems.length;ii++){var padItem=canvasObj.__paddedItems[ii];updateInternalMargin(padItem);}
for(var ii=0;ii<canvasObj.__charts.length;ii+=1){var chart=canvasObj.__charts[ii];if(chart.finalize){chart.finalize();}
this.__bounds.updateBounds(chart.boundingPoints);var axisBnds=chart.axisBounds;canvasObj.x_axis.__updateDynamicBounds(axisBnds.x_min,axisBnds.x_max);canvasObj.y_axis.__updateDynamicBounds(axisBnds.y_min,axisBnds.y_max);}
for(var ii=0;ii<canvasObj.__basicShapes.length;ii+=1){var shape=canvasObj.__basicShapes[ii];this.__bounds.updateBounds(shape.boundingPoints);}
canvasObj.posConverter.updateConversionScale();if(canvasObj.legend.show){canvasObj.legend.__updateSize();updateInternalMargin(canvasObj.legend);}
canvasObj.posConverter.updateConversionScale();if(canvasObj.y_axis.show===true){updateInternalMargin(canvasObj.y_axis);canvasObj.posConverter.updateConversionScale();}
if(canvasObj.x_axis.show===true){updateInternalMargin(canvasObj.x_axis);canvasObj.posConverter.updateConversionScale();}
if(canvasObj.x_axis.show===true||canvasObj.y_axis.show===true){this.__bounds.updateBounds(canvasObj.y_axis.boundingPoints);this.__bounds.updateBounds(canvasObj.x_axis.boundingPoints);}
canvasObj.posConverter.updateConversionScale();for(var ii=0;ii<canvasObj.__textShapes.length;ii+=1){var textObj=canvasObj.__textShapes[ii];if(!textObj.funcDelayedPosition){this.__bounds.updateBounds(textObj.boundingPoints);}}
canvasObj.posConverter.updateConversionScale();var bndPts_delayedText=[];for(var ii=0;ii<canvasObj.__textShapes.length;ii+=1){var textObj=canvasObj.__textShapes[ii];if(textObj.funcDelayedPosition){textObj.funcDelayedPosition();var boundPts=textObj.boundingPoints;this.__bounds.updateBounds(boundPts);bndPts_delayedText=bndPts_delayedText.concat(boundPts);}}
canvasObj.posConverter.updateConversionScale();if(bndPts_delayedText.length>0&&(canvasObj.x_axis.show===true||canvasObj.y_axis.show===true)){var bounds=RL.Vector2_Array.getMaxMin(bndPts_delayedText);var yUpdated=false;if(bounds.min.y<=canvasObj.y_axis.minDrawVal){var update=canvasObj.y_axis.__updateMinDynamicBound(bounds.min.y);yUpdated=yUpdated||update;}
if(bounds.max.y>=canvasObj.y_axis.maxDrawVal){var update=canvasObj.y_axis.__updateMaxDynamicBound(bounds.max.y);yUpdated=yUpdated||update;}
var xUpdated=false;if(bounds.min.x<=canvasObj.x_axis.minDrawVal){var update=canvasObj.x_axis.__updateMinDynamicBound(bounds.min.x);xUpdated=xUpdated||update;}
if(bounds.max.x>=canvasObj.x_axis.maxDrawVal){var update=canvasObj.x_axis.__updateMaxDynamicBound(bounds.max.x);xUpdated=xUpdated||update;}
if(yUpdated&&canvasObj.y_axis.show===true){updateInternalMargin(canvasObj.y_axis);}
if(xUpdated&&canvasObj.x_axis.show===true){updateInternalMargin(canvasObj.x_axis);}
if(yUpdated||xUpdated){this.__bounds.updateBounds(canvasObj.y_axis.boundingPoints);this.__bounds.updateBounds(canvasObj.x_axis.boundingPoints);canvasObj.posConverter.updateConversionScale();}}}
function updateInternalMargin(paddedItem){if(paddedItem.padDisabled===true){return;}
var padArr=paddedItem.getPadArray();if(padArr){for(var jj=0;jj<padArr.length;jj++){var padDic=padArr[jj];if(padDic.isRigid){__internalMarginRigid[padDic.side]+=padDic.padValue;}else{__internalMarginSoft[padDic.side]=Math.max(padDic.padValue,__internalMarginSoft[padDic.side]);}}}}
Object.defineProperty(this,"totalMarginPX",{get:function(){if(!(__internalMarginRigid&&__internalMarginSoft)){throw new Error('Canvas Error: Margins not yet calculated');}
var internalMargin={};internalMargin.top=Math.max(__internalMarginRigid.top,__internalMarginSoft.top);internalMargin.bottom=Math.max(__internalMarginRigid.bottom,__internalMarginSoft.bottom);internalMargin.left=Math.max(__internalMarginRigid.left,__internalMarginSoft.left);internalMargin.right=Math.max(__internalMarginRigid.right,__internalMarginSoft.right);return{top:internalMargin.top+canvasObj.options.padding.top,bottom:internalMargin.bottom+canvasObj.options.padding.bottom,left:internalMargin.left+canvasObj.options.padding.left,right:internalMargin.right+canvasObj.options.padding.right};},});Object.defineProperty(this,"heightPX",{get:function(){var fixedHeightPX=canvasObj.options.fixedSizePX.height;var heightBoundsPX=canvasObj.options.heightBoundsPX;if(fixedHeightPX){return fixedHeightPX;}else if(heightBoundsPX.max||heightBoundsPX.min){var maxHeightPX=heightBoundsPX.max||1e6;var minHeightPX=heightBoundsPX.min||0;return Math.min(Math.max(containerElm.offsetWidth,minHeightPX),maxHeightPX);}else{return containerElm.offsetHeight;}}});Object.defineProperty(this,"widthPX",{get:function(){var fixedWidthPX=canvasObj.options.fixedSizePX.width;var widthBoundsPX=canvasObj.options.widthBoundsPX;if(fixedWidthPX){return fixedWidthPX;}else if(widthBoundsPX.max||widthBoundsPX.min){var maxWidthPX=widthBoundsPX.max||1e6;var minWidthPX=widthBoundsPX.min||0;return Math.min(Math.max(containerElm.offsetWidth,minWidthPX),maxWidthPX);}else{return containerElm.offsetWidth;}}});Object.defineProperty(this,"availableDrawingHeightPX",{get:function(){var totMargin=this.totalMarginPX;return this.heightPX-(totMargin.top+totMargin.bottom);}});Object.defineProperty(this,"availableDrawingWidthPX",{get:function(){var totMargin=this.totalMarginPX;return this.widthPX-(totMargin.left+totMargin.right);}});Object.defineProperty(this,"availableDrawingCenterPtPX",{get:function(){var totMargin=this.totalMarginPX;var x_cnvCntr_px=0.5*(totMargin.left+(this.widthPX-totMargin.right));var y_cnvCntr_px=0.5*(totMargin.top+(this.heightPX-totMargin.bottom));return new RL.Vector2(x_cnvCntr_px,y_cnvCntr_px);}});this.__bounds=new RL.Canvas.BoundingBox(canvasObj);Object.defineProperty(this,"bounds",{get:function(){var boundsCopy=new RL.Canvas.BoundingBox(canvasObj);if(this.__bounds.hasValue){boundsCopy.updateBounds([this.__bounds.upperLeftPt,this.__bounds.lowerRightPt]);}
return boundsCopy;}});this.resetBounds=function(){this.__bounds=new RL.Canvas.BoundingBox(canvasObj);}
this.updateCanvasSize=function(){canvasElm.height=this.heightPX;canvasElm.width=this.widthPX;}
var canvasResizeTimeout;window.addEventListener("resize",function(event){window.clearTimeout(canvasResizeTimeout);canvasResizeTimeout=window.setTimeout(function(){canvasObj.draw();},300);});}
RL.Canvas.HitMap=function(canvasObj){var __hitArray=[];this.add=function(points){__hitArray.push(new RL.Canvas.HitBox(points));}
this.hitTest=function(pointArr,_hitID){for(var ii=0;ii<__hitArray.length;ii+=1){var hitBox=__hitArray[ii];if(hitBox.hitTest(pointArr)){return true;}}
for(var ii=0;ii<canvasObj.__textShapes.length;ii+=1){var obj=canvasObj.__textShapes[ii];if("hitTest"in obj){var hitTest=obj.hitTest(pointArr,{hitID:_hitID});if(hitTest){return true;}}}
for(var ii=0;ii<canvasObj.__basicShapes.length;ii+=1){var obj=canvasObj.__basicShapes[ii];if("hitTest"in obj){var hitTest=obj.hitTest(pointArr,{hitID:_hitID});if(hitTest){return true;}}}
for(var ii=0;ii<canvasObj.__charts.length;ii+=1){var obj=canvasObj.__charts[ii];if("hitTest"in obj){var hitTest=obj.hitTest(pointArr,{hitID:_hitID});if(hitTest){return true;}}}
return false;}
this.getClearPoint=function(startPt,dirVect,options){var unitVect=dirVect.unitVector();var bounds=canvasObj.size.__bounds;options=options||{};var buffer=(options.buffer!==undefined)?options.buffer:0.01*bounds.maxDim;var hitID=options.hitID;var otherCheckPts=options.otherCheckPts||[];var intStepSize=0.005*bounds.maxDim;var numIntPts=Math.ceil(buffer/intStepSize)+1;var points=[startPt];var props=RL.Math.linspace(0,1,numIntPts);for(var ii=1;ii<props.length;ii+=1){var prop=props[ii];var intVect=unitVect.times(prop*buffer);points.push(startPt.plus(intVect));points.push(startPt.minus(intVect));}
points=points.concat(otherCheckPts);if(!this.hitTest(points,hitID)){return{point:startPt,isClear:true};}else{var numSteps=150;var step=bounds.maxDim/numSteps;var stepVect=unitVect.times(step);var buffVect=unitVect.times(buffer);var props=RL.Math.linspace(0,2,2*numIntPts);var otherCheckVects=[];for(var ii=0;ii<otherCheckPts.length;ii+=1){var otherPt=otherCheckPts[ii];otherCheckVects.push(otherPt.minus(startPt));}
for(var ii=0;ii<numSteps;ii+=1){var crntPt=startPt.plus(stepVect.times(ii));var buffPt=crntPt.plus(buffVect);var points=[crntPt,buffPt];for(var jj=1;jj<props.length;jj+=1){var prop=props[jj];var intVect=unitVect.times(prop*buffer);points.push(crntPt.plus(intVect));}
for(var jj=0;jj<otherCheckVects.length;jj+=1){var vectToOther=otherCheckVects[jj];points.push(crntPt.plus(vectToOther));}
if(!this.hitTest(points,hitID)){if(!options.buffer){return{point:crntPt,isClear:true};}else{return{point:buffPt,isClear:true};}}}}
return{point:startPt,isClear:false};}}
RL.Canvas.PositionConverter=function(canvasObj){var thisObj=this;var __inPerPx_X=undefined;Object.defineProperty(this,"inPerPx_X",{get:function(){if(__inPerPx_X===undefined){this.updateConversionScale();}
return __inPerPx_X;}});var __inPerPx_Y=undefined;Object.defineProperty(this,"inPerPx_Y",{get:function(){if(__inPerPx_Y===undefined){this.updateConversionScale();}
return __inPerPx_Y;}});this.toString=function(){return'Inches/Pixel: x = '+RL.Number.formatNumber(this.inPerPx_X,8)+', y = '+RL.Number.formatNumber(this.inPerPx_Y,8)+', Pixels/Inch: x = '+RL.Number.formatNumber(1/this.inPerPx_X,4)+', y = '+RL.Number.formatNumber(1/this.inPerPx_Y,4);}
this.updateConversionScale=function(){var canvasWidthPX=canvasObj.size.availableDrawingWidthPX;var canvasHeightPX=canvasObj.size.availableDrawingHeightPX;var bounds=canvasObj.size.__bounds;var bndWidth_X;var bndHeight_Y;if(canvasObj.x_axis.scale===RL.Canvas.AxisScale.Linear){bndWidth_X=Math.max(bounds.width,0.001);bndHeight_Y=Math.max(bounds.height,0.001);}else{bndWidth_X=RL.Math.log10(bounds.x_max)-RL.Math.log10(bounds.x_min);bndHeight_Y=RL.Math.log10(bounds.y_max)-RL.Math.log10(bounds.y_min);}
var pxW=bndWidth_X/canvasWidthPX;var pxH=bndHeight_Y/canvasHeightPX;if(canvasObj.options.equalScaleFactors===false){__inPerPx_X=pxW;__inPerPx_Y=pxH;}else{__inPerPx_X=Math.max(pxW,pxH);__inPerPx_Y=__inPerPx_X;}}
this.resetConversionScale=function(){__inPerPx_X=undefined;__inPerPx_Y=undefined;}
this.convertValue_InToPx=function(valueIN,_dir){var valuePX=undefined;var dirDetails=__getDirectionDetails(_dir);if(dirDetails.scale===RL.Canvas.AxisScale.Linear){valuePX=valueIN/dirDetails.inPerPx;}else{var valueIN=Math.max(valueIN,RL.Canvas.AxisScale_LogMinBound);var exp=RL.Math.log10(valueIN);var dimPX=(_dir===RL.Canvas.AxisDir.X||_dir==='X')?canvasObj.size.availableDrawingWidthPX:canvasObj.size.availableDrawingHeightPX;valuePX=(exp/dirDetails.inPerPx)*dimPX;}
return valuePX;}
this.convertValue_PxToIn=function(valuePX,_dir){var valueIN=undefined;var dirDetails=__getDirectionDetails(_dir);if(dirDetails.scale===RL.Canvas.AxisScale.Linear){valueIN=valuePX*dirDetails.inPerPx;}else{var exp=valuePX*dirDetails.inPerPx;valueIN=Math.pow(10,exp);}
return valueIN;}
var __getDirectionDetails=function(_dir){var details={inPerPx:0,scale:RL.Canvas.AxisScale.Linear};if(_dir!==undefined){if(_dir===RL.Canvas.AxisDir.X||_dir==='X'){details.inPerPx=thisObj.inPerPx_X;details.scale=canvasObj.x_axis.scale;}else if(_dir===RL.Canvas.AxisDir.Y||_dir==='Y'){details.inPerPx=thisObj.inPerPx_Y;details.scale=canvasObj.y_axis.scale;}else if(_dir instanceof RL.Vector2){var x_prop=_dir.x/_dir.length;var y_prop=_dir.y/_dir.length;details.inPerPx=Math.sqrt(Math.pow(x_prop*thisObj.inPerPx_X,2)+Math.pow(y_prop*thisObj.inPerPx_Y,2));}else{console.warn('Canvas Error: Inappropriate direction specified in conversion!');}}else{details.inPerPx=Math.max(thisObj.inPerPx_X,thisObj.inPerPx_Y);}
return details;}
this.convertPos_InToPx=function(pointIN){var pt_avg=canvasObj.size.__bounds.centerPt;var cnvCntrPX=canvasObj.size.availableDrawingCenterPtPX;var getPointPX=function(ptIN){var x_px;var y_px;var x_scale=canvasObj.x_axis.scale;if(x_scale===RL.Canvas.AxisScale.Linear){x_px=(ptIN.x-pt_avg.x)/thisObj.inPerPx_X;x_px+=cnvCntrPX.x;}else{var ptIN_X=Math.max(ptIN.x,RL.Canvas.AxisScale_LogMinBound);var exp_delta=RL.Math.log10(ptIN_X)-RL.Math.log10(pt_avg.x);x_px=cnvCntrPX.x+(exp_delta/thisObj.inPerPx_X);}
var y_scale=canvasObj.y_axis.scale;if(y_scale===RL.Canvas.AxisScale.Linear){y_px=-(ptIN.y-pt_avg.y)/thisObj.inPerPx_Y;y_px+=cnvCntrPX.y;}else{var ptIN_Y=Math.max(ptIN.y,RL.Canvas.AxisScale_LogMinBound);var exp_delta=-(RL.Math.log10(ptIN_Y)-RL.Math.log10(pt_avg.y));y_px=cnvCntrPX.y+(exp_delta/thisObj.inPerPx_Y);}
return new RL.Vector2(x_px,y_px);}
if(RL.Type.isArray(pointIN)){var pointArrPX=[];for(var ii=0;ii<pointIN.length;ii++){var pointPX=getPointPX(pointIN[ii]);pointArrPX.push(pointPX);}
return pointArrPX;}else{return getPointPX(pointIN);}}
this.convertPos_PxToIn=function(pointPX){var cnvCntrPX=canvasObj.size.availableDrawingCenterPtPX;var pt_avg=canvasObj.size.__bounds.centerPt;var getPointIN=function(ptPX){var x_in;var y_in;var x_scale=canvasObj.x_axis.scale;if(x_scale===RL.Canvas.AxisScale.Linear){var x_deltaIN=(ptPX.x-cnvCntrPX.x)*thisObj.inPerPx_X;x_in=pt_avg.x+x_deltaIN;}else{var exp_delta=(ptPX.x-cnvCntrPX.x)*thisObj.inPerPx_X;var exp=RL.Math.log10(pt_avg.x)+exp_delta;x_in=Math.pow(10,exp);}
var y_scale=canvasObj.y_axis.scale;if(y_scale===RL.Canvas.AxisScale.Linear){var y_deltaIN=-1*(ptPX.y-cnvCntrPX.y)*thisObj.inPerPx_Y;y_in=pt_avg.y+y_deltaIN;}else{var exp_delta=-1*(ptPX.y-cnvCntrPX.y)*thisObj.inPerPx_Y;var exp=RL.Math.log10(pt_avg.y)+exp_delta;y_in=Math.pow(10,exp);}
return new RL.Vector2(x_in,y_in);}
if(RL.Type.isArray(pointPX)){var pointArrIN=[];for(var ii=0;ii<pointPX.length;ii++){var pointIN=getPointIN(pointPX[ii]);pointArrIN.push(pointIN);}
return pointArrIN;}else{return getPointIN(pointPX);}}}
RL.Canvas.AnchorPositionEnum={UpperLeft:1,CenterLeft:2,LowerLeft:3,UpperRight:4,CenterRight:5,LowerRight:6,UpperCenter:7,CenterCenter:8,LowerCenter:9}
RL.Canvas.AnchorPosition=function(canvasObj,anchorPosEnum,vectorFromAnchorPX){this.anchorPosEnum=anchorPosEnum;this.vectorFromAnchorPX=vectorFromAnchorPX;this.getPositionPX=function(){var ptUprLeft=new RL.Vector2(0,0);var width=canvasObj.size.widthPX;var height=canvasObj.size.heightPX;var anchorPosPX=RL.Canvas.AnchorPosition.getAnchorPosPX(this.anchorPosEnum,ptUprLeft,width,height);var vectorPX=new RL.Vector2(this.vectorFromAnchorPX.x,-1*this.vectorFromAnchorPX.y);return anchorPosPX.plus(vectorPX);}
this.getPositionIN=function(){var posPX=this.getPositionPX();return canvasObj.posConverter.convertPos_PxToIn(posPX);}
this.toString=function(){return String(this.anchorPosEnum)+', '+vectorFromAnchorPX.toString();}}
RL.Canvas.AnchorPosition.getAnchorPosPX=function(anchorPosEnum,pointUprLeftPX,widthPX,heightPX){var vectorPX=new RL.Vector2(0,0);switch(anchorPosEnum){case RL.Canvas.AnchorPositionEnum.UpperLeft:vectorPX=new RL.Vector2(0,0);break;case RL.Canvas.AnchorPositionEnum.CenterLeft:vectorPX=new RL.Vector2(0,0.5*heightPX);break;case RL.Canvas.AnchorPositionEnum.LowerLeft:vectorPX=new RL.Vector2(0,heightPX);break;case RL.Canvas.AnchorPositionEnum.UpperRight:vectorPX=new RL.Vector2(widthPX,0);break;case RL.Canvas.AnchorPositionEnum.CenterRight:vectorPX=new RL.Vector2(widthPX,0.5*heightPX);break;case RL.Canvas.AnchorPositionEnum.LowerRight:vectorPX=new RL.Vector2(widthPX,heightPX);break;case RL.Canvas.AnchorPositionEnum.UpperCenter:vectorPX=new RL.Vector2(0.5*widthPX,0);break;case RL.Canvas.AnchorPositionEnum.CenterCenter:vectorPX=new RL.Vector2(0.5*widthPX,0.5*heightPX);break;case RL.Canvas.AnchorPositionEnum.LowerCenter:vectorPX=new RL.Vector2(0.5*widthPX,heightPX);break;default:console.warn('Anchor Position error: Invalid enum.');};return pointUprLeftPX.plus(vectorPX);}
RL.Canvas.IDrawable=function(){this.boundingPoints=[];this.draw=function(){throw new Error("IDrawable: draw not implemented!");}
this.drawBoundingPoints=function(canvasObj){var boundingPoints=this.boundingPoints;for(var ii=0;ii<boundingPoints.length;ii+=1){var pt=boundingPoints[ii];var colPt=(ii==0)?'red':'blue'
canvasObj.addPoint(pt,{radPX:3,color:colPt});}}}
RL.Canvas.IClosedShape=function(options){this.options=RL.Canvas.IClosedShape.setOptions(options);Object.defineProperty(this,"fillColor",{get:function(){return this.options.fillColor;}});Object.defineProperty(this,"edgeColor",{get:function(){return this.options.edgeColor;}});Object.defineProperty(this,"lineWidth",{get:function(){return this.options.lineWidth;}});Object.defineProperty(this,"hasEdge",{get:function(){return this.options.hasEdge;}});}
RL.Canvas.IClosedShape.setOptions=function(options){options=options||{};options.fillColor=options.fillColor||undefined;options.edgeColor=options.edgeColor||undefined;options.lineWidth=options.lineWidth||0;options.hasEdge=false;if(options.edgeColor||options.lineWidth){options.hasEdge=true;options.edgeColor=options.edgeColor||'Black';options.lineWidth=options.lineWidth||1;}
return options;}
RL.Canvas.IHitTestable=function(){this.hitTest=function(pointArr){throw new Error("IHitBox: hitTest not implemented!");}}
RL.Canvas.IPaddedItem=function(){this.getPadArray=function(){throw new Error("IPaddedItem: getPadArray not implemented!");}}
RL.Canvas.HitBox=function(points){RL.Canvas.IHitTestable.call(this);this.x_min=Number.MAX_VALUE;this.x_max=-1*Number.MAX_VALUE;this.y_min=Number.MAX_VALUE;this.y_max=-1*Number.MAX_VALUE;if(points){for(var ii=0;ii<points.length;ii+=1){var pt=points[ii];this.x_min=Math.min(pt.x,this.x_min);this.x_max=Math.max(pt.x,this.x_max);this.y_min=Math.min(pt.y,this.y_min);this.y_max=Math.max(pt.y,this.y_max);}}
this.hitTest=function(pointArr){for(var ii=0;ii<pointArr.length;ii+=1){var pt=pointArr[ii];var isInside=(pt.x>=this.x_min&&pt.x<=this.x_max)&&(pt.y>=this.y_min&&pt.y<=this.y_max);if(isInside){return true;}}
return false;}}
RL.Canvas.BoundingBox=function(canvasObj){RL.Canvas.IDrawable.call(this);RL.Canvas.HitBox.call(this);var __x_min;Object.defineProperty(this,"x_min",{get:function(){if(canvasObj.x_axis.scale===RL.Canvas.AxisScale.Log){return Math.max(__x_min,RL.Canvas.AxisScale_LogMinBound);}else{return __x_min;}},set:function(value){__x_min=value;}});var __x_max;Object.defineProperty(this,"x_max",{get:function(){return __x_max;},set:function(value){__x_max=value;}});var __y_min;Object.defineProperty(this,"y_min",{get:function(){if(canvasObj.y_axis.scale===RL.Canvas.AxisScale.Log){return Math.max(__y_min,RL.Canvas.AxisScale_LogMinBound);}else{return __y_min;}},set:function(value){__y_min=value;}});var __y_max;Object.defineProperty(this,"y_max",{get:function(){return __y_max;},set:function(value){__y_max=value;}});this.resetBounds=function(){this.x_min=Number.MAX_VALUE;this.x_max=-1*Number.MAX_VALUE;this.y_min=Number.MAX_VALUE;this.y_max=-1*Number.MAX_VALUE;}
this.resetBounds();this.updateBounds=function(points){for(var ii=0;ii<points.length;ii+=1){var pt=points[ii];if(pt.x===undefined||isNaN(pt.x)){console.error('NaN!');}
var small=RL.Canvas.AxisScale_LogMinBound;if(pt.x<=small||pt.y<=small){}
this.x_min=Math.min(pt.x,this.x_min);this.x_max=Math.max(pt.x,this.x_max);this.y_min=Math.min(pt.y,this.y_min);this.y_max=Math.max(pt.y,this.y_max);if(isNaN(this.x_min)||isNaN(this.x_max)||isNaN(this.y_min)||isNaN(this.y_max)){console.error('NaN!');}}}
Object.defineProperty(this,"hasValue",{get:function(){return(this.x_min!==Number.MAX_VALUE&&this.x_max!==-1*Number.MAX_VALUE&&this.y_min!==Number.MAX_VALUE&&this.y_max!==-1*Number.MAX_VALUE);}});Object.defineProperty(this,"width",{get:function(){return this.x_max-this.x_min;}});Object.defineProperty(this,"height",{get:function(){return this.y_max-this.y_min;}});Object.defineProperty(this,"maxDim",{get:function(){return Math.max(this.width,this.height);}});Object.defineProperty(this,"centerPt",{get:function(){var x_cntr=undefined;var x_scale=canvasObj.x_axis.scale;if(x_scale===RL.Canvas.AxisScale.Linear){x_cntr=(this.x_min+this.x_max)/2;}else{var exp_min=RL.Math.log10(this.x_min,{throwError:true});var exp_max=RL.Math.log10(this.x_max,{throwError:true});x_cntr=Math.pow(10,(exp_min+exp_max)/2);}
var y_cntr=undefined;var y_scale=canvasObj.y_axis.scale;if(y_scale===RL.Canvas.AxisScale.Linear){y_cntr=(this.y_min+this.y_max)/2;}else{var exp_min=RL.Math.log10(this.y_min,{throwError:true});var exp_max=RL.Math.log10(this.y_max,{throwError:true});y_cntr=Math.pow(10,(exp_min+exp_max)/2);}
return new RL.Vector2(x_cntr,y_cntr);}});Object.defineProperty(this,"upperLeftPt",{get:function(){return this.centerPt.minus(new RL.Vector2(0.5*this.width,0.5*this.height));}});Object.defineProperty(this,"lowerRightPt",{get:function(){return this.centerPt.plus(new RL.Vector2(0.5*this.width,0.5*this.height));}});this.distToCenter=function(point){var cntrPt=this.centerPt;var dx=point.x-cntrPt.x;var dy=point.y-cntrPt.y;return Math.sqrt(dx*dx+dy*dy);}
this.distOutsideBounds=function(point){var dx=0;if(point.x>this.x_max){dx=point.x-this.x_max;}else if(point.x<this.x_min){dx=this.x_min-point.x;}
var dy=0;if(point.y>this.y_max){dy=point.y-this.y_max;}else if(point.y<this.y_min){dy=this.y_min-point.y;}
return Math.sqrt(dx*dx+dy*dy);}
this.draw=function(){var rect=new RL.Canvas.Rectangle(canvasObj,this.centerPt,this.width,this.height,{lineWidth:1,edgeColor:'Red'});rect.draw();}
this.toString=function(){return'x_min: '+RL.Number.formatNumber(this.x_min,4)+', y_min: '+RL.Number.formatNumber(this.y_min,4)+', x_max: '+RL.Number.formatNumber(this.x_max,4)+', y_max: '+RL.Number.formatNumber(this.y_max,4);}}
RL.Canvas.AxisDir={X:1,Y:2}
RL.Canvas.AxisScale={Linear:1,Log:2}
RL.Canvas.AxisScale_LogMinBound=1e-100;RL.Canvas.Axis=function(canvasObj,axisDir){RL.Canvas.IDrawable.call(this);RL.Canvas.IPaddedItem.call(this);var thisObj=this;this.dir=axisDir;this.gridLines=true;this.isBinned=false;this.label='';this.axisColor='#1a1a1a';this.labelTextSize=12;this.tickFormatFunct=undefined;this.logTickFormat='log';var __tickTextSize=undefined;Object.defineProperty(this,"tickTextSize",{get:function(){if(__tickTextSize){return __tickTextSize;}else{if(this.scale===RL.Canvas.AxisScale.Log&&this.logTickFormat==='log'&&!this.tickFormatFunct){return 13;}else{return 11;}}},set:function(value){__tickTextSize=value;this.__clearTickState();}});this.__axisLblOffsetPX=6;this.__tickLblOffsetPX=4;this.__tickWidthPX=2;Object.defineProperty(this,"tickLblOffsetPX",{get:function(){var textOffsetPX=this.__tickLblOffsetPX;if(!this.isBinned){textOffsetPX+=this.__tickWidthPX;}
return textOffsetPX;}});Object.defineProperty(this,"otherAxis",{get:function(){return(this.dir===RL.Canvas.AxisDir.X)?canvasObj.y_axis:canvasObj.x_axis;},});var __show=false;Object.defineProperty(this,"show",{get:function(){return __show;},set:function(value){__show=value;}});var __scale=undefined;Object.defineProperty(this,"scale",{get:function(){return __scale?__scale:RL.Canvas.AxisScale.Linear;},set:function(value){var scalePrev=this.scale;if(value===RL.Canvas.AxisScale.Log||value==="Log"||value==="log"){__scale=RL.Canvas.AxisScale.Log;}else{__scale=RL.Canvas.AxisScale.Linear;}
if(__scale!==scalePrev){this.__clearTickState();}}});var __crossingVal=undefined;Object.defineProperty(this,"crossingVal",{get:function(){if(__crossingVal){return __crossingVal;}else{if(this.otherAxis.scale===RL.Canvas.AxisScale.Linear){return 0;}else{return this.otherAxis.ticks[0];}}},set:function(value){__crossingVal=value;this.__clearTickState();}});this.minBuffer=0;this.maxBuffer=0;var __minBoundStatic;var __maxBoundStatic;var __minBoundDynamic;var __maxBoundDynamic;Object.defineProperty(this,"staticBounds",{get:function(){return{min:__minBoundStatic,max:__maxBoundStatic};},});this.updateMinStaticBound=function(minBound){if(minBound!==undefined){__minBoundStatic=(__minBoundStatic===undefined)?minBound:Math.min(minBound,__minBoundStatic);this.__clearTickState();}}
this.updateMaxStaticBound=function(maxBound){if(maxBound!==undefined){__maxBoundStatic=(__maxBoundStatic===undefined)?maxBound:Math.max(maxBound,__maxBoundStatic);this.__clearTickState();}}
this.updateStaticBounds=function(minBound,maxBound){this.updateMinStaticBound(minBound);this.updateMaxStaticBound(maxBound);}
Object.defineProperty(this,"bounds",{get:function(){var minVal=getMinBoundCalc();var maxVal=getMaxBoundCalc();if((this.minBuffer>0||this.maxBuffer>0)&&minVal!==undefined&&maxVal!==undefined){var range=maxVal-minVal;minVal=minVal-this.minBuffer*range;maxVal=maxVal+this.maxBuffer*range;}
return{min:minVal,max:maxVal};}});var getMinBoundCalc=function(){if(__minBoundStatic===undefined&&__minBoundDynamic===undefined){return undefined;}else{var minStc=__minBoundStatic!==undefined?__minBoundStatic:Number.MAX_VALUE;var minDyn=__minBoundDynamic!==undefined?__minBoundDynamic:Number.MAX_VALUE;return Math.min(minStc,minDyn);}}
var getMaxBoundCalc=function(){if(__maxBoundStatic===undefined&&__maxBoundDynamic===undefined){return undefined;}else{var maxStc=__maxBoundStatic!==undefined?__maxBoundStatic:-1*Number.MAX_VALUE;var maxDyn=__maxBoundDynamic!==undefined?__maxBoundDynamic:-1*Number.MAX_VALUE;return Math.max(maxStc,maxDyn);}}
this.__resetDynamicBounds=function(){__minBoundDynamic=undefined;__maxBoundDynamic=undefined;this.__clearTickState();}
this.__updateMinDynamicBound=function(minBound){var updated=false;if(minBound===undefined){return updated;}
var __minPrev=this.bounds.min;if(__minBoundDynamic===undefined){__minBoundDynamic=minBound;}else{__minBoundDynamic=Math.min(__minBoundDynamic,minBound);}
if(__minBoundDynamic<__minPrev){updated=true;this.__clearTickState();}
return updated;}
this.__updateMaxDynamicBound=function(maxBound){var updated=false;if(maxBound===undefined){return updated;}
var __maxPrev=this.bounds.max;if(__maxBoundDynamic===undefined){__maxBoundDynamic=maxBound;}else{__maxBoundDynamic=Math.max(__maxBoundDynamic,maxBound);}
if(__maxBoundDynamic>__maxPrev){updated=true;this.__clearTickState();}
return updated;}
this.__updateDynamicBounds=function(minBound,maxBound){var updateMin=this.__updateMinDynamicBound(minBound);var updateMax=this.__updateMaxDynamicBound(maxBound);return updateMin||updateMax;}
this.ensureOriginShown=function(){this.updateStaticBounds(0,0);}
var __minLimit;Object.defineProperty(this,"minLimit",{get:function(){return __minLimit;},set:function(value){if(RL.Number.isNumber(value)){__minLimit=Number(value);this.__clearTickState();}else{console.warn('Canvas Error: Non-numeric limit');}}});Object.defineProperty(this,"__minLimitValue",{get:function(){if(this.scale===RL.Canvas.AxisScale.Linear){return(__minLimit!==undefined)?__minLimit:-1*Number.MAX_VALUE;}else{var logMin=RL.Canvas.AxisScale_LogMinBound;return(__minLimit!==undefined)?Math.max(__minLimit,logMin):logMin;}}});var __maxLimit;Object.defineProperty(this,"maxLimit",{get:function(){return __maxLimit;},set:function(value){if(RL.Number.isNumber(value)){__maxLimit=value;this.__clearTickState();}else{console.warn('Canvas Error: Non-numeric limit');}}});Object.defineProperty(this,"__maxLimitValue",{get:function(){return(__maxLimit!==undefined)?__maxLimit:Number.MAX_VALUE;}});var __stepSizeUser;var __stepSizeCalc;Object.defineProperty(this,"stepSize",{get:function(){if(__stepSizeUser){return __stepSizeUser;}else{if(!__stepSizeCalc){this.__setStepSize();}
return __stepSizeCalc;}},set:function(value){__stepSizeUser=value;this.__clearTickState();}});Object.defineProperty(this,"stepSizePX",{get:function(){var stepIN=this.stepSize;if(this.scale===RL.Canvas.AxisScale.Linear){return canvasObj.posConverter.convertValue_InToPx(stepIN,this.dir);}else{var stepSizePx1=canvasObj.posConverter.convertValue_InToPx(Math.pow(10,1*stepIN),this.dir);var stepSizePx2=canvasObj.posConverter.convertValue_InToPx(Math.pow(10,2*stepIN),this.dir);return stepSizePx2-stepSizePx1;}}});var __maxNumTicks=undefined;Object.defineProperty(this,"maxNumTicks",{get:function(){return __maxNumTicks},set:function(value){__maxNumTicks=value;this.__clearTickState();}});var __tickArrayUser;var __tickArrayCalc;Object.defineProperty(this,"ticks",{get:function(){if(__tickArrayUser){return __tickArrayUser;}else{if(!__tickArrayCalc){this.__setTickArray();}
return __tickArrayCalc;}},set:function(value){__tickArrayUser=value;__tickTextLengths=undefined;}});Object.defineProperty(this,"minTickVal",{get:function(){return this.ticks[0];}});Object.defineProperty(this,"maxTickVal",{get:function(){var tickArr=this.ticks;return tickArr[tickArr.length-1];}});Object.defineProperty(this,"midTickVal",{get:function(){if(this.scale===RL.Canvas.AxisScale.Linear){return(this.minTickVal+this.maxTickVal)/2;}else{var exp_min=RL.Math.log10(this.minTickVal,{throwError:true});var exp_max=RL.Math.log10(this.maxTickVal,{throwError:true});return Math.pow(10,(exp_min+exp_max)/2);}}});Object.defineProperty(this,"minDrawVal",{get:function(){return this.isBinned?(this.minTickVal-0.5*this.stepSize):this.minTickVal;}});Object.defineProperty(this,"maxDrawVal",{get:function(){return this.isBinned?(this.maxTickVal+0.5*this.stepSize):this.maxTickVal;}});var __tickLabels;Object.defineProperty(this,"tickLabels",{get:function(){return __tickLabels||[];},set:function(value){__tickLabels=value;__tickTextLengths=undefined;}});var __tickTextLengths;Object.defineProperty(this,"__tickTextLengthsPX",{get:function(){if(!__tickTextLengths){__tickTextLengths=__getTickTextLengths();}
return __tickTextLengths;}});this.toString=function(){return'Min Lim: '+__minLimit+', Max Lim: '+__maxLimit+', Step User: '+__stepSizeUser+', Step Calc: '+__stepSizeCalc+', Ticks User: '+__tickArrayUser+', Ticks Calc: '+__tickArrayCalc;}
Object.defineProperty(this,"boundingPoints",{get:function(){if(!this.show){return[];}else{if(this.ticks===undefined){return[];}
var ptMin;var ptMax;if(this.dir===RL.Canvas.AxisDir.X){ptMin=new RL.Vector2(this.minDrawVal,this.crossingVal);ptMax=new RL.Vector2(this.maxDrawVal,this.crossingVal);}else if(this.dir===RL.Canvas.AxisDir.Y){ptMin=new RL.Vector2(this.crossingVal,this.maxDrawVal);ptMax=new RL.Vector2(this.crossingVal,this.minDrawVal);}
var boundPts=[ptMin,ptMax];var gridPts=this.__getGridLinePoints(this.otherAxis.crossingVal);if(gridPts){boundPts.push(gridPts[0]);boundPts.push(gridPts[1]);}
return boundPts;}}});this.__getTickPaddingPX=function(){var tickPad_Prim=0;var tickPad_Sec=0;var overhangPX=0;if(this.dir===RL.Canvas.AxisDir.X){tickPad_Prim=this.tickTextSize+this.tickLblOffsetPX;this.padDisabled=true;var rotDeg=__getTextRotation();if(rotDeg!==0){tickPad_Prim+=this.__tickTextLengthsPX.longest*Math.sin(Math.abs(rotDeg)*(Math.PI/180));}
this.padDisabled=false;if(this.otherAxis.show){overhangPX=0.5*this.tickTextSize-1;tickPad_Sec=overhangPX;}}else if(this.dir===RL.Canvas.AxisDir.Y){tickPad_Prim=this.__tickTextLengthsPX.longest+this.tickLblOffsetPX;if(this.otherAxis.show){overhangPX=0.5*this.otherAxis.__tickTextLengthsPX.first;tickPad_Sec=0.5*this.otherAxis.__tickTextLengthsPX.last;}}
this.padDisabled=true;var crossPX=canvasObj.posConverter.convertValue_InToPx(this.crossingVal,this.otherAxis.dir);var minPX=canvasObj.posConverter.convertValue_InToPx(this.otherAxis.minDrawVal,this.otherAxis.dir);var overlapPX=Math.max(crossPX-minPX,0);this.padDisabled=false;tickPad_Prim=Math.max(tickPad_Prim-overlapPX,overhangPX);return[tickPad_Prim,tickPad_Sec];}
this.getPadArray=function(){var padDicPrim={side:'',padValue:0,isRigid:true};var padDicSec={side:'',padValue:0,isRigid:false};if(this.dir===RL.Canvas.AxisDir.X){padDicPrim.side='bottom';padDicSec.side='top';}else if(this.dir===RL.Canvas.AxisDir.Y){padDicPrim.side='left';padDicSec.side='right';}
var tickPadArr=this.__getTickPaddingPX();padDicPrim.padValue=tickPadArr[0];padDicSec.padValue=tickPadArr[1];if(this.label){padDicPrim.padValue+=this.labelTextSize+this.__axisLblOffsetPX;}
return[padDicPrim,padDicSec];}
this.draw=function(_options){if(!this.show){return;}
var options=_options||{};var drawAxisLine=(options.drawAxisLine===undefined)?true:options.drawAxisLine;var drawTickText=(options.drawTickText===undefined)?true:options.drawTickText;var drawLabel=(options.drawLabel===undefined)?true:options.drawLabel;var tickArr=this.ticks;var tickTextArr=tickArr;if(tickArr===undefined){return;}
var tickDir=(this.dir===RL.Canvas.AxisDir.X)?RL.Canvas.AxisDir.Y:RL.Canvas.AxisDir.X;if(drawAxisLine!==false){this.__drawAxisAndTicks(tickArr,tickDir);}
if(drawTickText!==false){this.__drawTickText(tickTextArr,tickDir);}
if(drawLabel!==false){this.__drawAxisLabel();}}
this.__drawAxisAndTicks=function(tickArr,tickDir){if(this.isBinned){var step=this.stepSize;var crnt=tickArr[0]-0.5*step;var length=tickArr.length;tickArr=[];for(var ii=0;ii<length+1;ii+=1){tickArr[ii]=crnt;crnt+=step;}}
var minTick=tickArr[0];var maxTick=tickArr[tickArr.length-1];var minPt;var maxPt;if(this.dir===RL.Canvas.AxisDir.X){minPt=new RL.Vector2(minTick,this.crossingVal);maxPt=new RL.Vector2(maxTick,this.crossingVal);}else if(this.dir===RL.Canvas.AxisDir.Y){minPt=new RL.Vector2(this.crossingVal,minTick);maxPt=new RL.Vector2(this.crossingVal,maxTick);}else{console.warn('Error drawing axis: Direction not set properly!');return;}
var tickPt1;var tickPt2;var gridPt1;var gridPt2;for(var ii=0;ii<tickArr.length;ii+=1){var tickVal=tickArr[ii];var gridPts=this.__getGridLinePoints(tickVal);if(gridPts){var gridLine=new RL.Canvas.Line(canvasObj,gridPts[0],gridPts[1],{width:1,color:'LightGray'});gridLine.draw();}
var tickPt1_Px;var tickPt2_Px;if(this.dir===RL.Canvas.AxisDir.X){var tickPtBasePX=canvasObj.posConverter.convertPos_InToPx(new RL.Vector2(tickVal,this.crossingVal));tickPt1_Px=tickPtBasePX.plus(new RL.Vector2(0,this.__tickWidthPX));tickPt2_Px=tickPtBasePX.minus(new RL.Vector2(0,this.__tickWidthPX));}else if(this.dir===RL.Canvas.AxisDir.Y){var tickPtBasePX=canvasObj.posConverter.convertPos_InToPx(new RL.Vector2(this.crossingVal,tickVal));tickPt1_Px=tickPtBasePX.plus(new RL.Vector2(this.__tickWidthPX,0));tickPt2_Px=tickPtBasePX.minus(new RL.Vector2(this.__tickWidthPX,0));}
RL.Canvas.Line.drawPX(canvasObj,tickPt1_Px,tickPt2_Px,{width:1,color:this.axisColor});}
if(this.gridLines&&this.scale===RL.Canvas.AxisScale.Log){var color=new RL.Color.RGB(240,240,240);for(var ii=1;ii<tickArr.length;ii++){var midTicks=RL.Math.linspace(tickArr[ii-1],tickArr[ii],10);for(var jj=1;jj<midTicks.length-1;jj++){var gridPts=this.__getGridLinePoints(midTicks[jj]);if(gridPts){var gridLine=new RL.Canvas.Line(canvasObj,gridPts[0],gridPts[1],{width:1,color:color});gridLine.draw();}}}}
var line=new RL.Canvas.Line(canvasObj,minPt,maxPt,{width:1,color:this.axisColor});line.draw();}
this.__getGridLinePoints=function(tickVal){var drawIt=this.gridLines&&(tickVal!==this.otherAxis.crossingVal||this.otherAxis.show===false);if(drawIt){var gridPt1;var gridPt2;if(this.dir===RL.Canvas.AxisDir.X){gridPt1=new RL.Vector2(tickVal,this.otherAxis.maxDrawVal);gridPt2=new RL.Vector2(tickVal,this.otherAxis.minDrawVal);}else if(this.dir===RL.Canvas.AxisDir.Y){gridPt1=new RL.Vector2(this.otherAxis.maxDrawVal,tickVal);gridPt2=new RL.Vector2(this.otherAxis.minDrawVal,tickVal);}
return[gridPt1,gridPt2];}else{return undefined;}}
this.__drawTickText=function(tickTextArr,tickDir){var tickValueArr=this.ticks;var tickTextArr=this.__getTickTextArray();if(tickValueArr===undefined||tickTextArr===undefined){return;}
for(var ii=0;ii<tickTextArr.length;ii+=1){var tickVal=tickValueArr[ii];var tickText=tickTextArr[ii];var ptTxt;if(this.dir===RL.Canvas.AxisDir.X){var ptTxtIN=new RL.Vector2(tickVal,this.crossingVal);var ptTxtPX=canvasObj.posConverter.convertPos_InToPx(ptTxtIN);ptTxtPX.y+=this.tickLblOffsetPX;}else if(this.dir===RL.Canvas.AxisDir.Y){var ptTxtIN=new RL.Vector2(this.crossingVal,tickVal);var ptTxtPX=canvasObj.posConverter.convertPos_InToPx(ptTxtIN);ptTxtPX.x-=this.tickLblOffsetPX;}
__drawIndividualTickText(tickText,ptTxtPX);}}
this.__drawAxisLabel=function(){if(!this.label){return;}
var tickPad=this.__getTickPaddingPX()[0];var ptTxtPX;var options;if(this.dir===RL.Canvas.AxisDir.X){var ptTxtIN=new RL.Vector2(this.midTickVal,this.otherAxis.minDrawVal);var ptTxtPX=canvasObj.posConverter.convertPos_InToPx(ptTxtIN);ptTxtPX.y+=(tickPad+this.__axisLblOffsetPX);options={sizePX:this.labelTextSize,ha:'center',va:'top'};}else if(this.dir===RL.Canvas.AxisDir.Y){var ptTxtIN=new RL.Vector2(this.otherAxis.minDrawVal,this.midTickVal);var ptTxtPX=canvasObj.posConverter.convertPos_InToPx(ptTxtIN);ptTxtPX.x-=(tickPad+this.__axisLblOffsetPX);options={sizePX:this.labelTextSize,ha:'center',va:'bottom',rotateDeg:90};}
RL.Canvas.Text.drawPX(canvasObj,this.label,ptTxtPX,options);}
this.__clearTickState=function(){__stepSizeCalc=undefined;__tickArrayCalc=undefined;__tickTextLengths=undefined;}
this.__setStepSize=function(){var goalTicks=10;var minTicks=2;var minDim=Math.min(canvasObj.size.availableDrawingWidthPX,canvasObj.size.availableDrawingHeightPX);var maxTicks=this.maxNumTicks?this.maxNumTicks:Math.max(minDim,0)/(1.5*this.tickTextSize);var tickLims=this.__getTickLimits();var minLimit=tickLims[0];var maxLimit=tickLims[1];if(minLimit===undefined||maxLimit===undefined||maxLimit<minLimit){__stepSizeCalc=undefined;throw new Error('Canvas Error: Cannot set step size for axis.');}else{var range=maxLimit-minLimit;var maxVal=Math.max(Math.abs(maxLimit),Math.abs(minLimit));if(range<0.00001*maxVal||range===0){var otherRange;if(this.otherAxis.bounds.max>this.otherAxis.bounds.min){otherRange=this.otherAxis.bounds.max-this.otherAxis.bounds.min;}else{otherRange=0.01;}
minLimit=minLimit-0.25*otherRange;maxLimit=maxLimit+0.25*otherRange;this.__updateDynamicBounds(minLimit,maxLimit);}}
var stepSize;if(this.scale===RL.Canvas.AxisScale.Linear){var range=maxLimit-minLimit;var numTicks=function(stepSize){return(range/stepSize)+1;}
var stepSizeGoal=range/goalTicks;var stepOptionsBase=[1,2,2.5,4,5];var stepOptions=[];var stepOrderMag=RL.Number.orderOfMagnitude(stepSizeGoal);for(var ii=0;ii<stepOptionsBase.length;ii+=1){stepOptions[ii]=Math.pow(10,stepOrderMag-1)*stepOptionsBase[ii];stepOptions[ii+stepOptionsBase.length]=Math.pow(10,stepOrderMag)*stepOptionsBase[ii];stepOptions[ii+2*stepOptionsBase.length]=Math.pow(10,stepOrderMag+1)*stepOptionsBase[ii];}
var refinedSteps=[];for(var ii=0;ii<stepOptions.length;ii+=1){var stepOpt=stepOptions[ii];var ticksOpt=numTicks(stepOpt);if(ticksOpt>=minTicks&&ticksOpt<=maxTicks){refinedSteps.push(stepOpt);}}
var highScore=0;for(var ii=0;ii<refinedSteps.length;ii+=1){var stepOpt=refinedSteps[ii];var ticksOpt=numTicks(stepOpt);var diffCrnt=Math.abs(ticksOpt-goalTicks);var score=goalTicks/(diffCrnt+1);if(this.minLimit&&minLimit==this.minLimit){if(this.minLimit%stepOpt===0){score+=goalTicks;}}
if(this.maxLimit&&maxLimit==this.maxLimit){if(this.maxLimit%stepOpt===0){score+=goalTicks;}}
if(score>highScore){stepSize=stepOpt;highScore=score;}}
if(!stepSize){stepSize=stepSizeGoal;}}else{stepSize=1;}
__stepSizeCalc=stepSize;}
this.__setTickArray=function(){var stepSize=this.stepSize;var tickDigits=10;var tickLims=this.__getTickLimits();var min=tickLims[0];var max=tickLims[1];if(this.scale===RL.Canvas.AxisScale.Linear){if(this.minLimit===undefined){min=RL.Number.roundToBase(min,stepSize,-1,{threshDigits:tickDigits-1});}
if(this.maxLimit===undefined){max=RL.Number.roundToBase(max,stepSize,1,{threshDigits:tickDigits-1});}}else{min=Math.floor(RL.Math.log10(min));max=Math.ceil(RL.Math.log10(max));}
var numTicks=Math.round(((max-min)/stepSize)+1);var tickArr=[];for(var ii=0;ii<numTicks;ii+=1){var tick=min+(ii*stepSize);tick=RL.Number.round(tick,tickDigits);if(this.scale===RL.Canvas.AxisScale.Log){tick=Math.pow(10,tick);}
tickArr.push(tick);}
__tickArrayCalc=(tickArr.length>0)?tickArr:undefined;if(__tickArrayCalc===undefined){__stepSizeCalc=undefined;}}
this.__getTickLimits=function(){var min;var max;if(this.scale===RL.Canvas.AxisScale.Linear){var considerCrossingVal=(this.otherAxis.show&&!this.isBinned);if(this.minLimit!==undefined){min=this.minLimit;}else{min=considerCrossingVal?Math.min(this.bounds.min,this.otherAxis.crossingVal):this.bounds.min;}
if(this.maxLimit!==undefined){max=this.maxLimit;}else{max=considerCrossingVal?Math.max(this.bounds.max,this.otherAxis.crossingVal):this.bounds.max;}}else{min=(this.minLimit!==undefined)?this.minLimit:this.bounds.min;max=(this.maxLimit!==undefined)?this.maxLimit:this.bounds.max;}
return[min,max];}
this.__getTickTextArray=function(){var tickLblArr=this.tickLabels;if(tickLblArr&&tickLblArr.length>0){return tickLblArr;}else{var tickValueArr=this.ticks;if(tickValueArr&&tickValueArr.length>0){var formatTickArray=function(funcFormat){var tickTextArr=[];for(var ii=0;ii<tickValueArr.length;ii++){tickTextArr[ii]=funcFormat(tickValueArr[ii]);}
return tickTextArr;}
if(this.tickFormatFunct!==undefined&&typeof(this.tickFormatFunct)==="function"){return formatTickArray(this.tickFormatFunct);}else{if(this.scale===RL.Canvas.AxisScale.Linear){return RL.Canvas.get_TextArr_forScale(tickValueArr);}else{if(this.logTickFormat.toLowerCase()==='log'){var logFormat=function(value){var exp=RL.Math.log10(value);return'10'+RL.Unicode.superscript(exp);}
return formatTickArray(logFormat);}else{var tickTextArr=[];for(var ii=0;ii<tickValueArr.length;ii++){tickTextArr.push(RL.Number.format_Comma(tickValueArr[ii],{sigDigits:1}));}
return tickTextArr;}}}}else{return undefined;}}}
var __getTickTextLengths=function(){var tickTextLengths={longest:0,first:0,last:0};var tickArr=thisObj.__getTickTextArray();if(tickArr!==undefined&&tickArr.length>0){var textStats=RL.Canvas.Text.getTextArrayStats(canvasObj,tickArr,thisObj.tickTextSize);tickTextLengths.longest=textStats.maxWidth;tickTextLengths.first=textStats.firstWidth;tickTextLengths.last=textStats.lastWidth;}
return tickTextLengths;}
var __getTextRotation=function(){var rotDeg=0;if(thisObj.dir===RL.Canvas.AxisDir.X&&thisObj.show){var maxTickWidthPX=thisObj.__tickTextLengthsPX.longest;var stepPX=thisObj.stepSizePX;if(maxTickWidthPX>=0.99*stepPX){var widthAllow=0.75*stepPX;rotDeg=-1*Math.acos(widthAllow/maxTickWidthPX)*(180/Math.PI);}}
return rotDeg;}
var __drawIndividualTickText=function(tickText,pointPX){var options;if(thisObj.dir===RL.Canvas.AxisDir.X){var rotDeg=__getTextRotation();if(rotDeg===0){options={sizePX:thisObj.tickTextSize,ha:'center',va:'top'};}else{options={sizePX:thisObj.tickTextSize,ha:'start',va:'top',rotateDeg:rotDeg}}}else if(thisObj.dir===RL.Canvas.AxisDir.Y){options={sizePX:thisObj.tickTextSize,ha:'end',va:'middle'};}
RL.Canvas.Text.drawPX(canvasObj,tickText,pointPX,options);}}
RL.Canvas.Axis.getFunc_pointWithinLimits=function(canvasObj){var x_min=canvasObj.x_axis.__minLimitValue;var x_max=canvasObj.x_axis.__maxLimitValue;var y_min=canvasObj.y_axis.__minLimitValue;var y_max=canvasObj.y_axis.__maxLimitValue;var func_withinUserLimits=function(x,y){return(x>=x_min)&&(x<=x_max)&&(y>=y_min)&&(y<=y_max);}
return func_withinUserLimits;}
RL.Canvas.Legend=function(canvasObj,anchorPos){RL.Canvas.IDrawable.call(this);RL.Canvas.IPaddedItem.call(this);this.numCols=-2;this.show=false;this.boundingPoints=[];this.items=[];var borderPX=new RL.Vector2(10,4);var itemSpacingPX=new RL.Vector2(10,6);var thisObj=this;var __sizePX={width:0,height:0};Object.defineProperty(this,"sizePX",{get:function(){return __sizePX;}});this.anchorPosEnum=RL.Canvas.AnchorPositionEnum.LowerCenter;var __anchorRelativeToCanvas=true;Object.defineProperty(this,"anchorRelativeToCanvas",{get:function(){return __anchorRelativeToCanvas;},set:function(value){__anchorRelativeToCanvas=value;}});Object.defineProperty(this,"anchorRelativeToPlot",{get:function(){return!this.anchorRelativeToCanvas;},set:function(value){__anchorRelativeToCanvas=!value;}});var __vectorFromAnchorPX=undefined;Object.defineProperty(this,"vectorFromAnchorPX",{get:function(){if(__vectorFromAnchorPX){return __vectorFromAnchorPX;}else{var anchorEnum=this.anchorPosEnum;var vectFromAnchorPX=new RL.Vector2(-1,-1);var marginPX=10;if(anchorEnum===RL.Canvas.AnchorPositionEnum.UpperLeft||anchorEnum===RL.Canvas.AnchorPositionEnum.CenterLeft||anchorEnum===RL.Canvas.AnchorPositionEnum.LowerLeft){vectFromAnchorPX.x=marginPX+0.5*__sizePX.width;}else if(anchorEnum===RL.Canvas.AnchorPositionEnum.UpperRight||anchorEnum===RL.Canvas.AnchorPositionEnum.CenterRight||anchorEnum===RL.Canvas.AnchorPositionEnum.LowerRight){vectFromAnchorPX.x=-1*(marginPX+0.5*__sizePX.width);}else if(anchorEnum===RL.Canvas.AnchorPositionEnum.UpperCenter||anchorEnum===RL.Canvas.AnchorPositionEnum.CenterCenter||anchorEnum===RL.Canvas.AnchorPositionEnum.LowerCenter){vectFromAnchorPX.x=0;}
if(anchorEnum===RL.Canvas.AnchorPositionEnum.UpperLeft||anchorEnum===RL.Canvas.AnchorPositionEnum.UpperRight||anchorEnum===RL.Canvas.AnchorPositionEnum.UpperCenter){vectFromAnchorPX.y=-1*(marginPX+0.5*__sizePX.height);}else if(anchorEnum===RL.Canvas.AnchorPositionEnum.LowerLeft||anchorEnum===RL.Canvas.AnchorPositionEnum.LowerRight||anchorEnum===RL.Canvas.AnchorPositionEnum.LowerCenter){vectFromAnchorPX.y=marginPX+0.5*__sizePX.height;}else if(anchorEnum===RL.Canvas.AnchorPositionEnum.CenterLeft||anchorEnum===RL.Canvas.AnchorPositionEnum.CenterRight||anchorEnum===RL.Canvas.AnchorPositionEnum.CenterCenter){vectFromAnchorPX.y=0;}
if(vectFromAnchorPX.x===-1||vectFromAnchorPX.y===-1){console.warn('Legend anchor position not set properly!');}
return vectFromAnchorPX;}},set:function(value){__vectorFromAnchorPX=value;}});Object.defineProperty(this,"centerPosPX",{get:function(){if(this.anchorRelativeToCanvas){var anchorPos=new RL.Canvas.AnchorPosition(canvasObj,this.anchorPosEnum,this.vectorFromAnchorPX);return anchorPos.getPositionPX();}else{var ptUprLeftIN=new RL.Vector2(canvasObj.x_axis.minDrawVal,canvasObj.y_axis.maxDrawVal);var widthIN=canvasObj.x_axis.maxDrawVal-canvasObj.x_axis.minDrawVal;var heightIN=canvasObj.y_axis.maxDrawVal-canvasObj.y_axis.minDrawVal;var ptUprLeftPX=canvasObj.posConverter.convertPos_InToPx(ptUprLeftIN);var widthPX=canvasObj.posConverter.convertValue_InToPx(widthIN,'X');var heightPX=canvasObj.posConverter.convertValue_InToPx(heightIN,'Y');var anchorPosPX=RL.Canvas.AnchorPosition.getAnchorPosPX(this.anchorPosEnum,ptUprLeftPX,widthPX,heightPX);var vectorPX=new RL.Vector2(this.vectorFromAnchorPX.x,-1*this.vectorFromAnchorPX.y);return anchorPosPX.plus(vectorPX);}}});this.avoidChart=true;this.getPadArray=function(){if(!this.show){return;}
if(this.avoidChart===false){return;}
if(this.anchorRelativeToPlot){return;}
var padDic={side:'',padValue:0,isRigid:true}
var anchorPosEnum=this.anchorPosEnum;var centerPos=this.centerPosPX;var extraPad=4
var topDist=centerPos.y+0.5*thisObj.sizePX.height+extraPad;var bottomDist=(canvasObj.size.heightPX-centerPos.y)+0.5*thisObj.sizePX.height+extraPad;var leftDist=centerPos.x+0.5*thisObj.sizePX.width+extraPad;var rightDist=(canvasObj.size.widthPX-centerPos.x)+0.5*thisObj.sizePX.width+extraPad;if(anchorPosEnum===RL.Canvas.AnchorPositionEnum.LowerCenter){padDic.side='bottom';padDic.padValue=bottomDist;}else if(anchorPosEnum===RL.Canvas.AnchorPositionEnum.CenterRight){padDic.side='right';padDic.padValue=rightDist;}else if(anchorPosEnum===RL.Canvas.AnchorPositionEnum.CenterLeft){padDic.side='left';padDic.padValue=leftDist;}else if(anchorPosEnum===RL.Canvas.AnchorPositionEnum.UpperCenter){padDic.side='top';padDic.padValue=topDist;}else if(anchorPosEnum===RL.Canvas.AnchorPositionEnum.CenterCenter){}else{var shouldShrinkHeight=__checkShouldShrinkHeight();if(anchorPosEnum===RL.Canvas.AnchorPositionEnum.LowerRight){if(shouldShrinkHeight){padDic.side='bottom';padDic.padValue=bottomDist;}else{padDic.side='right';padDic.padValue=rightDist;}}else if(anchorPosEnum===RL.Canvas.AnchorPositionEnum.LowerLeft){if(shouldShrinkHeight){padDic.side='bottom';padDic.padValue=bottomDist;}else{padDic.side='left';padDic.padValue=leftDist;}}else if(anchorPosEnum===RL.Canvas.AnchorPositionEnum.UpperRight){if(shouldShrinkHeight){padDic.side='top';padDic.padValue=topDist;}else{padDic.side='right';padDic.padValue=rightDist;}}else if(anchorPosEnum===RL.Canvas.AnchorPositionEnum.UpperLeft){if(shouldShrinkHeight){padDic.side='top';padDic.padValue=topDist;}else{padDic.side='left';padDic.padValue=leftDist;}}}
return[padDic];}
this.addItem=function(legendItem){this.items.push(legendItem);}
this.draw=function(){if(!this.show){return;}
if(this.items.length==0){return;}
var posCntrPX=this.centerPosPX;var posUprLeftPX=new RL.Vector2(posCntrPX.x-0.5*__sizePX.width,posCntrPX.y-0.5*__sizePX.height);var posLwrRtPX=posUprLeftPX.plus(new RL.Vector2(__sizePX.width,__sizePX.height));RL.Canvas.Rectangle.drawPX(canvasObj,posUprLeftPX,posLwrRtPX,{fillColor:'White'});for(var ii=0;ii<this.items.length;ii+=1){var item=this.items[ii];var posPX=posUprLeftPX.plus(item.__vectFromUprLeft);item.draw(posPX);}
RL.Canvas.Rectangle.drawPX(canvasObj,posUprLeftPX,posLwrRtPX,{edgeColor:'Black',lineWidth:1});}
this.__updateSize=function(){var colData=__getColumnData();var numCols=colData.numCols;var colWidths=colData.colWidths;var posCrntPX=borderPX.copy();var legendSize={width:0,height:0};var colNum=1;var item;for(var ii=0;ii<thisObj.items.length;ii+=1){item=thisObj.items[ii];item.__vectFromUprLeft=posCrntPX.plus(new RL.Vector2(0,0.5*item.totalSizePX.height));var itemWidth=colWidths[colNum-1]||item.totalSizePX.width;var rightX=posCrntPX.x+itemWidth+itemSpacingPX.x;legendSize.width=Math.max(legendSize.width,rightX);if(ii<thisObj.items.length-1){colNum+=1;if(numCols>0&&colNum>numCols){colNum=1;posCrntPX.x=borderPX.x;posCrntPX.y=posCrntPX.y+item.totalSizePX.height+itemSpacingPX.y;}else{posCrntPX.x=rightX;}}}
if(item){legendSize.height=posCrntPX.y+item.totalSizePX.height+borderPX.y;}
__sizePX=legendSize;}
var __getColumnData=function(){var numCols=thisObj.numCols;var colWidths=[];if(numCols===-2){var anchorEnum=thisObj.anchorPosEnum;if(anchorEnum===RL.Canvas.AnchorPositionEnum.LowerLeft||anchorEnum===RL.Canvas.AnchorPositionEnum.LowerRight||anchorEnum===RL.Canvas.AnchorPositionEnum.LowerCenter){var colStats=RL.Math.getStatistics(thisObj.items,function(item){return item.totalSizePX.width});var maxAllow=canvasObj.size.availableDrawingWidthPX;numCols=Math.floor(maxAllow/(colStats.avg+itemSpacingPX.x));var widthArrTmp;var finished=false;while(finished===false){widthArrTmp=__getColumnWidths(numCols,maxAllow);if(widthArrTmp.length>0){finished=true;}else{numCols-=1;if(numCols<1){finished=true;}}}
numCols=Math.max(numCols,1);colWidths=(widthArrTmp.length===numCols)?widthArrTmp:[];}else{numCols=1;colWidths=[];}}else{var maxAllow=Number.MAX_VALUE;var widthArrTmp=__getColumnWidths(numCols,maxAllow);colWidths=(widthArrTmp.length===numCols)?widthArrTmp:[];}
return{numCols:numCols,colWidths:colWidths};}
var __getColumnWidths=function(numCols,maxAllow){var widthArr=[];var cursorLocPX=borderPX.x;var colNum=1;for(var ii=0;ii<thisObj.items.length;ii+=1){var item=thisObj.items[ii];var itemWidth=item.totalSizePX.width;var maxWidthCrnt=widthArr[colNum-1]||0;widthArr[colNum-1]=Math.max(itemWidth,maxWidthCrnt);cursorLocPX+=widthArr[colNum-1];if(cursorLocPX+borderPX.x>maxAllow){widthArr=[];break;}else if(colNum>=numCols){colNum=1;cursorLocPX=borderPX.x;}else{colNum+=1;cursorLocPX+=itemSpacingPX.x;}}
return widthArr;}
var __checkShouldShrinkHeight=function(){var shapeHeight=canvasObj.size.__bounds.hasValue?canvasObj.size.__bounds.height:1;var shapeWidth=canvasObj.size.__bounds.hasValue?canvasObj.size.__bounds.width:1;var getScaledArea=function(canvasWidth,canvasHeight){var scaledWidth;var scaledHeight;if(canvasObj.options.equalScaleFactors){var scaleFactor=Math.max(shapeWidth/canvasWidth,shapeHeight/canvasHeight);scaledWidth=shapeWidth/scaleFactor;scaledHeight=shapeHeight/scaleFactor;}else{scaledWidth=canvasWidth;scaledHeight=canvasHeight;}
return scaledWidth*scaledHeight;}
var cnvWidth1=canvasObj.size.availableDrawingWidthPX;var cnvHeight1=canvasObj.size.availableDrawingHeightPX-thisObj.sizePX.height;var areaShortFat=getScaledArea(cnvWidth1,cnvHeight1);var cnvWidth2=canvasObj.size.availableDrawingWidthPX-thisObj.sizePX.width;var cnvHeight2=canvasObj.size.availableDrawingHeightPX;var areaTallSkinny=getScaledArea(cnvWidth2,cnvHeight2);return(areaShortFat>=areaTallSkinny);}}
RL.Canvas.LegendItem=function(){RL.Canvas.IDrawable.call(this);this.textObj=undefined;this.boundingPoints=[];this.__vectFromUprLeft=undefined;this.spacePX=5;this.shapeSizePX={width:30,height:12};Object.defineProperty(this,"totalSizePX",{get:function(){return{width:this.shapeSizePX.width+this.spacePX+this.textObj.dimsPX.width,height:Math.max(this.shapeSizePX.height,this.textObj.dimsPX.height)};}});this.draw=function(pointPX){console.warn("ILegendItem: draw not implemented!");}}
RL.Canvas.LegendItem.Line=function(canvasObj,labelText,lineOptions,markerOptions){RL.Canvas.LegendItem.call(this);this.textObj=new RL.Canvas.Text(canvasObj,labelText,new RL.Vector2(0,0),{sizePX:11,ha:'start',va:'middle'});this.draw=function(pointPX){if(lineOptions){var linePt1=pointPX;var linePt2=pointPX.plus(new RL.Vector2(this.shapeSizePX.width,0));RL.Canvas.Line.drawPX(canvasObj,linePt1,linePt2,lineOptions);}
if(markerOptions){var mrkrPt=pointPX.plus(new RL.Vector2(0.5*this.shapeSizePX.width,0));RL.Canvas.Marker.drawPX(canvasObj,mrkrPt,markerOptions);}
var textPt=pointPX.plus(new RL.Vector2(this.shapeSizePX.width+this.spacePX,0));RL.Canvas.Text.drawPX(canvasObj,this.textObj.text,textPt,this.textObj.options);}}
RL.Canvas.LegendItem.Rectangle=function(canvasObj,labelText,rectOptions){RL.Canvas.LegendItem.call(this);this.textObj=new RL.Canvas.Text(canvasObj,labelText,new RL.Vector2(0,0),{sizePX:11,ha:'start',va:'middle'});this.draw=function(pointPX){var rectUprLftPt=pointPX.plus(new RL.Vector2(0,-0.5*this.shapeSizePX.height));var rectLwrRtPt=pointPX.plus(new RL.Vector2(this.shapeSizePX.width,0.5*this.shapeSizePX.height));RL.Canvas.Rectangle.drawPX(canvasObj,rectUprLftPt,rectLwrRtPt,rectOptions);var textPt=pointPX.plus(new RL.Vector2(this.shapeSizePX.width+this.spacePX,0));RL.Canvas.Text.drawPX(canvasObj,this.textObj.text,textPt,this.textObj.options);}}
RL.Canvas.ColorScale=function(canvasObj,minVal,maxVal,options){RL.Canvas.IDrawable.call(this);RL.Canvas.IPaddedItem.call(this);var options=options||{};var colorRGB1=options.colorRGB1||new RL.Color.RGB(230,0,0);var colorRGB2=options.colorRGB2||new RL.Color.RGB(0,0,230);var numSteps=options.numSteps||10;var allowWrap=options.allowWrap||false;var shiftProp=options.shiftProp||undefined;var textSize=options.textSize||11;var scaleMarginPX=10;var textOffsetPX=5;var tickWidthPX=5;var scaleWidthPX=25;this.boundingPoints=[];var thisObj=this;var __colorScale=undefined;var __values=undefined
var __textArr=undefined;var initialize=function(){if(!(colorRGB1 instanceof RL.Color.RGB)||!(colorRGB2 instanceof RL.Color.RGB)){console.warn('ColorScale: Colors must be Color.RGB instances!');return;}
__colorScale=RL.Color.getColorScale(colorRGB1,colorRGB2,numSteps,allowWrap,shiftProp);__values=RL.Math.linspace(maxVal,minVal,numSteps+1);__textArr=RL.Canvas.get_TextArr_forScale(__values);}();this.getColor=function(value){for(var ii=0;ii<__values.length-1;ii+=1){var maxVal=__values[ii];var minVal=__values[ii+1];if(maxVal>=value&&value>=minVal){return __colorScale[ii];}}
console.warn('ColorScale: Could not get color, value out of range.');var maxVal=__values[0];var minVal=__values[__values.length-1];if(value>maxVal){return __colorScale[0];}else if(value<minVal){return __colorScale[__values.length-1];}}
var __longestTextPX;Object.defineProperty(this,"__longestTextPX",{get:function(){if(__longestTextPX===undefined){__longestTextPX=RL.Canvas.Text.getTextArrayStats(canvasObj,__textArr,thisObj.textSize).maxWidth;}
return __longestTextPX;}});Object.defineProperty(this,"dimsPX",{get:function(){return{width:scaleWidthPX+textOffsetPX+this.__longestTextPX,height:textSize};}});this.getPadArray=function(){return[{side:'right',padValue:scaleMarginPX+this.dimsPX.width,isRigid:true}];}
this.draw=function(){var leftPX=canvasObj.size.widthPX-(scaleMarginPX+this.dimsPX.width);var rightPX=leftPX+scaleWidthPX;var topPX=canvasObj.size.totalMarginPX.top;var botPX=canvasObj.size.heightPX-canvasObj.size.totalMarginPX.bottom;var ticksY=RL.Math.linspace(topPX,botPX,numSteps+1);for(var ii=0;ii<numSteps;ii+=1){var color=__colorScale[ii];var tickTopY=Math.round(ticksY[ii]);var tickBotY=Math.round(ticksY[ii+1]);var ptUprLft=new RL.Vector2(leftPX,tickTopY);var ptLwrRt=new RL.Vector2(rightPX,tickBotY);RL.Canvas.Rectangle.drawPX(canvasObj,ptUprLft,ptLwrRt,{fillColor:color});}
for(var ii=0;ii<numSteps+1;ii+=1){var posY=ticksY[ii];if(ii!==0&&ii!==numSteps){var tickTopPt1=new RL.Vector2(rightPX-tickWidthPX,posY);var tickTopPt2=new RL.Vector2(rightPX,posY);RL.Canvas.Line.drawPX(canvasObj,tickTopPt1,tickTopPt2,{edgeColor:'Black',width:1});}
var text=__textArr[ii];var textPt=new RL.Vector2(rightPX+textOffsetPX,posY);RL.Canvas.Text.drawPX(canvasObj,text,textPt,{sizePX:textSize,ha:'start',va:'middle'});}
var ptUprLft=new RL.Vector2(leftPX,topPX);var ptLwrRt=new RL.Vector2(rightPX,botPX);RL.Canvas.Rectangle.drawPX(canvasObj,ptUprLft,ptLwrRt,{edgeColor:'Black',width:1});}}
RL.Canvas.LinePlot=function(canvasObj,points,options){RL.Canvas.IDrawable.call(this);var lineOptions=(options&&options.lineOptions)||undefined;var markerOptions=(options&&options.markerOptions)||undefined;var legendLabel=(options&&options.legendLabel)||undefined;var thisObj=this;var __pointsArr;var __pointMin;var __pointMax;Object.defineProperty(this,"boundingPoints",{get:function(){if(__pointMin&&__pointMax){return[__pointMin.copy(),__pointMax.copy()];}else{return[];}}});Object.defineProperty(this,"axisBounds",{get:function(){var bounds={x_min:undefined,x_max:undefined,y_min:undefined,y_max:undefined};if(__pointMin&&__pointMax){bounds.x_min=__pointMin.x;bounds.y_min=__pointMin.y;bounds.x_max=__pointMax.x;bounds.y_max=__pointMax.y;}
return bounds;}});this.finalize=function(){var funcInLimits=RL.Canvas.Axis.getFunc_pointWithinLimits(canvasObj);__pointsArr=RL.Canvas.__getPointArray(points,funcInLimits);if(__pointsArr.length>0){var bounds=RL.Vector2_Array.getMaxMin(__pointsArr);__pointMin=bounds.min;__pointMax=bounds.max;}}
this.draw=function(){if(lineOptions){for(var ii=1;ii<__pointsArr.length;ii++){var line=new RL.Canvas.Line(canvasObj,__pointsArr[ii-1],__pointsArr[ii],lineOptions);line.draw();}}
if(markerOptions){for(var ii=0;ii<__pointsArr.length;ii+=1){var marker=new RL.Canvas.Marker(canvasObj,__pointsArr[ii],markerOptions);marker.draw();}}}
if(legendLabel){var legendItem=new RL.Canvas.LegendItem.Line(canvasObj,legendLabel,lineOptions,markerOptions);canvasObj.legend.addItem(legendItem);}}
RL.Canvas.BarSeries=function(canvasObj,values,seriesOptions){this.points=[];this.barOptions=(seriesOptions&&seriesOptions.barOptions)||undefined;this.legendLabel=(seriesOptions&&seriesOptions.legendLabel)||undefined;var thisObj=this;var initialize=function(){thisObj.points=[];var crnt_x=1;for(var ii=0;ii<values.length;ii+=1){thisObj.points.push(new RL.Vector2(crnt_x,values[ii]));crnt_x+=1;}
if(thisObj.legendLabel){var rectOptions={edgeColor:thisObj.barOptions.edgeColor,fillColor:thisObj.barOptions.fillColor,lineWidth:thisObj.barOptions.lineWidth};var legendItem=new RL.Canvas.LegendItem.Rectangle(canvasObj,thisObj.legendLabel,rectOptions);canvasObj.legend.addItem(legendItem);}}();}
RL.Canvas.BarChart=function(canvasObj,seriesArr,chartOptions){RL.Canvas.IDrawable.call(this);this.seriesArr=seriesArr;this.boundingPoints=[];var axisLabels=(chartOptions&&chartOptions.axisLabels)||undefined;var binBufferPct=(chartOptions&&chartOptions.binBufferPct)||0.1;var barSpacingPX=(chartOptions&&chartOptions.barSpacingPX)||1;var maxBarWidthPct=(chartOptions&&chartOptions.maxBarWidthPct)||0.15;var thisObj=this;Object.defineProperty(this,"binWidth",{get:function(){var points=this.seriesArr[0].points;return(points.length>=2)?(points[1].x-points[0].x):1;}});var __pointMinDraw;var __pointMaxDraw;Object.defineProperty(this,"boundingPoints",{get:function(){if(__pointMinDraw&&__pointMaxDraw){return[__pointMinDraw.copy(),__pointMaxDraw.copy()];}else{return[];}}});var __pointMinAxis;var __pointMaxAxis;Object.defineProperty(this,"axisBounds",{get:function(){var bounds={x_min:undefined,x_max:undefined,y_min:undefined,y_max:undefined};if(__pointMinAxis&&__pointMaxAxis){bounds.x_min=__pointMinAxis.x;bounds.y_min=__pointMinAxis.y;bounds.x_max=__pointMaxAxis.x;bounds.y_max=__pointMaxAxis.y;}
return bounds;}});this.draw=function(){var numSeries=this.seriesArr.length;if(numSeries===0){return;}
var barSpacingIN=canvasObj.posConverter.convertValue_PxToIn(barSpacingPX,'X');var binWidth=this.binWidth;var binBufferIN=binBufferPct*binWidth;var axisWidth=canvasObj.x_axis.maxDrawVal-canvasObj.x_axis.minDrawVal;var width=(binWidth-binBufferIN-(barSpacingIN*(numSeries-1)))/numSeries;var maxWidth=maxBarWidthPct*axisWidth;if(width>maxWidth){var numBins=axisWidth/binWidth;var totalBarWidth=numBins*numSeries*maxWidth;binBufferIN=(axisWidth-totalBarWidth)/numBins;width=maxWidth;}
for(var ii=0;ii<this.seriesArr.length;ii+=1){var series=this.seriesArr[ii];for(var jj=0;jj<series.points.length;jj+=1){var point=series.points[jj];var height=point.y;var xLocStart=point.x-(0.5*binWidth)+(0.5*binBufferIN);var xLoc=xLocStart+(ii*(width+barSpacingIN))+(0.5*width);var rectOptions={edgeColor:series.barOptions.edgeColor,fillColor:series.barOptions.fillColor,lineWidth:series.barOptions.lineWidth};var rect=new RL.Canvas.Rectangle(canvasObj,new RL.Vector2(xLoc,0.5*height),width,height,rectOptions);rect.draw();}}}
var initialize=function(){if(axisLabels){canvasObj.x_axis.tickLabels=axisLabels;}
var minPt=new RL.Vector2(Number.MAX_VALUE,Number.MAX_VALUE);var maxPt=new RL.Vector2(-1*Number.MAX_VALUE,-1*Number.MAX_VALUE);for(var ii=0;ii<thisObj.seriesArr.length;ii+=1){var series=thisObj.seriesArr[ii];var bounds=RL.Vector2_Array.getMaxMin(series.points);minPt.x=Math.min(bounds.min.x,minPt.x);minPt.y=Math.min(bounds.min.y,minPt.y);maxPt.x=Math.max(bounds.max.x,maxPt.x);maxPt.y=Math.max(bounds.max.y,maxPt.y);}
minPt.y=Math.min(minPt.y,0);__pointMinAxis=minPt.copy();__pointMaxAxis=maxPt.copy();var binWidth=thisObj.binWidth;minPt.x-=0.5*binWidth;maxPt.x+=0.5*binWidth;__pointMinDraw=minPt;__pointMaxDraw=maxPt;}();}
RL.Canvas.PieItem=function(canvasObj,value,color,label){this.label=label||undefined;this.color=color||'Black';this.value=0;if(value!==undefined&&RL.Number.isNumeric(value,true)){value=Number(value);if(value>0){this.value=value;}}
var thisObj=this;var initialize=function(){if(thisObj.label){var rectOptions={fillColor:thisObj.color};var legendItem=new RL.Canvas.LegendItem.Rectangle(canvasObj,thisObj.label,rectOptions);canvasObj.legend.addItem(legendItem);}}();}
RL.Canvas.PieChart=function(canvasObj,pieItemArr,chartOptions){RL.Canvas.IDrawable.call(this);this.itemArr=pieItemArr;this.pieArray=undefined;var values=[];var colors=[];this.boundingPoints=[];Object.defineProperty(this,"axisBounds",{get:function(){var bounds={x_min:undefined,x_max:undefined,y_min:undefined,y_max:undefined};return bounds;}});var thisObj=this;this.draw=function(){this.pieArray.draw();}
var initialize=function(){for(var ii=0;ii<thisObj.itemArr.length;ii+=1){var pieItem=thisObj.itemArr[ii];values[ii]=pieItem.value;colors[ii]=pieItem.color;}
var cntrPt=new RL.Vector2(0,0);var dia=10;thisObj.pieArray=new RL.Canvas.PieArray(canvasObj,cntrPt,dia,values,colors,chartOptions);RL.Canvas
thisObj.boundingPoints=thisObj.pieArray.boundingPoints;}();}
RL.Canvas.Mouse=function(canvasObj){this.x=0;this.y=0;this.isDown=false;var thisMouse=this;this.onMouseMove=new RL.Subscription();this.onMouseDown=new RL.Subscription();this.onMouseUp=new RL.Subscription();var canvasElm=canvasObj.__canvasElm;var updateMousePosition=function(e){var bodyRect=document.body.getBoundingClientRect();var elemRect=canvasElm.getBoundingClientRect();var offsetLeft=elemRect.left-bodyRect.left;var offsetTop=elemRect.top-bodyRect.top;var posPX=new RL.Vector2(e.pageX-offsetLeft,e.pageY-offsetTop)
var posIN=canvasObj.posConverter.convertPos_PxToIn(posPX);thisMouse.x=posIN.x;thisMouse.y=posIN.y;}
var onMouseMove=function(e){updateMousePosition(e);thisMouse.onMouseMove.callSubscribers();}
var onMouseDown=function(e){if(e.which==1){updateMousePosition(e);thisMouse.isDown=true;thisMouse.onMouseDown.callSubscribers();}}
var onMouseUp=function(e){if(e.which==1){thisMouse.isDown=false;thisMouse.onMouseUp.callSubscribers();}}
canvasElm.onmousemove=onMouseMove;canvasElm.onmousedown=onMouseDown;canvasElm.onmouseup=onMouseUp;}
RL.Canvas.MouseCoordinates=function(canvasObj,_optionsDic){RL.Canvas.Text.call(this,canvasObj,'',-1,undefined);RL.Canvas.IPaddedItem.call(this);var thisObj=this;var options=_optionsDic||{};var unitStr=options.unitStr?(' '+options.unitStr):'';var marginPX=(options.marginPX!==undefined)?options.marginPX:23;this.text='';var getFormatFunc=function(propName_FormatFunc,propName_Digits){var formatFunc;if(options[propName_FormatFunc]){formatFunc=options[propName_FormatFunc];}else{var digits=(options[propName_Digits]!==undefined)?options[propName_Digits]:2;formatFunc=function(value){return RL.Number.format_Round(value,{digits:digits});}}
return formatFunc;}
var xFormatFunc=getFormatFunc('xFormatFunc','xDigits');var yFormatFunc=getFormatFunc('yFormatFunc','yDigits');this.anchorPos=new RL.Canvas.AnchorPosition(canvasObj,RL.Canvas.AnchorPositionEnum.LowerRight,new RL.Vector2(-10,5));this.options.sizePX=11;this.options.ha='end';this.options.va='bottom';this.getPadArray=function(){return[{side:'bottom',padValue:marginPX,isRigid:false}];}
var mouse=canvasObj.mouse;this.invalidate=function(){var lowerRightPtPX=this.anchorPos.getPositionPX();var upperLeftPtPX=new RL.Vector2(lowerRightPtPX.x-this.dimsPX.width,lowerRightPtPX.y-this.dimsPX.height);canvasObj.__context.clearRect(upperLeftPtPX.x-1,upperLeftPtPX.y-1,lowerRightPtPX.x+1,lowerRightPtPX.y+1);}
canvasObj.mouse.onMouseMove.subscribe(function(){thisObj.invalidate();thisObj.text='x: '+xFormatFunc(mouse.x)+unitStr+', y: '+yFormatFunc(mouse.y)+unitStr;thisObj.draw();});}
RL.Canvas.CoordinateSystem=function(canvasObj){RL.Canvas.IDrawable.call(this);RL.Canvas.IPaddedItem.call(this);this.boundingPoints=[];this.anchorPos=new RL.Canvas.AnchorPosition(canvasObj,RL.Canvas.AnchorPositionEnum.LowerLeft,new RL.Vector2(10,10));this.getPadArray=function(){return[{side:'left',padValue:17,isRigid:false},{side:'bottom',padValue:17,isRigid:false}];}
this.draw=function(){var tailPtIN=this.anchorPos.getPositionIN();var arrowLenPX=50,textOffsetPX=5;var arrowLenIN_X=canvasObj.posConverter.convertValue_PxToIn(arrowLenPX,'X');var arrowLenIN_Y=canvasObj.posConverter.convertValue_PxToIn(arrowLenPX,'Y');var textOffsetIN_X=canvasObj.posConverter.convertValue_PxToIn(textOffsetPX,'X');var textOffsetIN_Y=canvasObj.posConverter.convertValue_PxToIn(textOffsetPX,'Y');var tipX_IN=new RL.Vector2(tailPtIN.x+arrowLenIN_X,tailPtIN.y);var tipY_IN=new RL.Vector2(tailPtIN.x,tailPtIN.y+arrowLenIN_Y);var arrow_X=new RL.Canvas.Arrow(canvasObj,tailPtIN,tipX_IN,{headLen:0.15});var arrow_Y=new RL.Canvas.Arrow(canvasObj,tailPtIN,tipY_IN,{headLen:0.15});var text_X=new RL.Canvas.Text(canvasObj,'X',new RL.Vector2(tipX_IN.x+textOffsetIN_X,tipX_IN.y),{sizePx:12,va:'middle'});var text_Y=new RL.Canvas.Text(canvasObj,'Y',new RL.Vector2(tipY_IN.x,tipY_IN.y+textOffsetIN_Y),{sizePx:12,ha:'center'});arrow_X.draw();text_X.draw();arrow_Y.draw();text_Y.draw();}}
RL.Canvas.Text=function(canvasObj,text,point,options){RL.Canvas.IDrawable.call(this);RL.Canvas.IHitTestable.call(this);var thisObj=this;var __text=text;Object.defineProperty(this,"text",{get:function(){return __text;},set:function(value){__text=value;setTextSize();}});this.point=undefined;this.anchorPos=undefined;if(point instanceof RL.Vector2){this.point=point;}else if(point instanceof RL.Canvas.AnchorPosition){this.anchorPos=point;}else if(point!==-1){throw new Error('Invalid point specified for Text!');}
this.funcDelayedPosition=undefined;this.options=RL.Canvas.Text.__setOptions(options);Object.defineProperty(this,"sizePX",{get:function(){return this.options.sizePX;}});Object.defineProperty(this,"ha",{get:function(){return this.options.ha;}});Object.defineProperty(this,"va",{get:function(){return this.options.va;}});Object.defineProperty(this,"color",{get:function(){return this.options.color;}});Object.defineProperty(this,"fontFam",{get:function(){return this.options.fontFam;}});Object.defineProperty(this,"rotateDeg",{get:function(){return this.options.rotateDeg;}});Object.defineProperty(this,"rotateRad",{get:function(){return this.rotateDeg*(Math.PI/180);}});var __widthPX=undefined;Object.defineProperty(this,"dimsPX",{get:function(){return{width:__widthPX,height:this.sizePX}}});Object.defineProperty(this,"dimsIN",{get:function(){return{width:canvasObj.posConverter.convertValue_PxToIn(this.dimsPX.width,'X'),height:canvasObj.posConverter.convertValue_PxToIn(this.dimsPX.height,'Y')}}});Object.defineProperty(this,"boundingPointsPX",{get:function(){if(this.point){var pointPX=canvasObj.posConverter.convertPos_InToPx(this.point);var ptAnchor=pointPX.copy();var ptOpp=new RL.Vector2(ptAnchor.x+this.dimsPX.width,ptAnchor.y-this.dimsPX.height);if(this.ha=='end'){ptOpp.x=ptAnchor.x-this.dimsPX.width;}else if(this.ha=='center'){ptAnchor.x=ptAnchor.x-0.5*this.dimsPX.width;ptOpp.x=ptAnchor.x+this.dimsPX.width;}
if(this.va=='top'){ptOpp.y=ptAnchor.y+this.dimsPX.height;}else if(this.va=='middle'){ptAnchor.y=ptAnchor.y+0.5*this.dimsPX.height;ptOpp.y=ptAnchor.y-this.dimsPX.height;}
var ptOther1=new RL.Vector2(ptAnchor.x,ptOpp.y);var ptOther2=new RL.Vector2(ptOpp.x,ptAnchor.y);if(this.rotateDeg!==0){ptAnchor=ptAnchor.rotateAbout(pointPX,-1*this.rotateDeg,false);ptOpp=ptOpp.rotateAbout(pointPX,-1*this.rotateDeg,false);ptOther1=ptOther1.rotateAbout(pointPX,-1*this.rotateDeg,false);ptOther2=ptOther2.rotateAbout(pointPX,-1*this.rotateDeg,false);}
return[ptAnchor,ptOpp,ptOther1,ptOther2];}else{return[];}}});Object.defineProperty(this,"boundingPoints",{get:function(){var boundPtsPX=this.boundingPointsPX;if(boundPtsPX.length>0){return canvasObj.posConverter.convertPos_PxToIn(boundPtsPX);}
return[];}});Object.defineProperty(this,"perimeterPoints",{get:function(){var perimPts=this.boundingPoints;if(perimPts.length>0){var ptAnchor=perimPts[0];var ptOpp=perimPts[1];var ptOther1=perimPts[2];var ptOther2=perimPts[3];perimPts.push(ptAnchor.interpolate(ptOther2,0.5));perimPts.push(ptOpp.interpolate(ptOther1,0.5));perimPts.push(ptAnchor.interpolate(ptOther1,0.5));perimPts.push(ptOpp.interpolate(ptOther2,0.5));}
return perimPts;}});Object.defineProperty(this,"boundingBox",{get:function(){var boundBox=new RL.Canvas.BoundingBox(canvasObj);boundBox.updateBounds(this.boundingPoints);return boundBox;}});var __hitID=undefined;var __listNum=canvasObj.__textShapes.length;Object.defineProperty(this,"hitID",{get:function(){if(__hitID===undefined){var strID=__listNum+', '+this.text;if(this.point){strID+=', '+this.point.toString();}
if(this.anchorPos){strID+=', '+this.anchorPos.toString();}
__hitID=strID;}
return __hitID;}});this.hitTest=function(pointArr,_options){var options=_options||{};var hitID=options.hitID||undefined;if(hitID&&hitID===this.hitID){return false;}
if(this.rotateDeg===0){var boundPts=this.boundingPoints;if(boundPts.length>0){var hitBox=new RL.Canvas.HitBox(boundPts);return hitBox.hitTest(pointArr);}else{return false;}}else{return false;}}
this.draw=function(){var posPX;if(this.anchorPos){posPX=this.anchorPos.getPositionPX();}else{posPX=canvasObj.posConverter.convertPos_InToPx(this.point);}
RL.Canvas.Text.drawPX(canvasObj,this.text,posPX,this.options);if(canvasObj.options.showTextBoundingPoints){this.drawBoundingPoints();}}
this.drawBoundingPoints=function(){var boundingPoints=this.boundingPoints;for(var ii=0;ii<boundingPoints.length;ii+=1){var color=(ii==0)?'red':'blue';var point=new RL.Canvas.Point(canvasObj,boundingPoints[ii],{radPX:2,color:color});point.draw();}}
this.updatePositionSmart=function(options){if(!this.point){throw new Error("Text Error: Can't do smart update without a point set!");}
var basePt=this.point.copy();this.funcDelayedPosition=function(){var pointPX=canvasObj.posConverter.convertPos_InToPx(basePt);var bounds=canvasObj.size.__bounds;var cntrPt=bounds.centerPt;var cntrPtPX=canvasObj.posConverter.convertPos_InToPx(cntrPt);options=options||{};var isPX=(options.isPX===undefined)?true:options.isPX;var dirVect=(options.dirVect&&options.dirVect instanceof RL.Vector2)?options.dirVect:undefined;var preferredAlign=options.preferredAlignment||{};var allowOpposite=(options.allowOpposite===true)?true:false;var scoringDic=options.scoringDic||{};var offsetPX;if(options.offset===undefined){offsetPX=35;}else{offsetPX=isPX?options.offset:canvasObj.posConverter.convertValue_InToPx(options.offset,dirVect);}
var offsetVect;if(dirVect){offsetVect=dirVect.unitVector(offsetPX);offsetVect.y*=-1;}else{if(cntrPtPX.isEqualTo(pointPX)){cntrPtPX.x+=10;}
offsetVect=pointPX.minus(cntrPtPX).unitVector(offsetPX);}
var getAlignment=function(offsetVect){var alignment={ha:'',va:''};var vertThresh=0.3;if(preferredAlign.ha==='center'){vertThresh=3;}
if(offsetVect.isBasicallyVertical(vertThresh)){alignment.ha='center';}else{alignment.ha=offsetVect.x>0?'start':'end';}
var horizThresh=0.35;if(preferredAlign.va==='middle'){horizThresh=3;}
if(offsetVect.isBasicallyHorizontal(horizThresh)){alignment.va='middle';}else{alignment.va=offsetVect.y<0?'bottom':'top';}
return alignment;}
var newPoint;var offsetVectBL=offsetVect.copy();var pointBL=pointPX.plus(offsetVectBL);var pointBL_IN=canvasObj.posConverter.convertPos_PxToIn(pointBL);var highScore=0;var rotAngles=[0,30,60,90,120,150,180,210,240,270,300,330];for(var ii=0;ii<rotAngles.length;ii+=1){var rot=rotAngles[ii];var locTempPX=pointBL.rotateAbout(pointPX,rot)
var locTempIN=canvasObj.posConverter.convertPos_PxToIn(locTempPX);var offsetTempPX=locTempPX.minus(pointPX);var alignTemp=getAlignment(offsetTempPX);var textTemp=new RL.Canvas.Text(canvasObj,this.text,locTempIN,{sizePX:this.sizePX,ha:alignTemp.ha,va:alignTemp.va});if(!dirVect){scoringDic.maxDirScore=0;}
var scores=RL.Canvas.Text.Scoring.calculateScores(canvasObj,scoringDic,highScore,textTemp,this.hitID,basePt,pointBL_IN,allowOpposite);scores.rot=rot;if(scores.finalScore>highScore){highScore=scores.finalScore;newPoint=locTempIN;offsetVect=offsetTempPX;}}
this.point=newPoint;var alignment=getAlignment(offsetVect);this.options.ha=alignment.ha;this.options.va=alignment.va;}}
var setTextSize=function(){canvasObj.__context.save();canvasObj.__context.font=String(thisObj.sizePX)+'px '+thisObj.fontFam;__widthPX=canvasObj.__context.measureText(thisObj.text).width;canvasObj.__context.restore();}
setTextSize();}
RL.Canvas.Text.__setOptions=function(options){options=options||{};options.sizePX=options.sizePX||12;options.ha=options.ha||'start';options.va=options.va||'bottom';options.color=options.color||'Black';options.fontFam=options.fontFam||'sans-serif';options.bold=options.bold||false;options.italic=options.italic||false;options.rotateDeg=options.rotateDeg||0;return options;}
RL.Canvas.Text.drawPX=function(canvasObj,text,pointPX,options){options=RL.Canvas.Text.__setOptions(options);var rotateRad=options.rotateDeg*(Math.PI/180);canvasObj.__context.save();var styleStr=(options.bold?'bold ':'')+(options.italic?'italic ':'');canvasObj.__context.font=styleStr+String(options.sizePX)+'px '+options.fontFam;canvasObj.__context.fillStyle=options.color;canvasObj.__context.textAlign=options.ha;canvasObj.__context.textBaseline=options.va;canvasObj.__context.translate(pointPX.x,pointPX.y);canvasObj.__context.rotate(-1*rotateRad);canvasObj.__context.fillText(text,0,0);canvasObj.__context.restore();}
RL.Canvas.Text.getDims=function(canvasObj,textStr,textSizePX){var textObj=new RL.Canvas.Text(canvasObj,textStr,-1,{sizePX:textSizePX});return{dimsIN:textObj.dimsIN,dimsPX:textObj.dimsPX};}
RL.Canvas.Text.getTextArrayStats=function(canvasObj,textArr,textSizePX){var maxWidth=0;var maxTextObj;var firstWidth=0;var firstTextObj;var lastWidth=0;var lastTextObj;for(var ii=0;ii<textArr.length;ii+=1){var text=new RL.Canvas.Text(canvasObj,textArr[ii],-1,{sizePX:textSizePX});if(text.dimsPX.width>maxWidth){maxWidth=text.dimsPX.width;maxTextObj=text;}
if(ii===0){firstWidth=text.dimsPX.width;firstTextObj=text;}else if(ii===textArr.length-1){lastWidth=text.dimsPX.width;lastTextObj=text;}}
return{maxWidth:maxWidth,maxTextObj:maxTextObj,firstWidth:firstWidth,firstTextObj:firstTextObj,lastWidth:lastWidth,lastTextObj:lastTextObj}}
RL.Canvas.Text.Scoring=function(){}
RL.Canvas.Text.Scoring.calculateScores=function(canvasObj,scoringDic,highScore,textObj,otherHitID,basePtIN,dirRefPtIN,allowOpposite){if(!scoringDic||Object.keys(scoringDic).length===0){scoringDic=RL.Canvas.Text.Scoring.getDefaultScoringDic();}
var textPtIN=textObj.point;var perimPts=textObj.perimeterPoints;var scoreDir=0;var scoreAwayCntr=0;var scoreHitMap=0;var scoreBB=0;var scoreNoGrow=0;scoreDir+=RL.Canvas.Text.Scoring.__getScore_Direction(canvasObj,scoringDic.maxDirScore,textPtIN,basePtIN,dirRefPtIN,allowOpposite);scoreAwayCntr+=RL.Canvas.Text.Scoring.__getScore_AwayCntr(canvasObj,scoringDic.maxAwayCntrScore,textPtIN,basePtIN);scoreBB+=RL.Canvas.Text.Scoring.__getScore_BoundingBox(canvasObj,scoringDic.maxBBScore,textPtIN);scoreNoGrow+=RL.Canvas.Text.Scoring.__getScore_NoGrow(canvasObj,scoringDic.maxNoGrowScore,perimPts);var scoreCrnt=scoreDir+scoreAwayCntr+scoreBB+scoreNoGrow;var maxHitMapScore=scoringDic.maxHitMapScore||0;if(maxHitMapScore>highScore-scoreCrnt){scoreHitMap+=RL.Canvas.Text.Scoring.__getScore_HitMap(canvasObj,scoringDic.maxHitMapScore,perimPts,otherHitID);}
var finalScore=scoreDir+scoreAwayCntr+scoreBB+scoreNoGrow+scoreHitMap;return{finalScore:finalScore,scoreDir:scoreDir,scoreAwayCntr:scoreAwayCntr,scoreHitMap:scoreHitMap,scoreBB:scoreBB,scoreNoGrow:scoreNoGrow,textPt:textPtIN};}
RL.Canvas.Text.Scoring.getDefaultScoringDic=function(){return{maxDirScore:15,maxAwayCntrScore:10,maxHitMapScore:30,maxBBScore:0,maxNoGrowScore:10}}
RL.Canvas.Text.Scoring.__getScore_Direction=function(canvasObj,maxScore,pointIN,basePtIN,dirRefPtIN,allowOpposite){var score=0;if(maxScore>0){if(pointIN===undefined||basePtIN===undefined||dirRefPtIN===undefined){return 0;}
var pointArrPX=canvasObj.posConverter.convertPos_InToPx([pointIN,basePtIN,dirRefPtIN]);var pointPX=pointArrPX[0];var basePtPX=pointArrPX[1];var refPtPX=pointArrPX[2];var vect=pointPX.minus(basePtPX);var vectRef=refPtPX.minus(basePtPX);var projLen=vect.scalarProjectionOnto(vectRef);if(allowOpposite){projLen=Math.abs(projLen);}else{projLen=Math.max(projLen,0);}
var projLenPr=projLen/vect.length;score+=maxScore*projLenPr;}
return score;}
RL.Canvas.Text.Scoring.__getScore_AwayCntr=function(canvasObj,maxScore,pointIN,basePtIN){var score=0;if(maxScore>0){var bounds=canvasObj.size.__bounds;var cntrPtIN=bounds.centerPt;var pointArrPX=canvasObj.posConverter.convertPos_InToPx([cntrPtIN,pointIN,basePtIN]);var cntrPtPX=pointArrPX[0];var pointPX=pointArrPX[1];var basePtPX=pointArrPX[2];var dist_cntrToBase=basePtPX.minus(cntrPtPX).length;var dist_baseToPt=pointPX.minus(basePtPX).length;var radPX=dist_cntrToBase+dist_baseToPt;var cntrDistPX=pointPX.minus(cntrPtPX).length;var cntrProp=cntrDistPX/radPX;score+=maxScore*cntrProp;}
return score;}
RL.Canvas.Text.Scoring.__getScore_NoGrow=function(canvasObj,maxScore,perimPtsIN){var score=0;if(maxScore>0){var bounds=canvasObj.size.__bounds;var distOutsideBounds=0;for(var ii=0;ii<perimPtsIN.length;ii+=1){var pt=perimPtsIN[ii];var distOut=bounds.distOutsideBounds(pt);distOutsideBounds=Math.max(distOutsideBounds,distOut);}
var pctOutside=distOutsideBounds/bounds.maxDim;var maxPctOut=0.3;var pctScore=Math.max(maxPctOut-pctOutside,0)/maxPctOut;score+=pctScore*maxScore;}
return score;}
RL.Canvas.Text.Scoring.__getScore_BoundingBox=function(canvasObj,maxScore,pointIN){var score=0;if(maxScore>0){var bounds=canvasObj.size.__bounds;if(!bounds.hitTest([pointIN])){score+=maxScore;}}
return score;}
RL.Canvas.Text.Scoring.__getScore_HitMap=function(canvasObj,maxScore,perimPtsIN,hitID){var score=0;if(maxScore>0){if(!canvasObj.hitMap.hitTest(perimPtsIN,hitID)){score+=maxScore;}}
return score;}
RL.Canvas.Annotation=function(canvasObj,text,targetPoint,options){RL.Canvas.IDrawable.call(this);RL.Canvas.IHitTestable.call(this);this.textObj=undefined;this.arrowObj=undefined;var targetPoint=targetPoint;options=options||{};var textPoint=options.textPoint||undefined;var dirVect=options.dirVect||undefined;var lengthPX=options.lengthPX||undefined;var targetOffsetPX=options.targetOffsetPX||undefined;var updatePosSmart=options.updatePosSmart||(textPoint?false:true);var textOptions=options.textOptions||{};var arrowOptions=options.arrowOptions||{};var scoringDic=options.scoringDic||{};var allowOpposite=options.allowOpposite||undefined;if(arrowOptions.headLenPr===undefined&&arrowOptions.headLenPX===undefined){arrowOptions.headLenPX=8;}
var thisObj=this;Object.defineProperty(this,"boundingPoints",{get:function(){var boundPts=[this.textObj.point,targetPoint];boundPts=boundPts.concat(this.textObj.boundingPoints);return boundPts;}});this.hitTest=function(pointArr,_options){return this.textObj.hitTest(pointArr,_options);}
this.draw=function(){var arrowObj=this.__getArrow();arrowObj.draw();this.textObj.draw();}
this.__getArrow=function(){var tipPt;if(targetOffsetPX){var pointArrPX=canvasObj.posConverter.convertPos_InToPx([this.textObj.point,targetPoint]);var textPtPX=pointArrPX[0];var targetPtPX=pointArrPX[1];var deltaPX=textPtPX.minus(targetPtPX).unitVector(targetOffsetPX);var tipPtPX=targetPtPX.plus(deltaPX);tipPt=canvasObj.posConverter.convertPos_PxToIn(tipPtPX);}else{tipPt=targetPoint;}
var tailPt=this.textObj.point.copy();var offsetIN_X=canvasObj.posConverter.convertValue_PxToIn(4,'X');if(this.textObj.ha==='start'){tailPt.x-=offsetIN_X;}else if(this.textObj.ha==='end'){tailPt.x+=offsetIN_X;}
var offsetIN_Y=canvasObj.posConverter.convertValue_PxToIn(4,'Y');if(this.textObj.va==='bottom'){tailPt.y-=offsetIN_Y;}else if(this.textObj.va==='top'){tailPt.y+=offsetIN_Y;}
return new RL.Canvas.Arrow(canvasObj,tailPt,tipPt,arrowOptions);}
var __setTextObj=function(){if(!updatePosSmart){thisObj.textObj=new RL.Canvas.Text(canvasObj,text,textPoint,textOptions);}else{var textOptionsCopy=RL.Object.copyProperties(textOptions);thisObj.textObj=new RL.Canvas.Text(canvasObj,text,targetPoint,textOptionsCopy);thisObj.funcDelayedPosition=function(){var dirVectCalc;var lengthCalc;if(textPoint){var pointArrPX=canvasObj.posConverter.convertPos_InToPx([textPoint,targetPoint]);var textPointPX=pointArrPX[0];var targetPointPX=pointArrPX[1];dirVectCalc=textPointPX.minus(targetPointPX);dirVectCalc.y*=-1;lengthCalc=dirVectCalc.length;}else{dirVectCalc=dirVect||undefined;lengthCalc=lengthPX||35;}
var preferredAlign={};if(textOptions.ha){preferredAlign.ha=textOptions.ha;}
if(textOptions.va){preferredAlign.va=textOptions.va;}
thisObj.textObj.point=targetPoint;thisObj.textObj.updatePositionSmart({offset:lengthCalc,dirVect:dirVectCalc,isPX:true,scoringDic:scoringDic,preferredAlignment:preferredAlign,allowOpposite:allowOpposite});thisObj.textObj.funcDelayedPosition();};}}();}
RL.Canvas.Point=function(canvasObj,point,options){RL.Canvas.IDrawable.call(this);this.point=RL.Canvas.__getPoint(point);this.options=RL.Canvas.Point.__setOptions(options);Object.defineProperty(this,"radPX",{get:function(){return this.options.radPX;}});Object.defineProperty(this,"color",{get:function(){return this.options.color;}});this.boundingPoints=[this.point];this.draw=function(){var posPX=canvasObj.posConverter.convertPos_InToPx(this.point);RL.Canvas.Point.drawPX(canvasObj,posPX,this.options);}}
RL.Canvas.Point.__setOptions=function(options){options=options||{};options.radPX=options.radPX||4;options.color=options.color||'Black';return options;}
RL.Canvas.Point.drawPX=function(canvasObj,pointPX,options){pointPX=RL.Canvas.__getPoint(pointPX);options=RL.Canvas.Text.__setOptions(options);canvasObj.__context.save();canvasObj.__context.fillStyle=RL.Canvas.get_ColorStr(options.color);canvasObj.__context.translate(pointPX.x,pointPX.y);canvasObj.__context.beginPath();canvasObj.__context.arc(0,0,options.radPX,0,Math.PI*2,true);canvasObj.__context.fill();canvasObj.__context.closePath();canvasObj.__context.restore();}
RL.Canvas.Marker=function(canvasObj,point,options){RL.Canvas.IDrawable.call(this);this.point=RL.Canvas.__getPoint(point);this.options=RL.Canvas.Marker.__setOptions(options);Object.defineProperty(this,"sizePX",{get:function(){return this.options.sizePX;}});Object.defineProperty(this,"color",{get:function(){return this.options.color;}});Object.defineProperty(this,"style",{get:function(){return this.options.style;}});this.boundingPoints=[];if(this.point){this.boundingPoints=[this.point];}
this.draw=function(){var posPX=canvasObj.posConverter.convertPos_InToPx(this.point);RL.Canvas.Marker.drawPX(canvasObj,posPX,this.options);}}
RL.Canvas.Marker.__setOptions=function(options){options=options||{};options.sizePX=options.sizePX!==undefined?options.sizePX:6;options.style=options.style||'point';options.color=options.color||undefined;options.edgeColor=options.edgeColor||undefined;options.lineWidth=options.lineWidth||undefined;return options;}
RL.Canvas.Marker.drawPX=function(canvasObj,pointPX,options){pointPX=RL.Canvas.__getPoint(pointPX);options=RL.Canvas.Marker.__setOptions(options);var sizePX=options.sizePX;var lineWidth=options.lineWidth?options.lineWidth:(options.edgeColor?0.5:undefined);if(options.style==='point'||options.style==='.'){RL.Canvas.Point.drawPX(canvasObj,pointPX,{radPX:0.5*sizePX,color:options.color});}else if(options.style==='circle'||options.style==='o'){RL.Canvas.Circle.drawPX(canvasObj,pointPX,sizePX,{fillColor:options.color,edgeColor:options.edgeColor,lineWidth:lineWidth});}else if(options.style==='triangle'){var scale=1.325;var pt1=pointPX.plus(new RL.Vector2(0,-1*scale*(2/3)*sizePX));var pt2=pointPX.plus(new RL.Vector2(-1*scale*0.5*sizePX,scale*(1/3)*sizePX));var pt3=pointPX.plus(new RL.Vector2(scale*0.5*sizePX,scale*(1/3)*sizePX));RL.Canvas.Triangle.drawPX(canvasObj,pt1,pt2,pt3,{fillColor:options.color,edgeColor:options.edgeColor,lineWidth:lineWidth});}else if(options.style==='square'){var ptUprLft=pointPX.plus(new RL.Vector2(-0.5*sizePX,-0.5*sizePX));var ptLwrRt=pointPX.plus(new RL.Vector2(0.5*sizePX,0.5*sizePX));RL.Canvas.Rectangle.drawPX(canvasObj,ptUprLft,ptLwrRt,{fillColor:options.color,edgeColor:options.edgeColor,lineWidth:lineWidth});}else if(options.style==='diamond'){var pt1=pointPX.plus(new RL.Vector2(0,-0.75*sizePX));var pt2=pointPX.plus(new RL.Vector2(-0.6*sizePX,0));var pt3=pointPX.plus(new RL.Vector2(0,0.75*sizePX));var pt4=pointPX.plus(new RL.Vector2(0.6*sizePX,0));RL.Canvas.Polygon.drawPX(canvasObj,[pt1,pt2,pt3,pt4],{fillColor:options.color,edgeColor:options.edgeColor,lineWidth:lineWidth});}else if(options.style==='plus'||options.style==='+'){var pt1=pointPX.plus(new RL.Vector2(0,0.75*sizePX));var pt2=pointPX.plus(new RL.Vector2(0,-0.75*sizePX));RL.Canvas.Line.drawPX(canvasObj,pt1,pt2,{width:1,color:options.color});var pt3=pointPX.plus(new RL.Vector2(-0.75*sizePX,0));var pt4=pointPX.plus(new RL.Vector2(0.75*sizePX,0));RL.Canvas.Line.drawPX(canvasObj,pt3,pt4,{width:1,color:options.color});}else if(options.style==='x'){var prop=0.55;var pt1=pointPX.plus(new RL.Vector2(prop*sizePX,prop*sizePX));var pt2=pointPX.plus(new RL.Vector2(-prop*sizePX,-prop*sizePX));RL.Canvas.Line.drawPX(canvasObj,pt1,pt2,{width:1,color:options.color});var pt3=pointPX.plus(new RL.Vector2(-prop*sizePX,prop*sizePX));var pt4=pointPX.plus(new RL.Vector2(prop*sizePX,-prop*sizePX));RL.Canvas.Line.drawPX(canvasObj,pt3,pt4,{width:1,color:options.color});}}
RL.Canvas.Line=function(canvasObj,point1,point2,options){RL.Canvas.IDrawable.call(this);this.point1=RL.Canvas.__getPoint(point1);this.point2=RL.Canvas.__getPoint(point2);this.options=RL.Canvas.Line.__setOptions(options);Object.defineProperty(this,"width",{get:function(){return this.options.width;}});Object.defineProperty(this,"color",{get:function(){return this.options.color;}});Object.defineProperty(this,"style",{get:function(){return this.options.style;}});this.boundingPoints=[];if(this.point1&&this.point2){this.boundingPoints=[this.point1,this.point2];}
this.draw=function(){var posPx1=canvasObj.posConverter.convertPos_InToPx(this.point1);var posPx2=canvasObj.posConverter.convertPos_InToPx(this.point2);RL.Canvas.Line.drawPX(canvasObj,posPx1,posPx2,this.options);}}
RL.Canvas.Line.__setOptions=function(options){options=options||{};options.width=options.width||1;options.style=options.style||'solid';options.color=options.color||'Black';return options;}
RL.Canvas.Line.drawPX=function(canvasObj,pointPX1,pointPX2,options){pointPX1=RL.Canvas.__getPoint(pointPX1);pointPX2=RL.Canvas.__getPoint(pointPX2);options=RL.Canvas.Line.__setOptions(options);canvasObj.__context.save();var dashLen=4;try{if(options.style==='dashed'||options.style==='--'){canvasObj.__context.setLineDash([dashLen*options.width,dashLen*options.width]);}else if(options.style==='dashdot'||options.style==='-.'){canvasObj.__context.setLineDash([dashLen*options.width,dashLen*options.width,1*options.width,dashLen*options.width]);}else if(options.style==='dotted'||options.style===':'){canvasObj.__context.setLineDash([options.width,options.width]);}}catch(ex){}
canvasObj.__context.strokeStyle=RL.Canvas.get_ColorStr(options.color);canvasObj.__context.lineWidth=options.width;canvasObj.__context.beginPath();canvasObj.__context.moveTo(pointPX1.x,pointPX1.y);canvasObj.__context.lineTo(pointPX2.x,pointPX2.y);canvasObj.__context.stroke();canvasObj.__context.closePath();canvasObj.__context.restore();}
RL.Canvas.Cross=function(canvasObj,point,width,height,rotateDeg,options){RL.Canvas.IDrawable.call(this);this.point=RL.Canvas.__getPoint(point);Object.defineProperty(this,"boundingPoints",{get:function(){return this.getPoints();}});this.draw=function(){var points=this.getPoints();var lineVert=new RL.Canvas.Line(canvasObj,points[0],points[1],options);var lineHoriz=new RL.Canvas.Line(canvasObj,points[2],points[3],options);lineVert.draw();lineHoriz.draw();}
this.getPoints=function(){var pointsUnrot=[new RL.Vector2(this.point.x,this.point.y+0.5*height),new RL.Vector2(this.point.x,this.point.y-0.5*height),new RL.Vector2(this.point.x-0.5*width,this.point.y),new RL.Vector2(this.point.x+0.5*width,this.point.y)];var pointsRot=[];for(var ii=0;ii<pointsUnrot.length;ii++){var ptUnrot=pointsUnrot[ii];var ptRot=ptUnrot.rotateAbout(this.point,rotateDeg);pointsRot.push(ptRot);}
return pointsRot;}}
RL.Canvas.Circle=function(canvasObj,point,dia,options){RL.Canvas.IDrawable.call(this);RL.Canvas.IClosedShape.call(this,options);this.point=RL.Canvas.__getPoint(point);this.dia=dia;this.boundingPoints=[new RL.Vector2(this.point.x,this.point.y+0.5*dia),new RL.Vector2(this.point.x,this.point.y-0.5*dia),new RL.Vector2(this.point.x+0.5*dia,this.point.y),new RL.Vector2(this.point.x-0.5*dia,this.point.y)];this.draw=function(){var posPX=canvasObj.posConverter.convertPos_InToPx(this.point);var diaPX=canvasObj.posConverter.convertValue_InToPx(Math.abs(this.dia));RL.Canvas.Circle.drawPX(canvasObj,posPX,diaPX,this.options);}}
RL.Canvas.Circle.drawPX=function(canvasObj,pointPX,diaPX,options){pointPX=RL.Canvas.__getPoint(pointPX);options=RL.Canvas.IClosedShape.setOptions(options);var radPX=0.5*diaPX;canvasObj.__context.save();canvasObj.__context.translate(pointPX.x,pointPX.y);canvasObj.__context.beginPath();canvasObj.__context.arc(0,0,radPX,0,Math.PI*2,true);canvasObj.__context.closePath();if(options.fillColor){canvasObj.__context.fillStyle=RL.Canvas.get_ColorStr(options.fillColor);canvasObj.__context.fill();}
if(options.hasEdge){canvasObj.__context.strokeStyle=RL.Canvas.get_ColorStr(options.edgeColor);canvasObj.__context.lineWidth=options.lineWidth;canvasObj.__context.stroke();}
canvasObj.__context.restore();}
RL.Canvas.Arc=function(canvasObj,cntrPt,radius,startDeg,endDeg,options){RL.Canvas.IDrawable.call(this);this.cntrPt=RL.Canvas.__getPoint(cntrPt);this.radius=radius;this.startDeg=startDeg||0;this.endDeg=endDeg||360;this.width=(options&&options.width)||1;this.color=(options&&options.color)||'Black';Object.defineProperty(this,"lengthIN",{get:function(){return RL.Canvas.Arc.getLength(this.radius,this.endDeg,this.startDeg);}});this.boundingPoints=undefined;this.__finalInit=function(){this.boundingPoints=this.getPoints([0,0.5,1]);}
this.draw=function(){var cPX=canvasObj.posConverter.convertPos_InToPx(this.cntrPt);var radPX=canvasObj.posConverter.convertValue_InToPx(Math.abs(this.radius));var ccw=(RL.Number.sign(this.radius)==1)?true:false;var startRad=RL.Number.radians(-1*this.startDeg);var endRad=RL.Number.radians(-1*this.endDeg);canvasObj.__context.save();canvasObj.__context.strokeStyle=this.color;canvasObj.__context.lineWidth=this.width;canvasObj.__context.beginPath();canvasObj.__context.arc(cPX.x,cPX.y,radPX,startRad,endRad,ccw);canvasObj.__context.stroke();canvasObj.__context.restore();}
this.getPoints=function(propArr){return RL.Canvas.Arc.getPoints(this.cntrPt,this.radius,this.startDeg,this.endDeg,propArr);}
this.getPoint=function(proportion){return RL.Canvas.Arc.getPoint(this.cntrPt,this.radius,this.startDeg,this.endDeg,proportion);}
this.__finalInit();}
RL.Canvas.Arc.getPoints=function(cntrPt,radius,startDeg,endDeg,propArr){cntrPt=RL.Canvas.__getPoint(cntrPt);var vBL=new RL.Vector2(cntrPt.x+Math.abs(radius),cntrPt.y);var startPt=vBL.rotateAbout(cntrPt,startDeg);var ccw=(RL.Number.sign(radius)==1)?true:false;if(ccw){if(startDeg>endDeg){startDeg=startDeg-360;}}else{if(startDeg<endDeg){startDeg=startDeg+360;}}
var retArr=[];var deltaDeg=endDeg-startDeg;for(var ii=0;ii<propArr.length;ii+=1){var prop=propArr[ii];var offsetDeg=prop*deltaDeg;var pt=startPt.rotateAbout(cntrPt,offsetDeg);pt.deg=startDeg+offsetDeg;retArr[ii]=pt;}
return retArr;}
RL.Canvas.Arc.getPoint=function(cntrPt,radius,startDeg,endDeg,proportion){var pointsArr=RL.Canvas.Arc.getPoints(cntrPt,radius,startDeg,endDeg,[proportion]);return pointsArr[0];}
RL.Canvas.Arc.getLength=function(radius,startDeg,endDeg){var deltaDeg=Math.abs(endDeg-startDeg);return 2*Math.PI*Math.abs(radius)*(deltaDeg/360);}
RL.Canvas.PieWedge=function(canvasObj,cntrPt,radius,startDeg,endDeg,options){RL.Canvas.IDrawable.call(this);RL.Canvas.IClosedShape.call(this,options);this.cntrPt=RL.Canvas.__getPoint(cntrPt);this.radius=radius;this.startDeg=startDeg||0;this.endDeg=endDeg||360;var arcPts=RL.Canvas.Arc.getPoints(this.cntrPt,this.radius,this.startDeg,this.endDeg,[0,0.5,1]);var arcStart=arcPts[0];var arcTop=arcPts[1];var arcEnd=arcPts[2];this.boundingPoints=[new RL.Vector2(this.cntrPt.x,this.cntrPt.y),arcStart,arcTop,arcEnd];this.draw=function(){var cntrPX=canvasObj.posConverter.convertPos_InToPx(this.cntrPt);var arcStartPX=canvasObj.posConverter.convertPos_InToPx(arcStart);var radPX=canvasObj.posConverter.convertValue_InToPx(Math.abs(this.radius));var ccw=(RL.Number.sign(this.radius)==1)?true:false;var startRad=RL.Number.radians(-1*this.startDeg);var endRad=RL.Number.radians(-1*this.endDeg);canvasObj.__context.save();canvasObj.__context.translate(cntrPX.x,cntrPX.y);canvasObj.__context.beginPath();canvasObj.__context.lineTo(arcStartPX.x-cntrPX.x,arcStartPX.y-cntrPX.y);canvasObj.__context.arc(0,0,radPX,startRad,endRad,ccw);canvasObj.__context.lineTo(0,0);canvasObj.__context.closePath();if(options.fillColor){canvasObj.__context.fillStyle=RL.Canvas.get_ColorStr(options.fillColor);canvasObj.__context.fill();}
if(options.hasEdge){canvasObj.__context.strokeStyle=RL.Canvas.get_ColorStr(options.edgeColor);canvasObj.__context.lineWidth=options.lineWidth;canvasObj.__context.stroke();}
canvasObj.__context.restore();}}
RL.Canvas.PieArray=function(canvasObj,cntrPt,dia,values,colors,options){RL.Canvas.IDrawable.call(this);this.cntrPt=RL.Canvas.__getPoint(cntrPt);this.dia=dia;var totalValue=0;for(var ii=0;ii<values.length;ii+=1){totalValue+=values[ii];}
options=options||{};this.hasLine=(options.lineWidth||options.lineColor);this.lineWidth=(options.lineWidth)||(this.hasLine?1:undefined);this.lineColor=(options.lineColor)||(this.hasLine?'White':undefined);this.boundingPoints=[new RL.Vector2(this.cntrPt.x,this.cntrPt.y+0.5*dia),new RL.Vector2(this.cntrPt.x,this.cntrPt.y-0.5*dia),new RL.Vector2(this.cntrPt.x+0.5*dia,this.cntrPt.y),new RL.Vector2(this.cntrPt.x-0.5*dia,this.cntrPt.y)];this.draw=function(){var cntrPX=canvasObj.posConverter.convertPos_InToPx(this.cntrPt);var radPX=canvasObj.posConverter.convertValue_InToPx(0.5*Math.abs(this.dia));var startAngleRad=-0.5*Math.PI;var currentAngleRad=startAngleRad;var ccw=false;canvasObj.__context.save();canvasObj.__context.translate(cntrPX.x,cntrPX.y);for(var ii=0;ii<values.length;ii+=1){var value=values[ii];var fillColor=colors[ii]||'Black';var sliceAngleRad=(value/totalValue)*(2*Math.PI);canvasObj.__context.beginPath();canvasObj.__context.arc(0,0,radPX,currentAngleRad,currentAngleRad+sliceAngleRad,ccw);canvasObj.__context.lineTo(0,0);canvasObj.__context.fillStyle=fillColor;canvasObj.__context.fill();currentAngleRad+=sliceAngleRad;}
canvasObj.__context.restore();if(this.hasLine){canvasObj.__context.save();canvasObj.__context.strokeStyle=this.lineColor;canvasObj.__context.lineWidth=this.lineWidth;currentAngleRad=startAngleRad;var edgeStart=cntrPX.plus(new RL.Vector2(radPX,0));canvasObj.__context.beginPath();for(var ii=0;ii<values.length;ii+=1){var value=values[ii];var sliceAngleRad=(value/totalValue)*(2*Math.PI);var edgePt=edgeStart.rotateAbout(cntrPX,(currentAngleRad+sliceAngleRad),true);canvasObj.__context.moveTo(cntrPX.x,cntrPX.y);canvasObj.__context.lineTo(edgePt.x,edgePt.y);currentAngleRad+=sliceAngleRad;}
canvasObj.__context.stroke();canvasObj.__context.beginPath();canvasObj.__context.arc(cntrPX.x,cntrPX.y,radPX,0,Math.PI*2,true);canvasObj.__context.stroke();canvasObj.__context.restore();}}}
RL.Canvas.Polygon=function(canvasObj,points,options){RL.Canvas.IDrawable.call(this);RL.Canvas.IClosedShape.call(this,options);this.points=RL.Canvas.__getPointArray(points);this.boundingPoints=this.points;this.draw=function(){if(!(this.points&&this.points.length>0)){return;}
var pointsPX=[];for(var ii=0;ii<this.points.length;ii+=1){var pointPX=canvasObj.posConverter.convertPos_InToPx(this.points[ii]).round(1);pointsPX[ii]=pointPX;}
RL.Canvas.Polygon.drawPX(canvasObj,pointsPX,this.options);}}
RL.Canvas.Polygon.drawPX=function(canvasObj,pointsPX,options){pointsPX=RL.Canvas.__getPointArray(pointsPX);options=RL.Canvas.IClosedShape.setOptions(options);canvasObj.__context.save();canvasObj.__context.beginPath();canvasObj.__context.moveTo(pointsPX[0].x,pointsPX[0].y);for(var ii=1;ii<pointsPX.length;ii+=1){canvasObj.__context.lineTo(pointsPX[ii].x,pointsPX[ii].y);}
canvasObj.__context.closePath();if(options.fillColor){canvasObj.__context.fillStyle=RL.Canvas.get_ColorStr(options.fillColor);canvasObj.__context.fill();}
if(options.hasEdge){canvasObj.__context.strokeStyle=RL.Canvas.get_ColorStr(options.edgeColor);canvasObj.__context.lineWidth=options.lineWidth;canvasObj.__context.stroke();}
canvasObj.__context.restore();}
RL.Canvas.Triangle=function(canvasObj,point1,point2,point3,options){RL.Canvas.Polygon.call(this,canvasObj,[point1,point2,point3],options);}
RL.Canvas.Triangle.drawPX=function(canvasObj,point1,point2,point3,options){RL.Canvas.Polygon.drawPX(canvasObj,[point1,point2,point3],options);}
RL.Canvas.Rectangle=function(canvasObj,cntrPt,width,height,options){this.cntrPt=RL.Canvas.__getPoint(cntrPt);this.width=width;this.height=height;Object.defineProperty(this,"pointUprLft",{get:function(){return new RL.Vector2(this.cntrPt.x-0.5*this.width,this.cntrPt.y+0.5*this.height);}});Object.defineProperty(this,"pointUprRt",{get:function(){return new RL.Vector2(this.cntrPt.x+0.5*this.width,this.cntrPt.y+0.5*this.height);}});Object.defineProperty(this,"pointLwrLft",{get:function(){return new RL.Vector2(this.cntrPt.x-0.5*this.width,this.cntrPt.y-0.5*this.height);}});Object.defineProperty(this,"pointLwrRt",{get:function(){return new RL.Vector2(this.cntrPt.x+0.5*this.width,this.cntrPt.y-0.5*this.height);}});if(this.cntrPt&&width&&height){RL.Canvas.Polygon.call(this,canvasObj,[this.pointUprLft,this.pointUprRt,this.pointLwrRt,this.pointLwrLft],options);}else{RL.Canvas.Polygon.call(this,canvasObj,[],options);}}
RL.Canvas.Rectangle.drawPX=function(canvasObj,pointUprLftPX,pointLwrRtPX,options){pointUprLftPX=RL.Canvas.__getPoint(pointUprLftPX);pointLwrRtPX=RL.Canvas.__getPoint(pointLwrRtPX);var pointUprRtPX=new RL.Vector2(pointLwrRtPX.x,pointUprLftPX.y);var pointLwrLftPX=new RL.Vector2(pointUprLftPX.x,pointLwrRtPX.y);var pointsPX=[pointUprLftPX,pointUprRtPX,pointLwrRtPX,pointLwrLftPX];RL.Canvas.Polygon.drawPX(canvasObj,pointsPX,options);}
RL.Canvas.Arrow=function(canvasObj,tailPt,tipPt,options){RL.Canvas.IDrawable.call(this);RL.Canvas.IHitTestable.call(this);var thisObj=this;this.tailPt=RL.Canvas.__getPoint(tailPt);this.tipPt=RL.Canvas.__getPoint(tipPt);Object.defineProperty(this,"lengthPX",{get:function(){var delta=this.tipPt.minus(this.tailPt);var x_px=canvasObj.posConverter.convertValue_InToPx(delta.x,'X');var y_px=canvasObj.posConverter.convertValue_InToPx(delta.y,'Y');return Math.sqrt(x_px*x_px+y_px*y_px);}});this.textObj=undefined;this.lineWidth=(options&&options.lineWidth)||1;this.both=(options&&options.both)||false;this.headAngle=(options&&options.headAngle)||20;this.color=(options&&options.color)||'Black';var __headLenPX=(options&&options.headLenPX)||undefined;var __headLenPr=(options&&options.headLenPr)||(__headLenPX?undefined:0.12);Object.defineProperty(this,"headLenPr",{get:function(){var headLenPr=__headLenPr;if(!headLenPr){headLenPr=Math.min(__headLenPX/this.lengthPX,0.8);}
return headLenPr;}});Object.defineProperty(this,"boundingPoints",{get:function(){var boundPts=[this.tailPt,this.tipPt];return boundPts;}});Object.defineProperty(this,"__hitBoxArr",{get:function(){var hitBoxArr=[];var basePoints=this.__getArrowBasePoints();hitBoxArr.push(new RL.Canvas.HitBox([this.tipPt,basePoints.tip[0],basePoints.tip[1]]));if(this.both){hitBoxArr.push(new RL.Canvas.HitBox([this.tailPt,basePoints.tail[0],basePoints.tail[1]]));}
var dirVect=this.tailPt.minus(this.tipPt);var headWidth=basePoints.tip[1].minus(basePoints.tip[0]).length;if(dirVect.isBasicallyVertical(0.05)){var lineWidthIN=canvasObj.posConverter.convertValue_PxToIn(this.lineWidth,'X');var boxWidth=Math.max(0.8*headWidth,lineWidthIN);var pt1=this.tipPt.plus(new RL.Vector2(-0.5*boxWidth,0));var pt2=this.tailPt.plus(new RL.Vector2(0.5*boxWidth,0));hitBoxArr.push(new RL.Canvas.HitBox([pt1,pt2]));}else if(dirVect.isBasicallyHorizontal(0.05)){var lineWidthIN=canvasObj.posConverter.convertValue_PxToIn(this.lineWidth,'Y');var boxWidth=Math.max(0.8*headWidth,lineWidthIN);var pt1=this.tipPt.plus(new RL.Vector2(0,-0.5*boxWidth));var pt2=this.tailPt.plus(new RL.Vector2(0,0.5*boxWidth));hitBoxArr.push(new RL.Canvas.HitBox([pt1,pt2]));}
return hitBoxArr;}});var __hitID=undefined;Object.defineProperty(this,"hitID",{get:function(){if(__hitID===undefined){var strID='arrow, '+this.tipPt.toString()+', '+this.tailPt.toString();if(this.textObj){strID+=', '+this.textObj.text;}
__hitID=strID;}
return __hitID;}});this.hitTest=function(pointArr,_options){var options=_options||{};var hitID=options.hitID||undefined;if(hitID&&hitID===this.hitID){return false;}
var hitBoxArr=this.__hitBoxArr;for(var ii=0;ii<hitBoxArr.length;ii+=1){var hitTest=hitBoxArr[ii].hitTest(pointArr);if(hitTest){return true;}}
return false;}
this.draw=function(){var shaftTip=this.tipPt.interpolate(this.tailPt,0.5*this.headLenPr);var shaftTail=undefined;if(this.both){shaftTail=this.tailPt.interpolate(this.tipPt,0.5*this.headLenPr);}else{shaftTail=this.tailPt;}
var shaft=new RL.Canvas.Line(canvasObj,shaftTail,shaftTip,{width:this.lineWidth,color:this.color});shaft.draw();var basePoints=this.__getArrowBasePoints();var tipTriang=new RL.Canvas.Triangle(canvasObj,this.tipPt,basePoints.tip[0],basePoints.tip[1],{fillColor:this.color});tipTriang.draw();if(this.both){var tailTriang=new RL.Canvas.Triangle(canvasObj,this.tipPt,basePoints.tail[0],basePoints.tail[1],{fillColor:this.color});tailTriang.draw();}}
this.shift=function(_buffer){var updateArrow=function(newTipPt){var shiftVect=newTipPt.minus(thisObj.tipPt);thisObj.tipPt=newTipPt;thisObj.tailPt=thisObj.tailPt.plus(shiftVect);}
var dirVect=this.tailPt.minus(this.tipPt);var hitID=this.hitID;var otherPts=[];var props=[0.2,0.4,0.6,0.8];for(var ii=0;ii<props.length;ii+=1){otherPts.push(this.tipPt.interpolate(this.tailPt,props[ii]));}
var results=canvasObj.hitMap.getClearPoint(this.tipPt,dirVect,{otherCheckPts:otherPts,buffer:_buffer,hitID:hitID});if(results.isClear){updateArrow(results.point);}else{dirVect=dirVect.times(-1);var startPt=this.tipPt.plus(dirVect);var results=canvasObj.hitMap.getClearPoint(startPt,dirVect,{otherCheckPts:otherPts,buffer:_buffer,hitID:hitID});if(results.isClear){updateArrow(results.point);}}}
this.__getArrowBasePoints=function(){var getBasePoints=function(tipPtIN,tailPtIN,hdLenPr,headAngle){var baseCntrPtIN=tipPtIN.interpolate(tailPtIN,hdLenPr);var baseCntrPtPX=canvasObj.posConverter.convertPos_InToPx(baseCntrPtIN);var tipPtPX=canvasObj.posConverter.convertPos_InToPx(tipPtIN);var b1TipPX=baseCntrPtPX.rotateAbout(tipPtPX,headAngle);var b2TipPX=baseCntrPtPX.rotateAbout(tipPtPX,-1*headAngle);var b1TipIN=canvasObj.posConverter.convertPos_PxToIn(b1TipPX);var b2TipIN=canvasObj.posConverter.convertPos_PxToIn(b2TipPX);return[b1TipIN,b2TipIN];}
var basePointsTip=getBasePoints(this.tipPt,this.tailPt,this.headLenPr,this.headAngle);var basePointsTail=undefined;if(this.both){basePointsTail=getBasePoints(this.tailPt,this.tipPt,this.headLenPr,this.headAngle);}
return{tip:basePointsTip,tail:basePointsTail}}
function addTextObject(){var text=(options&&options.text)||undefined;if(text){var textPt=-1;var textOptions=(options&&options.textOptions)||{};var textOptionsCopy=RL.Object.copyProperties(textOptions);var textObj=new RL.Canvas.Text(canvasObj,text,textPt,textOptionsCopy);canvasObj.__addTextShape(textObj);thisObj.textObj=textObj;textObj.funcDelayedPosition=function(){var textPosPr=(options&&options.textPosPr)||0;var textOffsetPX=(options&&options.textOffsetPX)||5;var textOffsetIN=canvasObj.posConverter.convertValue_PxToIn(textOffsetPX);var rSign=RL.Number.sign(textOffsetPX);var basePt=thisObj.tailPt.interpolate(thisObj.tipPt,textPosPr);var textVect=thisObj.tipPt.minus(basePt).unitVector(textOffsetIN);textVect=textVect.rotate(rSign*90);this.point=basePt.plus(textVect);if(!textOptions.va){if(textVect.isBasicallyHorizontal(0.1)){this.options.va='middle';}else{this.options.va=textVect.y>0?'bottom':'top';}}
if(!textOptions.ha){if(textVect.isBasicallyVertical(0.1)){if(thisObj.tipPt.x>=thisObj.tailPt.x){this.options.ha=(textPosPr<=0.5)?'start':'end';}else{this.options.ha=(textPosPr<=0.5)?'end':'start';}}else if(textVect.x>0){this.options.ha='start';}else if(textVect.x<0){this.options.ha='end';}}};}}
addTextObject();}
RL.Canvas.CurvedArrow=function(canvasObj,args){RL.Canvas.IDrawable.call(this);var thisObj=this;this.textObj=undefined;this.cntrPt=undefined;this.radius=undefined;this.startDeg=undefined;this.endDeg=undefined;Object.defineProperty(this,"startPt",{get:function(){return RL.Canvas.Arc.getPoint(this.cntrPt,this.radius,this.startDeg,this.endDeg,0);}});Object.defineProperty(this,"endPt",{get:function(){return RL.Canvas.Arc.getPoint(this.cntrPt,this.radius,this.startDeg,this.endDeg,1);}});Object.defineProperty(this,"lengthIN",{get:function(){return RL.Canvas.Arc.getLength(this.radius,this.endDeg,this.startDeg);}});Object.defineProperty(this,"lengthPX",{get:function(){return canvasObj.posConverter.convertValue_InToPx(this.lengthIN);}});Object.defineProperty(this,"boundingPoints",{get:function(){var boundPts=[this.startPt,this.endPt];return boundPts;}});args=args||{};this.__initializeProperties=function(){if(args.cntrPt&&args.radius){this.cntrPt=RL.Canvas.__getPoint(args.cntrPt);this.radius=args.radius;this.startDeg=args.startDeg||0;this.endDeg=args.endDeg||360;}else if(args.startPt&&args.endPt&&args.radius){var startPoint=RL.Canvas.__getPoint(args.startPt);var endPoint=RL.Canvas.__getPoint(args.endPt);var stuff=this.__get_CntrAndAngles_from_2PtsAndRad(startPoint,endPoint,args.radius)
this.cntrPt=stuff.cntrPt;this.radius=stuff.radius;this.startDeg=stuff.startDeg;this.endDeg=stuff.endDeg;}else{console.warn('ERROR: Improper call to canvas.drawCurvedArrow method');}}
this.lineWidth=args.lineWidth||1;this.both=args.both||false;this.headAngle=args.headAngle||20;this.color=args.color||'Black';var textText=args.text||undefined;var textOptions=args.textOptions||{};var textPosPr=textText?(args.textPosPr||0):undefined;var textOffsetPX=textText?(args.textOffsetPX||5):undefined;var __headLenPX=args.headLenPX;var __headLenPr=args.headLenPr||(__headLenPX?undefined:0.12);Object.defineProperty(this,"headLenPr",{get:function(){var headLenPr=__headLenPr;if(!headLenPr){headLenPr=Math.min(__headLenPX/this.lengthPX,0.8);}
return headLenPr;}});this.hitTest=function(pointArr,_options){var options=_options||{};var hitID=options.hitID||undefined;var arrowPts=this.__getArrowPoints();var hitBox_Head=new RL.Canvas.HitBox([arrowPts.tipPt,arrowPts.tipBasePts[0],arrowPts.tipBasePts[1]]);if(hitBox_Head.hitTest(pointArr)){return true;}
if(this.both){var hitBox_Tail=new RL.Canvas.HitBox([arrowPts.tailPt,arrowPts.tailBasePts[0],arrowPts.tailBasePts[1]]);if(hitBox_Tail.hitTest(pointArr)){return true;}}
return false;}
this.draw=function(){var arrowPts=this.__getArrowPoints();var shaft=new RL.Canvas.Arc(canvasObj,this.cntrPt,this.radius,arrowPts.shaftStartDeg,arrowPts.shaftEndDeg,{width:this.lineWidth,color:this.color});shaft.draw();var tipTriang=new RL.Canvas.Triangle(canvasObj,arrowPts.tipPt,arrowPts.tipBasePts[0],arrowPts.tipBasePts[1],{fillColor:this.color});tipTriang.draw();if(this.both){var tailTriang=new RL.Canvas.Triangle(canvasObj,arrowPts.tailPt,arrowPts.tailBasePts[0],arrowPts.tailBasePts[1],{fillColor:this.color});tailTriang.draw();}};this.getPoints=function(propArr){return RL.Canvas.Arc.getPoints(this.cntrPt,this.radius,this.startDeg,this.endDeg,propArr);}
this.getTextPoint=function(base,textOffsetIN){var curvePt=undefined;if(typeof(base)==="number"){curvePt=thisObj.getPoints([base])[0];}else{curvePt=base;}
var textVect=curvePt.minus(this.cntrPt).unitVector(textOffsetIN)
var textPt=curvePt.plus(textVect);return textPt;}
this.updateTextPosSmart=function(scoringDic){if(!this.textObj){return;}
this.textObj.funcDelayedPosition=function(){var textOffsetIN=canvasObj.posConverter.convertValue_PxToIn(Math.abs(textOffsetPX));var scoringDic=scoringDic||{};var dirRefPtIN=undefined;if(args.textPosPr){dirRefPtIN=thisObj.getTextPoint(args.textPosPr,textOffsetIN);}else{scoringDic.maxDirScore=0;}
var arcPts=thisObj.getPoints([0,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,1]);var textOpts=RL.Object.copyProperties(textOptions);var newPoint;var highScore=0;for(var ii=0;ii<arcPts.length;ii+=1){var curvePt=arcPts[ii];var textPt=thisObj.getTextPoint(curvePt,textOffsetIN);var align=thisObj.__getTextAlignment(textPt);textOpts.ha=align.ha;textOpts.va=align.va;var textTemp=new RL.Canvas.Text(canvasObj,this.text,textPt,textOpts);var scores=RL.Canvas.Text.Scoring.calculateScores(canvasObj,scoringDic,highScore,textTemp,this.hitID,thisObj.cntrPt,dirRefPtIN,undefined);if(scores.finalScore>highScore){highScore=scores.finalScore;newPoint=textPt;}}
this.point=newPoint;var alignment=thisObj.__getTextAlignment(newPoint);this.options.ha=alignment.ha;this.options.va=alignment.va;};}
this.__get_CntrAndAngles_from_2PtsAndRad=function(startPt,endPt,radius){var midPt=startPt.interpolate(endPt,0.5);var midVect=startPt.minus(midPt);var h=midVect.length;if(h>Math.abs(radius)){var oldRadius=radius;radius=RL.Number.sign(radius)*1.000001*h;console.warn('CurvedArrow specified radius too small. Must be at least '+h+'. Growing from '+oldRadius+' to '+radius);}
var L=Math.sqrt(radius*radius-h*h);var radVect=midVect.unitVector(L);var radPt=midPt.plus(radVect);var rotSign=-1*RL.Number.sign(radius);var cntrPt=radPt.rotateAbout(midPt,rotSign*90);var midVect=midPt.minus(cntrPt);var startVect=startPt.minus(cntrPt);var endVect=endPt.minus(cntrPt);var midDeg=midVect.angle();var startDeg=midDeg+midVect.angleTo(startVect);var endDeg=midDeg+midVect.angleTo(endVect);return{cntrPt:cntrPt,radius:radius,startDeg:startDeg,endDeg:endDeg}}
this.__getTextAlignment=function(textPt){var textAlign={ha:'',va:''};var textVect=textPt.minus(this.cntrPt)
if(textVect.isBasicallyVertical(0.1)){textAlign.ha='center';}else{textAlign.ha=textVect.x>0?'start':'end';}
if(textVect.isBasicallyHorizontal(0.1)){textAlign.va='middle';}else{textAlign.va=textVect.y>0?'bottom':'top';}
return textAlign;}
this.__initializeProperties();this.__getArrowPoints=function(){var arcPts=thisObj.getPoints([0,0.8*this.headLenPr,this.headLenPr,1-this.headLenPr,1-0.8*this.headLenPr,1]);var tipPt=arcPts[5];var baseTip=arcPts[3];var b1Tip=baseTip.rotateAbout(tipPt,this.headAngle);var b2Tip=baseTip.rotateAbout(tipPt,-1*this.headAngle);var shaftEndDeg=arcPts[4].deg;var shaftStartDeg=undefined;var tailPt=arcPts[0];var basePointsTail=undefined;if(this.both){var baseTail=arcPts[2];var b1Tail=baseTail.rotateAbout(tailPt,this.headAngle);var b2Tail=baseTail.rotateAbout(tailPt,-1*this.headAngle);basePointsTail=[b1Tail,b2Tail];shaftStartDeg=arcPts[1].deg;}else{shaftStartDeg=this.startDeg;}
return{tipPt:tipPt,tailPt:tailPt,tipBasePts:[b1Tip,b2Tip],tailBasePts:basePointsTail,shaftStartDeg:shaftStartDeg,shaftEndDeg:shaftEndDeg}}
if(textText){var textPt=-1;var textOpts=RL.Object.copyProperties(textOptions);var textObj=new RL.Canvas.Text(canvasObj,textText,textPt,textOpts);canvasObj.__addTextShape(textObj);this.textObj=textObj;textObj.funcDelayedPosition=function(){var textOffsetIN=canvasObj.posConverter.convertValue_PxToIn(Math.abs(textOffsetPX));this.point=thisObj.getTextPoint(textPosPr,textOffsetIN);var align=thisObj.__getTextAlignment(this.point);this.options.ha=align.ha;this.options.va=align.va;};}}
RL.Grid=function(id,_options){BF.GridTable.call(this,id,_options);RL.IDataStore.call(this);var thisObj=this;this.beforePrintFromDataStore=new RL.Subscription();this.afterPrintFromDataStore=new RL.Subscription();var dataCache=undefined;var dataStore=undefined;Object.defineProperty(this,"dataStore",{get:function(){return dataStore;},set:function(value){if(value&&"getDataArray"in value){dataStore=value;refeshTheData();dataStore.onChanged.subscribe(refeshTheData);}}});var refeshTheData=function(){dataCache=thisObj.__getData_fromDataStore();thisObj.printFromDataStore();}
this.printFromDataStore=function(){if(dataStore){var data=[];for(var ii=0;ii<dataCache.length;ii++){var recCopy=thisObj.__getRecordCopy(ii);recCopy.index=ii;data.push(recCopy);}
thisObj.beforePrintFromDataStore.callSubscribers(data);thisObj.setRecords(data);thisObj.selectRow(0);thisObj.afterPrintFromDataStore.callSubscribers();}}
this.__getData_fromDataStore=function(){return dataStore.getDataArray()||[];}
this.__getRecordCopy=function(index){var rec=dataCache[index];var props=Object.keys(rec);var cols=this.getColumns();for(var ii=0;ii<cols.length;ii++){var name=cols[ii].field;if(props.indexOf(name)===-1){props.push(name);}}
var recCopy={};for(var ii=0;ii<props.length;ii++){var name=props[ii];recCopy[name]=rec[name];}
return recCopy;}
this.getSelectedRecordIndex=function(){var index=-1;var selected=this.getSelected();if(selected&&selected.rowIndex>-1){index=selected.record.index;}
return index;}
this.getSelectedRecord=function(){var selected=this.getSelected();var selItem={index:-1,rowIndex:selected.rowIndex,record:undefined,rowElm:selected.rowElm};if(selected&&selected.rowIndex>-1){selItem.index=selected.record.index;selItem.record=thisObj.__getRecordCopy(selItem.index);}
return selItem;}
this.afterSelect.subscribe(function(selected){var dataItem=undefined;if(selected.rowIndex>-1){var index=selected.record.index;dataItem=thisObj.__getRecordCopy(index);}else{dataItem=selected.record;}
var dataArray=[dataItem];thisObj.call_onChangedEvent(dataArray);});}
RL.Grid_NewRow=function(id,_options){RL.Grid.call(this,id,_options);var thisObj=this;this.afterNewRowSelect=new RL.Subscription();this.afterItemRowSelect=new RL.Subscription();this.__getData_fromDataStore=function(){var data=this.dataStore.getDataArray()||[];var cols=this.getColumns();var fieldNameNew=cols[1].field;var newItem=this.getEmptyRecord();newItem['isNewRow']=true;newItem[fieldNameNew]='(new)';data.splice(0,0,newItem);return data;}
this.afterSelect.subscribe(function(selected){var selObj={index:-1,rowIndex:selected.rowIndex,record:undefined,rowElm:selected.rowElm};if(selected.rowIndex>-1){selObj.index=selected.record.index;selObj.record=thisObj.__getRecordCopy(selObj.index);}
if(selected.rowIndex==0){thisObj.afterNewRowSelect.callSubscribers(selObj);}else{thisObj.afterItemRowSelect.callSubscribers(selObj);}});}
RL.Form=function(){}
RL.Form.Form=function(_fieldDict){var thisObj=this;this.beforeSetFromDataStore=new RL.Subscription();var __privFieldDict;Object.defineProperty(this,"fieldDict",{get:function(){return __privFieldDict;},set:function(value){__privFieldDict=value;if(__privFieldDict){RL.Object.forEach(__privFieldDict,function(fieldName,field){thisObj[fieldName]=field;field.form=thisObj;});}}});this.fieldDict=_fieldDict;var __dataStore;Object.defineProperty(this,"dataStore",{get:function(){return __dataStore;},set:function(value){__dataStore=value;__dataStore.onChanged.subscribe(this.__printFromDataStore);}});this.__printFromDataStore=function(dataArray){if(dataArray!==undefined&&dataArray.length>0){var valuesDict=dataArray[0];thisObj.beforeSetFromDataStore.callSubscribers(valuesDict);thisObj.setValues(valuesDict);}}
var _validated=undefined;Object.defineProperty(this,"isValid",{get:function(){return _validated;}});this.validate=function(_valuesDict){var valuesDict=_valuesDict||{};var valid=true;RL.Object.forEach(this.fieldDict,function(fieldName,field){var overrideValue=valuesDict[fieldName];if(field.validate({overrideValue:overrideValue})===false){valid=false;}});_validated=valid;return valid;}
this.getValues=function(){var inputDic={};RL.Object.forEach(this.fieldDict,function(fieldName,field){inputDic[fieldName]=field.getValue();});return inputDic;}
this.getValuesValidated=function(_options){var options=_options||{};var suppressWarnMsg=options.suppressWarnMsg===true?true:false;var inputDic={};RL.Object.forEach(this.fieldDict,function(fieldName,field){var value=field.getValue();if(value!==''&&value!==undefined){inputDic[fieldName]=field.validate({suppressWarnMsg:suppressWarnMsg})?value:undefined;}else{inputDic[fieldName]=undefined;}});return inputDic;}
this.getValuesConverted=function(_options){var options=_options||{};var typeGroup=options.typeGroup||undefined;var validate=options.validate===false?false:true;var suppressWarnMsg=options.suppressWarnMsg===true?true:false;var valuesDic=validate?this.getValuesValidated({suppressWarnMsg:suppressWarnMsg}):undefined;var convertedDic={};RL.Object.forEach(this.fieldDict,function(fieldName,field){var value=valuesDic?valuesDic[fieldName]:field.getValue();if(value!==''&&value!==undefined){var unitType=field.unitType;if(unitType){var unitObj=RL.Unit.tryGet(value);if(unitObj){if(typeGroup){var unitTo=typeGroup.unitDic[unitType];if(unitTo){try{convertedDic[fieldName]=(new RL.Unit(field.getValue())).toNumber(unitTo);}catch(ex){convertedDic[fieldName]=undefined;console.error('Form Error: Could not convert to "'+unitTo+'".');}}else{convertedDic[fieldName]=undefined;console.error('Form Error: Type "'+unitType+'" not found');}}else{convertedDic[fieldName]=unitObj;}}else{convertedDic[fieldName]=value;}}else{convertedDic[fieldName]=value;}}else{convertedDic[fieldName]=value;}});return convertedDic;}
this.getEmptyValues=function(){var emptyDic={};RL.Object.forEach(this.fieldDict,function(fieldName,field){emptyDic[fieldName]='';});return emptyDic;}
this.setValues=function(valuesDict){RL.Object.forEach(this.fieldDict,function(fieldName,field){var valueToSet=valuesDict[fieldName];field.setValue(valueToSet);});this.clearWarnings();}
this.clearValues=function(_valuesDict){var valuesDict=_valuesDict||{};RL.Object.forEach(this.fieldDict,function(fieldName,field){var valueToSet=valuesDict[fieldName]||'';field.setValue(valueToSet);});this.clearWarnings();}
this.clearWarnings=function(){RL.Object.forEach(this.fieldDict,function(fieldName,field){field.clearWarnings();});}}
RL.Form.Field=function(field,validatorArr,_warningDiv){this.fieldElem=undefined;if(typeof(field)==="string"){this.fieldElem=document.getElementById(field);}else if(RL.Type.isHTMLElement(field)){this.fieldElem=field;}else{console.error('Validation Error: Improper initilization of Field object! (field element)');return;}
this.warningDivElem=undefined;if(typeof(_warningDiv)==="string"){this.warningDivElem=document.getElementById(_warningDiv);}else if(_warningDiv===undefined){var warnID='warnDiv_'+this.fieldElem.id+'_autoGen';this.warningDivElem=document.getElementById(warnID);if(!this.warningDivElem){this.warningDivElem=document.createElement('div');this.warningDivElem.setAttribute("id",warnID);var parentElm=this.fieldElem.parentNode;parentElm.appendChild(this.warningDivElem);}}else{console.error('Validation Error: Improper initilization of Field object! (warning div)');return;}
if(validatorArr){for(var ii=0;ii<validatorArr.length;ii++){var validator=validatorArr[ii];validator.field=this;}}
var _validated=undefined;Object.defineProperty(this,"isValid",{get:function(){return _validated;}});this.validate=function(_options){var options=_options||{};var overrideValue=options.overrideValue!==undefined?options.overrideValue:undefined;var suppressWarnMsg=options.suppressWarnMsg===true?true:false;if(!validatorArr){return true;}
this.clearWarnings();var value=overrideValue||this.getValue();var valid=true;for(var ii=0;ii<validatorArr.length;ii++){var validator=validatorArr[ii];var result=validator.validate(value);if(result.warnMsg){valid=false;if(!suppressWarnMsg){this.addWarning(result.warnMsg);}}else if(result.value){this.fieldElem.setValue(result.value);}}
_validated=valid;return valid;}
this.getValue=function(){return this.fieldElem.getValue();}
this.setValue=function(value){if(value!==undefined){this.fieldElem.setValue(value);}else{this.clearValue();}}
this.clearValue=function(){this.fieldElem.clearValue();}
Object.defineProperty(this,"unitType",{get:function(){if(validatorArr){for(var ii=0;ii<validatorArr.length;ii++){var validator=validatorArr[ii];if(validator.unitType){return validator.unitType;}}}
return undefined;}});this.clearWarnings=function(){if(this.warningDivElem){this.warningDivElem.innerHTML='';}}
this.addWarning=function(warningMsg){if(this.warningDivElem){this.warningDivElem.innerHTML+='<div>'+' <span class="help-inline" style="color:crimson">[&nbsp;'+warningMsg+'&nbsp;]</span><br>'+'</div>';}}}
RL.Form.Validator=function(){this.field=undefined;this.validate=function(){console.error('Form Validation Error: No validate method defined!');}
this.getFieldValue=function(fieldName){var fieldObj=this.field.form[fieldName];if(fieldObj){return fieldObj.getValue();}else{console.error('Form Validation Error: Could not get a reference to the specified field.');return undefined;}}}
RL.Form.Validator.NonBlank=function(){RL.Form.Validator.call(this);this.validate=function(value){var retObj={warnMsg:undefined};if(!value){retObj.warnMsg='You must enter a value!';}
return retObj;}}
RL.Form.Validator.Email=function(){RL.Form.Validator.call(this);this.validate=function(value){var retObj={warnMsg:undefined};var re=/\S+@\S+\.\S+/;var isValid=re.test(value);if(!isValid){retObj.warnMsg='You must enter a valid email address!';}
return retObj;}}
RL.Form.Validator.Numeric=function(){RL.Form.Validator.call(this);this.validate=function(value){var retObj={warnMsg:undefined};if(!value){value=0;}
if(!RL.Number.isNumeric(value,true)){retObj.warnMsg='You must enter a numeric value!';}
return retObj;}}
RL.Form.Validator.NumericPositive=function(_options){RL.Form.Validator.call(this);this.validate=function(value){var retObj={warnMsg:undefined};var options=_options||{};var allowZero=(options.allowZero===true)?true:false;if(!value){value=0;}
var warnMsg='You must enter a positive numeric value!';if(!RL.Number.isNumeric(value,true)){retObj.warnMsg=warnMsg;}else{value=Number(value);var isPositive=allowZero?value>=0:value>0;if(!isPositive){retObj.warnMsg=warnMsg;}}
return retObj;}}
RL.Form.Validator.NumericRange=function(minVal,maxVal,_options){RL.Form.Validator.call(this);this.validate=function(value){var retObj={warnMsg:undefined};var options=_options||{};var isInclusive=(options.isInclusive===false)?false:true;var hasMin=minVal!==undefined;var hasMax=maxVal!==undefined;if(!value){value=0;}
var warnMsg='You must enter a value ';if(isInclusive){if(hasMin&&hasMax){warnMsg+='between '+minVal+' and '+maxVal+'.';}else if(hasMin){warnMsg+='>= '+minVal+'.';}else{warnMsg+='<= '+maxVal+'.';}}else{if(hasMin&&hasMax){warnMsg+='greater than '+minVal+' and less than '+maxVal+'.';}else if(hasMin){warnMsg+='greater than '+minVal+'.';}else{warnMsg+='less than '+maxVal+'.';}}
if(!RL.Number.isNumeric(value,true)){retObj.warnMsg=warnMsg;}else{value=Number(value);var isAbove;var isBelow;if(isInclusive){isAbove=hasMin?value>=minVal:true;isBelow=hasMax?value<=maxVal:true;}else{isAbove=hasMin?value>minVal:true;isBelow=hasMax?value<maxVal:true;}
var inRange=isAbove&&isBelow;if(!inRange){retObj.warnMsg=warnMsg;}}
return retObj;}}
RL.Form.Validator.Percent=function(){RL.Form.Validator.call(this);this.validate=function(value){var retObj={warnMsg:undefined,value:undefined};if(!value){value=0;}
var pctVal=new RL.Percent(value);if(pctVal.value!==undefined){retObj.value=pctVal.display;}else{retObj.warnMsg='You must enter a valid percent value!';}
return retObj;}}
RL.Form.Validator.PercentPositive=function(_options){RL.Form.Validator.call(this);this.validate=function(value){var options=_options||{};var allowZero=(options.allowZero===true)?true:false;var retObj={warnMsg:undefined,value:undefined};if(!value){value=0;}
var pctVal=new RL.Percent(value);if(pctVal.value!==undefined){var isPositive=allowZero?pctVal.value>=0:pctVal.value>0;if(isPositive){retObj.value=pctVal.display;}else{retObj.warnMsg='You must enter a positive percent value!';}}else{retObj.warnMsg='You must enter a valid percent value!';}
return retObj;}}
RL.Form.Validator.PercentRange=function(minVal,maxVal,_options){RL.Form.Validator.call(this);this.validate=function(value){var retObj={warnMsg:undefined};var options=_options||{};var isInclusive=(options.isInclusive===false)?false:true;if(!value){value=0;}
var minPctStr=(100*minVal)+'%';var maxPctStr=(100*maxVal)+'%'
var warnMsg='You must enter a percent value between '+minPctStr+' and '+maxPctStr+'.';if(!isInclusive){warnMsg='You must enter a percent value greater than '+minPctStr+' and less than '+maxPctStr+'.';}
var pctVal=new RL.Percent(value);if(pctVal.value!==undefined){var inRange;if(isInclusive){inRange=(pctVal.value>=minVal)&&(pctVal.value<=maxVal);}else{inRange=(pctVal.value>minVal)&&(pctVal.value<maxVal);}
if(inRange){retObj.value=pctVal.display;}else{retObj.warnMsg=warnMsg;}}else{retObj.warnMsg=warnMsg;}
return retObj;}}
RL.Form.Validator.Unit=function(type,_options){RL.Form.Validator.call(this);Object.defineProperty(this,"unitType",{get:function(){return type;}});this.validate=function(value){var options=_options||{};var warnMsgCustom=options.warningMsg;var warnMsgSuffix=options.warningSuffix?(' '+options.warningSuffix):'';var name=(options.name!==undefined)?options.name:type.toLowerCase();var warnMsg=warnMsgCustom||'You must enter a valid '+name+' value, including units!'+warnMsgSuffix;var retObj={warnMsg:undefined};try{if(value===''||value==='0'){var customUnits=new RL.Unit.TypeGroup.Custom();var unitName=customUnits.unitDic[type];value='0 '+unitName;retObj.value=value;}
var unit=RL.Unit.tryGet(value,{'typeName':type});if(unit){retObj.unit=unit;var roundStr=unit.toRoundStr();if(value!==roundStr){retObj.value=roundStr;}}else{retObj.warnMsg=warnMsg;}}catch(ex){retObj.warnMsg=warnMsg;}
return retObj;}}
RL.Form.Validator.UnitPositive=function(type,_options){RL.Form.Validator.call(this);Object.defineProperty(this,"unitType",{get:function(){return type;}});this.validate=function(value){var unitValid=new RL.Form.Validator.Unit(type,_options);var retObj=unitValid.validate(value);if(retObj.warnMsg){return retObj;}else{var options=_options||{};var allowZero=(options.allowZero!==undefined)?options.allowZero:false;var warnMsgCustom=options.warningMsg;var warnMsgSuffix=options.warningSuffix?(' '+options.warningSuffix):'';var name=(options.name!==undefined)?options.name:type.toLowerCase();var valueRes=retObj.unit.value;var warnMsg=warnMsgCustom||'You must enter a positive '+name+' value, including units!'+warnMsgSuffix;var isPositive=allowZero?valueRes>=0:valueRes>0;if(!isPositive){retObj.warnMsg=warnMsg;}}
return retObj;}}
RL.Form.Validator.EqualTo=function(valEqual,_options){RL.Form.Validator.call(this);this.validate=function(value){var options=_options||{};var warnMsgCustom=options.warningMsg;var retObj={warnMsg:undefined};var valEq=valEqual;var fieldPrefix='field:'
if(typeof(valEq)==="string"&&RL.String.startsWith(valEq,fieldPrefix)){var fieldName=valEq.replace(fieldPrefix,'').trim();valEq=this.getFieldValue(fieldName);}
if(value!==valEq){retObj.warnMsg=warnMsgCustom||'You must enter a value equal to '+valEqual+'.';}
return retObj;}}
RL.Form.Validator.NotEqualTo=function(disallowedArr,_options){RL.Form.Validator.call(this);this.validate=function(value){var options=_options||{};var warnMsgCustom=options.warningMsg;var retObj={warnMsg:undefined};var getWarnMsg=function(){var warnMsg=warnMsgCustom;if(!warnMsg){warnMsg='You have entered an invalid value! Invalid values are: ';for(var ii=0;ii<disallowedArr.length;ii++){if(ii>0){warnMsg+=', ';}
var disallowedValue=disallowedArr[ii];warnMsg+=String(disallowedValue);}}
return warnMsg;}
for(var ii=0;ii<disallowedArr.length;ii++){var disallowedValue=disallowedArr[ii];var fieldPrefix='field:'
if(typeof(disallowedValue)==="string"&&RL.String.startsWith(disallowedValue,fieldPrefix)){var fieldName=disallowedValue.replace(fieldPrefix,'').trim();disallowedValue=this.getFieldValue(fieldName);}
if(value===disallowedValue){retObj.warnMsg=getWarnMsg();break;}}
return retObj;}}
RL.Form.Validator.Custom=function(validationFunc){RL.Form.Validator.call(this);this.validate=function(value){return validationFunc(value);}}
RL.TextAreaMaxLength=function(elmTextArea,elmCharDisp,maxLength){var thisObj=this;this.onChanged=new RL.Subscription();this.init=function(){elmTextArea.addEventListener("keydown",this.onModelDescKeydown);elmTextArea.addEventListener("keyup",this.onModelDescKeyup);elmTextArea.addEventListener("change",this.onModelDescTextChanged);}
this.onModelDescKeydown=function(event){var text=elmTextArea.value;if(text.length>=maxLength){if(event.key!=="Backspace"&&event.key!=="Delete"&&event.key!=="Tab"&&(event.key.slice&&event.key.slice(0,5))!=="Arrow"){event.preventDefault();}}}
this.onModelDescKeyup=function(){var text=elmTextArea.value;if(text.length>=maxLength){text=text.slice(0,maxLength);elmTextArea.value=text;}
if(elmCharDisp){elmCharDisp.innerHTML=maxLength-text.length;}}
this.onModelDescTextChanged=function(){var text=elmTextArea.value;thisObj.onChanged.callSubscribers(text);}
thisObj.init();}
RL.DisplayWorker=function(_rootElement){var thisObj=this;this.__rootElm=undefined;if(_rootElement===undefined){this.__rootElm=document;}else{if(typeof(_rootElement)==="string"){this.__rootElm=document.getElementById(_rootElement);}else if(RL.Type.isHTMLElement(_rootElement)){this.__rootElm=_rootElement;}else{console.error('Error: Could not set root element!');return;}}
var doFuncToElements=function(inputDicLst,func){for(var ii=0;ii<inputDicLst.length;ii++){var dic=inputDicLst[ii];var elms=undefined;if(dic.id){elms=[document.getElementById(dic.id)];}else if(dic.className){elms=thisObj.__rootElm.getElementsByClassName(dic.className);}else{console.error('DisplayWorker Error: No identifier given!');}
if(elms.length==0){var idStr=dic.id?'id: '+dic.id:'class: '+dic.className;console.error('DisplayWorker Error: Could not find any elements with specified '+idStr);}
for(var jj=0;jj<elms.length;jj++){var elm=elms[jj];func(elm,dic);}}}
this.display=function(inputDicLst){doFuncToElements(inputDicLst,function(elm,dic){if(dic.unitName){if(dic.value instanceof RL.Unit){elm.innerHTML=dic.value.toHTML(dic.unitName);}else if(dic.value){elm.innerHTML=dic.value;}else{throw new Error('DisplayWorker Error: value not an RL.Unit object!');}}else if(dic.digits){if(RL.Number.isNumeric(dic.value,true)){elm.innerHTML=RL.Number.format_Round(dic.value,{digits:dic.digits});}else{elm.innerHTML=dic.value;}}else if(dic.sigDigits){if(RL.Number.isNumeric(dic.value,true)){elm.innerHTML=RL.Number.format_Round(dic.value,{sigDigits:dic.sigDigits});}else{elm.innerHTML=dic.value;}}else{elm.innerHTML=dic.value;}
if(dic.style){thisObj.setStyle(dic,dic.style);}});}
this.displayText=function(inputDicLst){doFuncToElements(inputDicLst,function(elm,dic){elm.innerHTML=dic.value;if(dic.style){thisObj.setStyle(dic,dic.style);}});}
this.displayRoundNumber=function(inputDicLst){doFuncToElements(inputDicLst,function(elm,dic){elm.innerHTML=RL.Number.format_Round(dic.value,{digits:dic.digits});});}
this.displayUnit=function(inputDicLst){doFuncToElements(inputDicLst,function(elm,dic){elm.innerHTML=dic.value.toHTML(dic.unitName);});}
this.setStyle=function(specifier,style){var inputDicLst=[];if(specifier.id){inputDicLst=[{id:specifier.id}];}else if(specifier.className){inputDicLst=[{className:specifier.className}];}
doFuncToElements(inputDicLst,function(elm,dic){if(typeof(style)==='string'){elm.setAttribute("style",style);}else if(typeof(style)==='object'&&style!==null){RL.Object.forEach(style,function(propName,value){elm.style[propName]=value;});}});}
this.setDivVisibility=function(specifier,isVisible){var inputDicLst=[];if(specifier.id){inputDicLst=[{id:specifier.id}];}else if(specifier.className){inputDicLst=[{className:specifier.className}];}
doFuncToElements(inputDicLst,function(elm,dic){elm.setVisible(isVisible);});}}
RL.FormMsg=function(divContainerID){var thisObj=this;this.divContainer=document.getElementById(divContainerID);this.setMsg=function(msg,_options){var options=_options||{};var isFlash=options.isFlash===true?true:false;var isMarginTop=options.isMarginTop===true?true:false;var clearMS=options.clearMS;var borderStyle=isFlash?" border-width:2px; border-style:dashed; border-color:crimson;":"";var marginStyle=isMarginTop?" margin-top:15px;":"";this.clearMsg();var template={tag:"div",style:"display:inline-block;"+borderStyle+marginStyle,children:{pMsg:{tag:"p",style:"color:crimson; padding:6px 10px 6px 10px; margin:0px; min-height:34px;",innerHTML:msg}}};var msgElms=new BF.Element(template);this.divContainer.appendChild(msgElms.elm);var flashDiv=msgElms.elm;var flashFunc=function(){var borderColor=flashDiv.style.borderColor==='crimson'?'white':'crimson';flashDiv.style.borderColor=borderColor;}
if(clearMS){RL.TimedCode.runAfterDelay(this.clearMsg,clearMS);}
if(isFlash){var maxCount=6;RL.TimedCode.runAtInterval(flashFunc,500,maxCount);}}
this.clearMsg=function(){thisObj.divContainer.innerHTML='';}}
function MC(){}
MC.ServerDatabase=function(storageName,arrayName,displayName,objConstructorFunc,url,refreshMgr){RL.IDataStore.call(this);var thisObj=this;this.__storageWorker=new RL.LocalStorage.StorageObject(storageName,[arrayName]);this.storageArray=new RL.LocalStorage.StorageArray(this.__storageWorker,arrayName);this.fetchingData=false;this.storageArray.onChanged.subscribe(function(){thisObj.call_onChangedEvent();});this.onItemAdded=new RL.Subscription();this.onItemUpdated=new RL.Subscription();this.onItemDeleted=new RL.Subscription();this.storageArray.onItemAdded.subscribe(function(newItemDic){thisObj.onItemAdded.callSubscribers(newItemDic);});this.storageArray.onItemUpdated.subscribe(function(oldNewDic){thisObj.onItemUpdated.callSubscribers(oldNewDic);});this.storageArray.onItemDeleted.subscribe(function(delArr){thisObj.onItemDeleted.callSubscribers(delArr);});this.clearAll=function(){this.__storageWorker.clearAll();}
this.getDataArray=function(){return this.getArray();}
this.getArray=function(_callbackOnRefresh,_storedObjOnly){var itemArr=[];var needRefreshStamp=refreshMgr.needRefresh();if(needRefreshStamp){this.refresh(needRefreshStamp,_callbackOnRefresh);}else{itemArr=this.storageArray.getItemArray();if(!itemArr||itemArr.length==0){this.refresh(undefined,_callbackOnRefresh);if(itemArr===undefined){itemArr=[];}}}
if(_storedObjOnly!==true){itemArr=getObjectArr_fromDicArr(itemArr);}
return itemArr;}
this.getArray_Async=function(callbackFunc,_storedObjOnly){var callThemBack=function(itemArr){if(_storedObjOnly!==true){itemArr=getObjectArr_fromDicArr(itemArr);}
callbackFunc(itemArr);}
var needRefreshStamp=refreshMgr.needRefresh();if(needRefreshStamp){this.refresh(needRefreshStamp,callThemBack);}else{var itemArr=this.storageArray.getItemArray();if(itemArr&&itemArr.length>0){callThemBack(itemArr);}else{this.refresh(undefined,callThemBack);}}}
var refreshCallbackArr=[];this.refresh=function(refreshStamp,_callbackFunc){if(this.__storageWorker.isLocalStorageDisabled){return;}
if(_callbackFunc){refreshCallbackArr.push(_callbackFunc);}
if(this.fetchingData===false){refreshMgr.update(refreshStamp);this.fetchingData=true;BF.AJAX.post({url:url,args:{},onDone:function(resultsStr){thisObj.fetchingData=false;var itemArr=JSON.parse(resultsStr);thisObj.storageArray.setItemArray(itemArr);for(var ii=0;ii<refreshCallbackArr.length;ii++){var cbFunc=refreshCallbackArr[ii];cbFunc(itemArr);}
refreshCallbackArr=[];},onFail:function(){var errMsg='There was an error retrieving '+displayName.toLowerCase()+' from the server.<br>Please contact us if you need assistance.';var errTitle='Error Retrieving '+displayName;BF.modalAlert(errMsg,errTitle);}});}}
function getObjectArr_fromDicArr(dicArr){var objArr=[];for(var ii=0;ii<dicArr.length;ii++){objArr[ii]=objConstructorFunc(dicArr[ii]);}
return objArr;}}
MC.UserDatabase=function(storageName,arrayName,displayName,objConstructorFunc,serverDB,refreshMgr,funcLoggedIn){RL.IDataStore.call(this);var thisObj=this;this.serverDB=serverDB;this.__storageWorker=new RL.LocalStorage.StorageObject(storageName,[arrayName]);this.storageArray=new RL.LocalStorage.StorageArray(this.__storageWorker,arrayName);this.storageArray.onChanged.subscribe(function(){thisObj.call_onChangedEvent();});this.onItemAdded=new RL.Subscription();this.onItemUpdated=new RL.Subscription();this.onItemDeleted=new RL.Subscription();this.storageArray.onItemAdded.subscribe(function(newItemDic){thisObj.onItemAdded.callSubscribers(newItemDic);});this.storageArray.onItemUpdated.subscribe(function(oldNewDic){thisObj.onItemUpdated.callSubscribers(oldNewDic);});this.storageArray.onItemDeleted.subscribe(function(delArr){thisObj.onItemDeleted.callSubscribers(delArr);});this.toString=function(){return this.storageArray.get_StorageString();}
this.updateFromString=function(string,_callbackOnUpdate){this.storageArray.update_FromString(string,{done:function(){if(_callbackOnUpdate){_callbackOnUpdate();}},fail:function(error){var errMsg='The file you selected did not appear to be a '+displayName+' file.<br>Please contact us if you need assistance.';var errTitle='Error Reading from File';BF.modalAlert(errMsg,errTitle);}});}
this.clearAll=function(){this.__storageWorker.clearAll();}
this.clear=function(){this.storageArray.clearItemArray();}
this.getDataArray=function(){return this.getArray();}
this.getArray=function(){var matArr=this.storageArray.getItemArray();var haveMatsStored=matArr&&matArr.length>0;if(!haveMatsStored){matArr=[];}
if(!funcLoggedIn()){if(!haveMatsStored||refreshMgr.needRefresh()){var updateUserMats_fromDBMats=function(dbMatArr){matArr=getDefaultMats_fromBaseList(dbMatArr);thisObj.storageArray.setItemArray(matArr);}
var storedObjOnly=true;var dbMatArr=thisObj.serverDB.getArray(updateUserMats_fromDBMats,storedObjOnly);if(dbMatArr&&dbMatArr.length>0){updateUserMats_fromDBMats(dbMatArr);}}}
matArr=getObjectArr_fromDicArr(matArr);return matArr;}
this.getArray_Async=function(callbackFunc){var callThemBack=function(matArr){matArr=getObjectArr_fromDicArr(matArr);callbackFunc(matArr);}
var matArr=this.storageArray.getItemArray();var haveMatsStored=matArr&&matArr.length>0;if(funcLoggedIn()){if(!haveMatsStored){matArr=[];}
callThemBack(matArr);}else{if(!haveMatsStored||refreshMgr.needRefresh()){var storedObjOnly=true;thisObj.serverDB.getArray_Async(function(dbMatArr){matArr=getDefaultMats_fromBaseList(dbMatArr);thisObj.storageArray.setItemArray(matArr);callThemBack(matArr);},storedObjOnly);}else{callThemBack(matArr);}}}
this.pullDefaultArray=function(){var matArr=this.storageArray.getItemArray()||[];var defaultsAlready=getDefaultMats_fromBaseList(matArr);var defaultKeys=[];for(var ii=0;ii<defaultsAlready.length;ii++){var defMat=defaultsAlready[ii];defaultKeys.push(defMat.key);}
var pullFromDBMats=function(dbMatArr){var defaultArrFull=getDefaultMats_fromBaseList(dbMatArr);var matsToAdd=[];for(var ii=0;ii<defaultArrFull.length;ii++){var defMat=defaultArrFull[ii];if(defaultKeys.indexOf(defMat.key)===-1){matsToAdd.push(defMat);}}
thisObj.storageArray.addItem(matsToAdd);}
var storedObjOnly=true;thisObj.serverDB.getArray_Async(pullFromDBMats,storedObjOnly);}
function getDefaultMats_fromBaseList(baseMatArr){var matArr=[];for(var ii=0;ii<baseMatArr.length;ii+=1){var matTmp=baseMatArr[ii];if(matTmp.giveNonUser){matArr.push(matTmp);}}
return matArr;}
function getObjectArr_fromDicArr(dicArr){var objArr=[];for(var ii=0;ii<dicArr.length;ii++){objArr[ii]=objConstructorFunc(dicArr[ii]);}
return objArr;}
this.getObject=function(indexOrKey){return this.storageArray.getItem(indexOrKey,'key',function(itemDic){return objConstructorFunc(itemDic);});}
this.getObjectIndex=function(key){return this.storageArray.getItemIndex(key,'key');}
this.add=function(obj){this.storageArray.addItem(obj);}
this.update=function(index,obj){this.storageArray.updateItem(index,obj);}
this.delete=function(index){this.storageArray.deleteItem(index);}}
MC.MaterialStorage=function(){var lastRefreshName='materials_lastRefresh';var daysToStale=30;var funcCheckServerDate=getDate_MatLastUpdate;var refreshMgr=new RL.RefreshManager(lastRefreshName,daysToStale,funcCheckServerDate);var funcLoggedIn=userLoggedIn;var displayName='Materials';var objConstructorFunc=function(matDict){return new MC.Material(matDict);}
var url="/calculators/materials/get_db_mats";var storageName_DB='materials_DB';var arrayName_DB='dbMats';this.dbMats=new MC.ServerDatabase(storageName_DB,arrayName_DB,displayName,objConstructorFunc,url,refreshMgr);var storageName_User='materials_user';var arrayName_User='userMats';this.userMats=new MC.UserDatabase(storageName_User,arrayName_User,displayName,objConstructorFunc,this.dbMats,refreshMgr,funcLoggedIn);this.clearAll=function(){this.userMats.clearAll();this.dbMats.clearAll();}}
MC.MaterialStorage.getUserMaterialObj=function(indexOrKey){var matStorageWrkr=new MC.MaterialStorage();return matStorageWrkr.userMats.getObject(indexOrKey);}
MC.MaterialStorage.getUserMatsArray=function(){var matStorageWrkr=new MC.MaterialStorage();return matStorageWrkr.userMats.getArray();}
MC.Material=function(matDic,_unitGroup){var thisObj=this;this.unitGroup=_unitGroup||(new RL.Unit.TypeGroup.Server());this.key=matDic.key;this.name=matDic.name;this.spec=matDic.spec;this.family=matDic.family||'';this.class=matDic.class||'';this.UNS=matDic.UNS||'';this.cond=matDic.cond||'';this.condDesc=matDic.condDesc||'';this.size=matDic.size||'';this.yieldStr=matDic.yieldStr;this.ultStr=matDic.ultStr;this.elasticMod=matDic.elasticMod;this.density=matDic.density;this.poisson=matDic.poisson;this.pctElong=matDic.pctElong;this.pctRedArea=matDic.pctRedArea;this.isStruct=matDic.isStruct;this.isBolt=matDic.isBolt;this.userMat=matDic.userMat;this.giveNonUser=matDic.giveNonUser;this.getConvertedToUnits=function(unitGroup){var matCopy=new MC.Material(matDic,this.unitGroup);matCopy.convertToUnits(unitGroup);return matCopy;}
this.convertToUnits=function(unitGroup){var thisUnitDic=this.unitGroup.unitDic;var cnvUnitDic=unitGroup.unitDic;var tryConvert=function(value,unitName){var num=RL.Number.tryGetNumber(value,{allowBlanks:false});if(num!==undefined){return new RL.Unit(num,thisUnitDic[unitName]).toNumber(cnvUnitDic[unitName]);}else{return value;}}
this.yieldStr=tryConvert(this.yieldStr,'stress');this.ultStr=tryConvert(this.ultStr,'stress');this.elasticMod=tryConvert(this.elasticMod,'elasticMod');this.density=tryConvert(this.density,'density');this.unitGroup=unitGroup;}
this.__form=matDic.form;this.formLst=matDic.formLst||[];Object.defineProperty(this,"form",{get:function(){if(this.__form){return this.__form;}else{var formDesc='';for(var ii=0;ii<this.formLst.length;ii+=1){formDesc+=this.formLst[ii];if(ii<this.formLst.length-1){formDesc+=', ';}}
return formDesc;}},enumerable:true});Object.defineProperty(this,"description",{get:function(){var desc='';if(this.cond){desc+=this.cond;}
if(this.form||this.size){desc+=' (';if(this.form){desc+=this.form;if(this.size){desc+=', '}}
if(this.size){desc+=this.size;}
desc+=')';}
return desc;}});this.fullName=function(){var fullName=thisObj.name;if(thisObj.description){fullName+=', '+thisObj.description;}
return fullName;}();Object.defineProperty(this,"displayName",{get:function(){var dispName=this.name;if(this.cond){dispName+=', '+this.cond;}
return dispName;}});}
MC.Material.getObjectArr_fromDicArr=function(matDicArr){var matArr=[];for(var ii=0;ii<matDicArr.length;ii+=1){matArr[ii]=new MC.Material(matDicArr[ii]);}
return matArr;}
MC.FractureMaterialStorage=function(){var lastRefreshName='fracMats_lastRefresh';var daysToStale=30;var funcCheckServerDate=getDate_FracMatLastUpdate;var refreshMgr=new RL.RefreshManager(lastRefreshName,daysToStale,funcCheckServerDate);var funcLoggedIn=userLoggedIn;var displayName='Fracture Materials';var objConstructorFunc=function(matDict){return new MC.FractureMaterial(matDict);}
var url="/calculators/fracture-materials/get_db_mats";var storageName_DB='fracMats_DB';var arrayName_DB='dbFracMats';this.dbMats=new MC.ServerDatabase(storageName_DB,arrayName_DB,displayName,objConstructorFunc,url,refreshMgr);var storageName_User='fracMats_user';var arrayName_User='userFracMats';this.userMats=new MC.UserDatabase(storageName_User,arrayName_User,displayName,objConstructorFunc,this.dbMats,refreshMgr,funcLoggedIn);this.clearAll=function(){this.userMats.clearAll();this.dbMats.clearAll();}}
MC.FractureMaterialStorage.getUserMaterialObj=function(indexOrKey){var matStorageWrkr=new MC.FractureMaterialStorage();return matStorageWrkr.userMats.getObject(indexOrKey);}
MC.FractureMaterialStorage.getUserMatsArray=function(){var matStorageWrkr=new MC.FractureMaterialStorage();return matStorageWrkr.userMats.getArray();}
MC.FractureMaterial=function(matDic,_unitGroup){var thisObj=this;this.unitGroup=_unitGroup||(new RL.Unit.TypeGroup.Server());this.key=matDic.key;this.name=matDic.name;this.cond=matDic.cond||'';this.form=matDic.form||'';this.size=matDic.size||'';this.orientation=matDic.orientation||'';this.specimen=matDic.specimen||'';this.specimenSize=matDic.specimenSize||'';this.envt=matDic.envt||'';this.temp=matDic.temp||'';this.yieldStr=matDic.yieldStr;this.ultStr=matDic.ultStr;this.elasticMod=matDic.elasticMod;this.pctElong=matDic.pctElong;this.C0=matDic.C0;this.n=matDic.n;this.K1C=matDic.K1C;this.Ak=matDic.Ak;this.Bk=matDic.Bk;this.p=matDic.p;this.q=matDic.q;this.DK1=matDic.DK1;this.Cth_p=matDic.Cth_p;this.Cth_m=matDic.Cth_m;this.alpha=matDic.alpha;this.SR=matDic.SR;this.giveNonUser=matDic.giveNonUser;this.getConvertedToUnits=function(unitGroup){var matCopy=new MC.FractureMaterial(matDic,this.unitGroup);matCopy.convertToUnits(unitGroup);return matCopy;}
this.convertToUnits=function(unitGroup){var thisUnitDic=this.unitGroup.unitDic;var cnvUnitDic=unitGroup.unitDic;var tryConvert=function(value,unitName){var num=RL.Number.tryGetNumber(value,{allowBlanks:false});if(num!==undefined){return new RL.Unit(num,thisUnitDic[unitName]).toNumber(cnvUnitDic[unitName]);}else{return value;}}
this.yieldStr=tryConvert(this.yieldStr,'stress');this.ultStr=tryConvert(this.ultStr,'stress');this.elasticMod=tryConvert(this.elasticMod,'elasticMod');this.K1C=tryConvert(this.K1C,'stressIntensity');this.DK1=tryConvert(this.DK1,'stressIntensity');this.C0=MC.FractureMaterial.convertUnits_C0(this.C0,this.n,this.unitGroup,unitGroup);this.unitGroup=unitGroup;}
Object.defineProperty(this,"unitStr_C0",{get:function(){return MC.FractureMaterial.getUnitStr_C0(this.unitGroup);},enumerable:true});this.__form=matDic.form;this.formLst=matDic.formLst||[];Object.defineProperty(this,"form",{get:function(){if(this.__form){return this.__form;}else{var formDesc='';for(var ii=0;ii<this.formLst.length;ii+=1){formDesc+=this.formLst[ii];if(ii<this.formLst.length-1){formDesc+=', ';}}
return formDesc;}},enumerable:true});Object.defineProperty(this,"description",{get:function(){var descTerms=[];if(this.cond){descTerms.push(this.cond);}
if(this.form){descTerms.push(this.form);}
if(this.size){descTerms.push(this.size);}
if(this.orientation){descTerms.push(this.orientation);}
if(this.specimen){descTerms.push(this.specimen);}
if(this.envt){descTerms.push(this.envt);}
if(this.temp){descTerms.push(this.temp);}
var desc=descTerms.join(', ');return desc;}});this.fullName=function(){var fullName=thisObj.name;if(thisObj.description){fullName+=', '+thisObj.description;}
return fullName;}();Object.defineProperty(this,"displayName",{get:function(){var dispName=this.name;if(this.cond){dispName+=', '+this.cond;}
return dispName;}});}
MC.FractureMaterial.getObjectArr_fromDicArr=function(matDicArr){var matArr=[];for(var ii=0;ii<matDicArr.length;ii+=1){matArr[ii]=new MC.FractureMaterial(matDicArr[ii]);}
return matArr;}
MC.FractureMaterial.convertUnits_C0=function(C,n,unitGroupFrom,unitGroupTo){var unitDicFrom=unitGroupFrom.unitDic;var unitDicTo=unitGroupTo.unitDic;var fct_length=RL.Unit.convert(1,unitDicFrom['length'],unitDicTo['length']);var fct_K=RL.Unit.convert(1,unitDicFrom['stressIntensity'],unitDicTo['stressIntensity']);var C_cnv=C*fct_length*(1/Math.pow(fct_K,n));return C_cnv;}
MC.FractureMaterial.getUnitStr_C0=function(unitGroup){var unitDic=unitGroup.unitDic;var lengthUnit=unitDic['length'];var KUnit=unitDic['stressIntensity'];var C0Unit='('+lengthUnit+'/cycle) / ('+KUnit+')^n';return C0Unit;}
MC.CrossSectionStorage=function(){var thisObj=this;var lastRefreshName='crsSects_lastRefresh';var daysToStale=30;var funcCheckServerDate=getDate_CrsSectLastUpdate;var refreshMgr=new RL.RefreshManager(lastRefreshName,daysToStale,funcCheckServerDate);var funcLoggedIn=userLoggedIn;var displayName='Cross Sections';var objConstructorFunc=function(itemDic){return new MC.CrossSection(itemDic);}
var url="/calculators/cross-sections/get_db_crs_sects";var storageName_DB='crsSects_DB';var arrayName_DB='dbCrsSects';this.dbCrsSects=new MC.ServerDatabase(storageName_DB,arrayName_DB,displayName,objConstructorFunc,url,refreshMgr);var storageName_User='crsSects_user';var arrayName_User='userCrsSects';this.userCrsSects=new MC.UserDatabase(storageName_User,arrayName_User,displayName,objConstructorFunc,this.dbCrsSects,refreshMgr,funcLoggedIn);var getUserCrsSectFromServer_Async=function(obj,callbackFunc){BF.AJAX.post({url:"/calculators/cross-sections/get_user_crs_sect",args:{userMatDic:JSON.stringify(obj)},onDone:function(resultsStr){var csObj=JSON.parse(resultsStr);callbackFunc(csObj);},onFail:function(){BF.modalAlert('There was an error adding/updating your cross section.<br>Please contact us if you need assistance.',"Error Setting Cross Section");}});}
this.userCrsSects.add=function(obj,_callbackFunc,_bldrObj){var addCrsSectToStorage=function(csObj){if(_bldrObj){csObj.bldrObj=_bldrObj;}
thisObj.userCrsSects.storageArray.addItem(csObj);if(_callbackFunc){_callbackFunc(csObj);}}
getUserCrsSectFromServer_Async(obj,addCrsSectToStorage);}
this.userCrsSects.update=function(index,obj,_callbackFunc,_bldrObj){var updateCrsSect=function(csObj){if(_bldrObj){csObj.bldrObj=_bldrObj;}
thisObj.userCrsSects.storageArray.updateItem(index,csObj);if(_callbackFunc){_callbackFunc(csObj);}}
getUserCrsSectFromServer_Async(obj,updateCrsSect);}
this.userCrsSects.delete=function(index){thisObj.userCrsSects.storageArray.deleteItem(index);}
this.clearAll=function(){this.userCrsSects.clearAll();this.dbCrsSects.clearAll();}}
MC.CrossSectionStorage.getUserCrsSectObj=function(indexOrKey){var csStorageWrkr=new MC.CrossSectionStorage();return csStorageWrkr.userCrsSects.getObject(indexOrKey);}
MC.CrossSectionStorage.getUserCrsSectArray=function(){var csStorageWrkr=new MC.CrossSectionStorage();return csStorageWrkr.userCrsSects.getArray();}
MC.CrossSection=function(crsSectDic,_unitGroup){var thisObj=this;this.unitGroup=_unitGroup||(new RL.Unit.TypeGroup.Server());this.key=crsSectDic.key;this.type=crsSectDic.type;this.class=crsSectDic.class;this.desc=crsSectDic.desc;this.dim_x=crsSectDic.dim_x;this.dim_y=crsSectDic.dim_y;this.webThk=crsSectDic.webThk;this.flangeThk=crsSectDic.flangeThk;this.bendingAxis=crsSectDic.bendingAxis;this.area=crsSectDic.area;this.perimeter=crsSectDic.perimeter;this.shearArea=crsSectDic.shearArea;this.shearCoeff=crsSectDic.shearCoeff;this.plasticSectnMod=crsSectDic.plasticSectnMod;this.c_Prim=crsSectDic.c_Prim;this.c_Sec=crsSectDic.c_Sec;this.inertia_Prim=crsSectDic.inertia_Prim;this.inertia_Sec=crsSectDic.inertia_Sec;this.sectionMod_Prim=crsSectDic.sectionMod_Prim;this.sectionMod_Sec=crsSectDic.sectionMod_Sec;this.radOfGyration_Prim=crsSectDic.radOfGyration_Prim;this.radOfGyration_Sec=crsSectDic.radOfGyration_Sec;this.bldrObj=crsSectDic.bldrObj;this.giveNonUser=crsSectDic.giveNonUser;this.getConvertedToUnits=function(unitGroup){var csCopy=new MC.CrossSection(crsSectDic,this.unitGroup);csCopy.convertToUnits(unitGroup);return csCopy;}
this.convertToUnits=function(unitGroup){var thisUnitDic=this.unitGroup.unitDic;var cnvUnitDic=unitGroup.unitDic;var getConvertedIfExists=function(value,unitName){var num=RL.Number.tryGetNumber(value,{allowBlanks:false});if(num!==undefined){return new RL.Unit(num,thisUnitDic[unitName]).toNumber(cnvUnitDic[unitName]);}else{return value;}}
this.dim_x=getConvertedIfExists(this.dim_x,'length');this.dim_y=getConvertedIfExists(this.dim_y,'length');this.webThk=getConvertedIfExists(this.webThk,'length');this.flangeThk=getConvertedIfExists(this.flangeThk,'length');this.area=getConvertedIfExists(this.area,'area');this.shearArea=getConvertedIfExists(this.shearArea,'area');this.perimeter=getConvertedIfExists(this.perimeter,'length');this.c_Prim=getConvertedIfExists(this.c_Prim,'length');this.c_Sec=getConvertedIfExists(this.c_Sec,'length');this.inertia_Prim=getConvertedIfExists(this.inertia_Prim,'inertiaArea');this.inertia_Sec=getConvertedIfExists(this.inertia_Sec,'inertiaArea');this.sectionMod_Prim=getConvertedIfExists(this.sectionMod_Prim,'sectionMod');this.sectionMod_Sec=getConvertedIfExists(this.sectionMod_Sec,'sectionMod');this.radOfGyration_Prim=getConvertedIfExists(this.radOfGyration_Prim,'length');this.radOfGyration_Sec=getConvertedIfExists(this.radOfGyration_Sec,'length');this.unitGroup=unitGroup;}}
MC.CrossSection.getObjectArr_fromDicArr=function(csDicArr){var csArr=[];for(var ii=0;ii<csDicArr.length;ii+=1){csArr[ii]=new MC.CrossSection(csDicArr[ii]);}
return csArr;}
MC.CalculatorMaterials=function(){}
MC.CalculatorMaterials.getArray=function(func_getCalcMats){var matArr=MC.MaterialStorage.getUserMatsArray();matArr=MC.CalculatorObjects.__addUniqueCalcObjects(matArr,func_getCalcMats,MC.CalculatorMaterials.__constructorFunc);return matArr;}
MC.CalculatorMaterials.getArray_Async=function(callbackFunc,func_getCalcMats){var matStorageWrkr=new MC.MaterialStorage();matStorageWrkr.userMats.getArray_Async(function(matArr){matArr=MC.CalculatorObjects.__addUniqueCalcObjects(matArr,func_getCalcMats,MC.CalculatorMaterials.__constructorFunc);callbackFunc(matArr);});}
MC.CalculatorMaterials.getObject=function(key,func_getCalcMats,_unitGroup){var matArr=MC.CalculatorMaterials.getArray(func_getCalcMats);var retMat=MC.CalculatorObjects.__findObject(matArr,key,_unitGroup);return retMat;}
MC.CalculatorMaterials.__constructorFunc=function(matDict){return new MC.Material(matDict);}
MC.CalculatorCrossSections=function(){}
MC.CalculatorCrossSections.getArray=function(func_getCalcCrsSects){var csArr=MC.CrossSectionStorage.getUserCrsSectArray();csArr=MC.CalculatorObjects.__addUniqueCalcObjects(csArr,func_getCalcCrsSects,MC.CalculatorCrossSections.__constructorFunc);return csArr;}
MC.CalculatorCrossSections.getArray_Async=function(callbackFunc,func_getCalcCrsSects){var csStorageWrkr=new MC.CrossSectionStorage();csStorageWrkr.userCrsSects.getArray_Async(function(csArr){csArr=MC.CalculatorObjects.__addUniqueCalcObjects(csArr,func_getCalcCrsSects,MC.CalculatorCrossSections.__constructorFunc);callbackFunc(csArr);});}
MC.CalculatorCrossSections.getObject=function(key,func_getCalcCrsSects,_unitGroup){var csArr=MC.CalculatorCrossSections.getArray(func_getCalcCrsSects);var retObj=MC.CalculatorObjects.__findObject(csArr,key,_unitGroup);return retObj;}
MC.CalculatorCrossSections.__constructorFunc=function(csDict){return new MC.CrossSection(csDict);}
MC.CalculatorFractureMaterials=function(){}
MC.CalculatorFractureMaterials.getArray=function(func_getCalcMats){var matArr=MC.FractureMaterialStorage.getUserMatsArray();matArr=MC.CalculatorObjects.__addUniqueCalcObjects(matArr,func_getCalcMats,MC.CalculatorFractureMaterials.__constructorFunc);return matArr;}
MC.CalculatorFractureMaterials.getArray_Async=function(callbackFunc,func_getCalcMats){var matStorageWrkr=new MC.FractureMaterialStorage();matStorageWrkr.userMats.getArray_Async(function(matArr){matArr=MC.CalculatorObjects.__addUniqueCalcObjects(matArr,func_getCalcMats,MC.CalculatorFractureMaterials.__constructorFunc);callbackFunc(matArr);});}
MC.CalculatorFractureMaterials.getObject=function(key,func_getCalcMats,_unitGroup){var matArr=MC.CalculatorFractureMaterials.getArray(func_getCalcMats);var retMat=MC.CalculatorObjects.__findObject(matArr,key,_unitGroup);return retMat;}
MC.CalculatorFractureMaterials.__constructorFunc=function(matDict){return new MC.FractureMaterial(matDict);}
MC.CalculatorObjects=function(){}
MC.CalculatorObjects.__findObject=function(objArr,key,_unitGroup){var retObj=undefined;for(var ii=0;ii<objArr.length;ii++){var objTmp=objArr[ii];if(objTmp.key==key){retObj=objTmp;break;}}
if(_unitGroup&&retObj!==undefined){retObj=retObj.getConvertedToUnits(_unitGroup);}
return retObj;}
MC.CalculatorObjects.__addUniqueCalcObjects=function(matArr,func_getCalcDicts,func_objConstructor){var matKeys=RL.ObjectArray.get_propValueArray(matArr,'key');var calcMats=func_getCalcDicts();for(var ii=0;ii<calcMats.length;ii+=1){var matDic=calcMats[ii];var matKey=matDic.key;if(matKey&&matKeys.indexOf(matKey)==-1){var matObj=func_objConstructor(matDic);matArr.push(matObj);matKeys.push(matKey);}}
return matArr;}